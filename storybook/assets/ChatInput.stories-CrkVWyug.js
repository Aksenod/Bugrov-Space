import{r as c,j as e}from"./iframe-CHivzW4s.js";import{c as q}from"./createLucideIcon-DckRrJBp.js";import{X as A}from"./x-Cmfp4e5A.js";import{S as U}from"./sparkles-xNk_JMl8.js";import{C as J}from"./check-7CNbmrpC.js";import"./preload-helper-PPVm8Dsz.js";const W=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Y=q("mic",W);const G=[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]],X=q("send-horizontal",G),$="bugrov_space_token";let z=typeof window<"u"?window.localStorage.getItem($):null;const Q=()=>{if(typeof window<"u"){const o=window.localStorage.getItem($);o!==z&&(z=o)}return z},V="https://bugrov-space.onrender.com/api".replace(/\/$/,""),F=(o={})=>{const r={...o};o["Content-Type"]||(r["Content-Type"]="application/json");const n=Q();return n&&(r.Authorization=`Bearer ${n}`),r};function Z(o){return new Promise((r,n)=>{const a=new FileReader;a.onloadend=()=>{if(typeof a.result=="string"){const i=a.result.split(",")[1];r(i)}else n(new Error("Failed to convert blob to base64"))},a.onerror=n,a.readAsDataURL(o)})}async function ee(o){try{const r=await Z(o),n=o.type||"audio/webm",i=`audio.${n.split("/")[1]||"webm"}`,l=await fetch(`${V}/agents/voice/transcribe`,{method:"POST",headers:F(),body:JSON.stringify({audio:r,mimeType:n,filename:i})});if(!l.ok){const d=await l.text();let u="Ошибка при распознавании речи";try{u=JSON.parse(d).error||u}catch{u=d||u}throw new Error(u)}return(await l.json()).text}catch(r){throw r instanceof Error?r:new Error("Неизвестная ошибка при распознавании речи")}}async function te(o){try{const r=await fetch(`${V}/agents/voice/correct`,{method:"POST",headers:F(),body:JSON.stringify({text:o})});if(!r.ok){const a=await r.text();let i="Ошибка при исправлении текста";try{i=JSON.parse(a).error||i}catch{i=a||i}throw new Error(i)}return await r.json()}catch(r){throw r instanceof Error?r:new Error("Неизвестная ошибка при исправлении текста")}}function re(o,r){const[n,a]=c.useState(!1),[i,l]=c.useState(!1),[s,d]=c.useState(null),[u,v]=c.useState(0),m=c.useRef(null),p=c.useRef([]),x=c.useRef(null),w=c.useRef(null),_=c.useCallback(async()=>{try{d(null),v(0),p.current=[];const h=await navigator.mediaDevices.getUserMedia({audio:!0});x.current=h;let g="audio/webm";MediaRecorder.isTypeSupported("audio/webm")||(MediaRecorder.isTypeSupported("audio/mp4")?g="audio/mp4":MediaRecorder.isTypeSupported("audio/ogg")&&(g="audio/ogg"));const N=new MediaRecorder(h,{mimeType:g});m.current=N,N.ondataavailable=b=>{b.data.size>0&&p.current.push(b.data)},N.onstop=async()=>{try{l(!0);const b=new Blob(p.current,{type:g}),f=await ee(b);if(!f||!f.trim())throw new Error("Не удалось распознать речь. Попробуйте говорить четче.");const{originalText:H,correctedText:D}=await te(f);o(H,D)}catch(b){const f=b instanceof Error?b.message:"Ошибка при обработке аудио";d(f),r&&r(f)}finally{l(!1)}},N.onerror=b=>{const f="Ошибка при записи аудио";d(f),r&&r(f),a(!1),l(!1)},N.start(100),a(!0);const C=Date.now();w.current=setInterval(()=>{v(Math.floor((Date.now()-C)/1e3))},1e3)}catch(h){let g="Не удалось получить доступ к микрофону";h instanceof Error&&(h.name==="NotAllowedError"||h.name==="PermissionDeniedError"?g="Доступ к микрофону запрещен. Разрешите использование микрофона в настройках браузера.":h.name==="NotFoundError"||h.name==="DevicesNotFoundError"?g="Микрофон не найден. Убедитесь, что микрофон подключен.":g=h.message||g),d(g),a(!1),r&&r(g)}},[o,r]),M=c.useCallback(()=>{m.current&&n&&(m.current.stop(),a(!1),w.current&&(clearInterval(w.current),w.current=null),x.current&&(x.current.getTracks().forEach(h=>h.stop()),x.current=null))},[n]),I=c.useCallback(()=>{m.current&&n&&(m.current.stop(),a(!1),p.current=[],v(0),d(null),w.current&&(clearInterval(w.current),w.current=null),x.current&&(x.current.getTracks().forEach(h=>h.stop()),x.current=null))},[n]);return{isRecording:n,isProcessing:i,error:s,recordingDuration:u,startRecording:_,stopRecording:M,cancelRecording:I}}function se(o,r){if(o===r)return[{text:o,type:"same"}];const n=o.split(/(\s+)/),a=r.split(/(\s+)/),i=[];let l=0,s=0;for(;l<n.length||s<a.length;){if(l>=n.length){i.push({text:a.slice(s).join(""),type:"changed"});break}if(s>=a.length){i.push({text:n.slice(l).join(""),type:"changed"});break}if(n[l]===a[s])i.push({text:n[l],type:"same"}),l++,s++;else{let d=!1;for(let u=s+1;u<a.length;u++)if(n[l]===a[u]){i.push({text:a.slice(s,u).join(""),type:"changed"}),s=u,d=!0;break}d||(i.push({text:n[l],type:"changed"}),l++)}}return i}const P=({isOpen:o,onClose:r,originalText:n,correctedText:a,onUseCorrected:i,onUseOriginal:l})=>{if(!o)return null;const s=n!==a,d=s?se(n,a):null,u=p=>{p.target===p.currentTarget&&r()},v=()=>{i(),r()},m=()=>{l(),r()};return e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4",onClick:u,children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-md transition-opacity animate-in fade-in duration-300"}),e.jsxs("div",{className:"relative w-full max-w-2xl bg-gradient-to-br from-black/90 via-black/80 to-black/90 backdrop-blur-2xl border border-white/10 rounded-[2rem] shadow-[0_0_50px_rgba(0,0,0,0.5)] shadow-indigo-500/10 animate-in fade-in zoom-in-95 duration-300 overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-indigo-500/50 via-purple-500/30 to-transparent"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-indigo-500/20 border border-indigo-500/30 rounded-2xl flex-shrink-0",children:e.jsx(Y,{size:24,className:"text-indigo-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"Голосовой ввод"}),e.jsx("p",{className:"text-sm text-white/60",children:s?"Текст был распознан и исправлен. Выберите, какой вариант использовать.":"Текст распознан. Проверьте и при необходимости отредактируйте."})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/50 hover:text-white transition-colors flex-shrink-0",children:e.jsx(A,{size:18})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-white/60 uppercase tracking-wide",children:"Оригинальный текст"})}),e.jsx("div",{className:"p-4 bg-white/5 border border-white/10 rounded-xl",children:e.jsx("p",{className:"text-sm text-white/80 leading-relaxed whitespace-pre-wrap",children:n})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{size:14,className:"text-indigo-400"}),e.jsxs("span",{className:"text-xs font-medium text-white/60 uppercase tracking-wide",children:["Исправленный текст ",s&&e.jsx("span",{className:"text-indigo-400",children:"(изменения выделены)"})]})]}),e.jsx("div",{className:"p-4 bg-indigo-500/5 border border-indigo-500/20 rounded-xl",children:s&&d?e.jsx("p",{className:"text-sm text-white/80 leading-relaxed whitespace-pre-wrap",children:d.map((p,x)=>e.jsx("span",{className:p.type==="changed"?"bg-indigo-500/20 text-indigo-200 rounded px-0.5":"",children:p.text},x))}):e.jsx("p",{className:"text-sm text-white/80 leading-relaxed whitespace-pre-wrap",children:a})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,className:"flex-1 px-4 py-3 bg-white/5 hover:bg-white/10 border border-white/10 text-white rounded-xl font-medium text-sm transition-all active:scale-[0.98]",children:"Использовать оригинальный"}),e.jsxs("button",{onClick:v,className:"flex-1 px-4 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl font-bold text-sm transition-all shadow-[0_0_20px_rgba(99,102,241,0.3)] active:scale-[0.98] flex items-center justify-center gap-2",children:[e.jsx(J,{size:16}),"Использовать исправленный"]})]})]})]})]})};P.__docgenInfo={description:"",methods:[],displayName:"VoiceInputModal",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},originalText:{required:!0,tsType:{name:"string"},description:""},correctedText:{required:!0,tsType:{name:"string"},description:""},onUseCorrected:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onUseOriginal:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const j=({onSend:o,disabled:r,isLoading:n=!1,onCancel:a})=>{const[i,l]=c.useState(""),s=c.useRef(null),d=c.useRef(!1),[u,v]=c.useState(!1),[m,p]=c.useState(null);c.useEffect(()=>{s.current&&(s.current.style.height="48px",s.current.style.minHeight="48px",s.current.style.maxHeight="48px",s.current.style.overflowY="hidden")},[]);const x=()=>{if(d.current)return;const t=s.current;if(!t)return;if(!i.trim()){t.style.height="48px",t.style.minHeight="48px",t.style.maxHeight="48px",t.style.overflowY="hidden";return}d.current=!0;const y=parseInt(t.style.height)||48,B=t.style.overflowY,O=t.style.minHeight,L=t.style.maxHeight;t.style.overflowY="hidden",t.style.minHeight="auto",t.style.maxHeight="150px",t.style.height="auto";const K=t.scrollHeight,E=Math.min(K,150);Math.abs(E-y)>1?(t.style.height=`${E}px`,E>=150?t.style.overflowY="auto":t.style.overflowY="hidden"):(t.style.height=`${y}px`,t.style.overflowY=B||"hidden"),O&&(t.style.minHeight=O),L&&(t.style.maxHeight=L),d.current=!1};c.useEffect(()=>{i.trim()?requestAnimationFrame(()=>{x()}):s.current&&(s.current.style.height="48px",s.current.style.overflowY="hidden",s.current.style.minHeight="48px",s.current.style.maxHeight="48px")},[i]);const w=()=>{i.trim()&&!r&&(o(i.trim()),l(""),s.current&&(s.current.style.height="48px",s.current.style.minHeight="48px",s.current.style.maxHeight="48px",s.current.style.overflowY="hidden"))},_=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),w())},M=(t,y)=>{p({originalText:t,correctedText:y}),v(!0)},I=t=>{console.error("Voice input error:",t)},{isRecording:h,isProcessing:g,recordingDuration:N,startRecording:C,stopRecording:b}=re(M,I),f=()=>{m&&(l(m.correctedText),p(null),setTimeout(()=>{if(s.current){s.current.focus();const t=m.correctedText.length;s.current.setSelectionRange(t,t)}},0))},H=()=>{m&&(l(m.originalText),p(null),setTimeout(()=>{if(s.current){s.current.focus();const t=m.originalText.length;s.current.setSelectionRange(t,t)}},0))},D=()=>{h?b():C()};return e.jsxs("div",{className:"w-full max-w-3xl mx-auto relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-[1.5rem] blur opacity-20 group-hover:opacity-40 transition-all duration-500 ease-out group-focus-within:opacity-60 group-focus-within:blur-md"}),e.jsxs("div",{className:"relative flex items-center bg-gradient-to-br from-black/70 via-black/60 to-black/70 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-2xl shadow-indigo-500/10 transition-all group-focus-within:border-white/20 group-focus-within:shadow-indigo-500/30 group-focus-within:shadow-lg",children:[e.jsx("button",{onClick:D,disabled:r||n||g,className:`pl-3 pr-2 flex-shrink-0 transition-all duration-300 ${h?"text-red-400 animate-pulse":r||n||g?"text-white/20 cursor-not-allowed":"text-white/40 hover:text-white/60"}`,title:h?`Запись... ${N}с`:"Голосовой ввод",children:e.jsx(Y,{size:18,className:h?"animate-pulse":""})}),e.jsx("div",{className:"pl-1 flex-shrink-0 text-white/40 flex items-center",children:e.jsx(U,{size:18,className:`transition-colors duration-300 ${i.trim()?"text-indigo-400":""}`})}),e.jsx("textarea",{ref:s,value:i,onChange:t=>l(t.target.value),onKeyDown:_,onFocus:t=>{if(!i.trim())t.currentTarget.style.height="48px",t.currentTarget.style.minHeight="48px",t.currentTarget.style.maxHeight="48px",t.currentTarget.style.overflowY="hidden";else{const y=t.currentTarget.style.height||"48px";requestAnimationFrame(()=>{t.currentTarget.style.height!==y&&(t.currentTarget.style.height=y)})}},onBlur:t=>{if(t.currentTarget){const y=t.currentTarget.style.height;requestAnimationFrame(()=>{t.currentTarget&&t.currentTarget.style.height!==y&&(t.currentTarget.style.height=y)})}},placeholder:r?"Подключение...":"Напишите мне ...",disabled:r,className:"w-full bg-transparent text-white placeholder-white/30 text-base px-3 max-h-[150px] min-h-[48px] focus:outline-none focus:ring-0 resize-none no-scrollbar font-medium",rows:1,style:{height:"48px",overflowY:"hidden",paddingTop:"12px",paddingBottom:"12px",lineHeight:"24px",boxSizing:"border-box"}}),e.jsx("div",{className:"pr-1.5 flex-shrink-0 flex items-center",children:n&&a?e.jsx("button",{onClick:a,className:"p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(239,68,68,0.4)] border border-red-500/30",title:"Остановить генерацию",children:e.jsx(A,{size:18})}):e.jsx("button",{onClick:w,disabled:!i.trim()||r||g,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${!i.trim()||r||g?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]"}`,children:e.jsx(X,{size:18,className:i.trim()?"ml-0.5":""})})})]}),u&&m&&e.jsx(P,{isOpen:u,onClose:()=>{v(!1),p(null)},originalText:m.originalText,correctedText:m.correctedText,onUseCorrected:f,onUseOriginal:H}),g&&e.jsx("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-indigo-500/20 border border-indigo-500/30 rounded-xl backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-300",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-indigo-400/30 border-t-indigo-400 rounded-full animate-spin"}),e.jsx("span",{children:"Обработка голосового ввода..."})]})})]})};j.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{onSend:{required:!0,tsType:{name:"signature",type:"function",raw:"(text: string) => void",signature:{arguments:[{type:{name:"string"},name:"text"}],return:{name:"void"}}},description:""},disabled:{required:!0,tsType:{name:"boolean"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onCancel:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const de={title:"UI/ChatInput",component:j,tags:["autodocs"],parameters:{layout:"centered",backgrounds:{default:"dark",values:[{name:"dark",value:"#000000"}]}}},T={render:()=>{const[o,r]=c.useState([]);return e.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[e.jsx(j,{onSend:n=>{r([...o,n]),console.log("Sent:",n)},disabled:!1}),o.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-white/5 rounded-lg",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Отправленные сообщения:"}),e.jsx("ul",{className:"space-y-1",children:o.map((n,a)=>e.jsxs("li",{className:"text-white/80 text-sm",children:["• ",n]},a))})]})]})}},k={render:()=>e.jsx("div",{className:"w-full max-w-3xl",children:e.jsx(j,{onSend:()=>{},disabled:!0})})},S={render:()=>{const[o,r]=c.useState(!1);return e.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[e.jsx(j,{onSend:()=>{r(!0),setTimeout(()=>r(!1),3e3)},disabled:!1,isLoading:o,onCancel:()=>r(!1)}),e.jsx("p",{className:"text-sm text-white/60",children:"Нажмите отправить, чтобы увидеть состояние загрузки"})]})}},R={render:()=>{const[o,r]=c.useState([]);return e.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[e.jsx(j,{onSend:n=>{r([...o,n])},disabled:!1}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Попробуйте ввести длинный текст - поле автоматически расширится:"}),e.jsx("p",{className:"text-xs text-white/40",children:"Введите несколько строк текста, чтобы увидеть авто-высоту"})]})]})}};T.parameters={...T.parameters,docs:{...T.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
        console.log('Sent:', text);
      }} disabled={false} />
        {messages.length > 0 && <div className="mt-4 p-4 bg-white/5 rounded-lg">
            <p className="text-sm text-white/60 mb-2">Отправленные сообщения:</p>
            <ul className="space-y-1">
              {messages.map((msg, i) => <li key={i} className="text-white/80 text-sm">• {msg}</li>)}
            </ul>
          </div>}
      </div>;
  }
}`,...T.parameters?.docs?.source}}};k.parameters={...k.parameters,docs:{...k.parameters?.docs,source:{originalSource:`{
  render: () => <div className="w-full max-w-3xl">
      <ChatInput onSend={() => {}} disabled={true} />
    </div>
}`,...k.parameters?.docs?.source}}};S.parameters={...S.parameters,docs:{...S.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [isLoading, setIsLoading] = useState(false);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={() => {
        setIsLoading(true);
        setTimeout(() => setIsLoading(false), 3000);
      }} disabled={false} isLoading={isLoading} onCancel={() => setIsLoading(false)} />
        <p className="text-sm text-white/60">Нажмите отправить, чтобы увидеть состояние загрузки</p>
      </div>;
  }
}`,...S.parameters?.docs?.source}}};R.parameters={...R.parameters,docs:{...R.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
      }} disabled={false} />
        <div className="p-4 bg-white/5 rounded-lg">
          <p className="text-sm text-white/60 mb-2">Попробуйте ввести длинный текст - поле автоматически расширится:</p>
          <p className="text-xs text-white/40">Введите несколько строк текста, чтобы увидеть авто-высоту</p>
        </div>
      </div>;
  }
}`,...R.parameters?.docs?.source}}};const ue=["Default","Disabled","Loading","LongText"];export{T as Default,k as Disabled,S as Loading,R as LongText,ue as __namedExportsOrder,de as default};
