import{r as i,j as t}from"./iframe-Do9DfNg2.js";import{c as D}from"./createLucideIcon-Rv7RIXOA.js";import{X as P}from"./x-D46DI0Bs.js";import"./preload-helper-PPVm8Dsz.js";const $=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],A=D("mic",$);const O=[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]],F=D("send-horizontal",O),L="bugrov_space_token";let C=typeof window<"u"?window.localStorage.getItem(L):null;const V=()=>{if(typeof window<"u"){const a=window.localStorage.getItem(L);a!==C&&(C=a)}return C},H="https://bugrov-space.onrender.com/api".replace(/\/$/,""),z=(a={})=>{const e={...a};a["Content-Type"]||(e["Content-Type"]="application/json");const s=V();return s&&(e.Authorization=`Bearer ${s}`),e};function B(a){return new Promise((e,s)=>{const n=new FileReader;n.onloadend=()=>{if(typeof n.result=="string"){const o=n.result.split(",")[1];e(o)}else s(new Error("Failed to convert blob to base64"))},n.onerror=s,n.readAsDataURL(a)})}async function K(a){try{const e=await B(a),s=a.type||"audio/webm",o=`audio.${s.split("/")[1]||"webm"}`,m=await fetch(`${H}/agents/voice/transcribe`,{method:"POST",headers:z(),body:JSON.stringify({audio:e,mimeType:s,filename:o})});if(!m.ok){const g=await m.text();let h="Ошибка при распознавании речи";try{h=JSON.parse(g).error||h}catch{h=g||h}throw new Error(h)}return(await m.json()).text}catch(e){throw e instanceof Error?e:new Error("Неизвестная ошибка при распознавании речи")}}async function Y(a){try{const e=await fetch(`${H}/agents/voice/correct`,{method:"POST",headers:z(),body:JSON.stringify({text:a})});if(!e.ok){const n=await e.text();let o="Ошибка при исправлении текста";try{o=JSON.parse(n).error||o}catch{o=n||o}throw new Error(o)}return await e.json()}catch(e){throw e instanceof Error?e:new Error("Неизвестная ошибка при исправлении текста")}}function q(a,e){const[s,n]=i.useState(!1),[o,m]=i.useState(!1),[f,g]=i.useState(null),[h,b]=i.useState(0),x=i.useRef(null),v=i.useRef([]),p=i.useRef(null),u=i.useRef(null),T=i.useCallback(async()=>{try{g(null),b(0),v.current=[];const d=await navigator.mediaDevices.getUserMedia({audio:!0});p.current=d;let c="audio/webm";MediaRecorder.isTypeSupported("audio/webm")||(MediaRecorder.isTypeSupported("audio/mp4")?c="audio/mp4":MediaRecorder.isTypeSupported("audio/ogg")&&(c="audio/ogg"));const w=new MediaRecorder(d,{mimeType:c});x.current=w,w.ondataavailable=r=>{r.data.size>0&&v.current.push(r.data)},w.onstop=async()=>{try{m(!0);const r=new Blob(v.current,{type:c}),l=await K(r);if(!l||!l.trim())throw new Error("Не удалось распознать речь. Попробуйте говорить четче.");const{originalText:N,correctedText:E}=await Y(l);a(N,E)}catch(r){const l=r instanceof Error?r.message:"Ошибка при обработке аудио";g(l),e&&e(l)}finally{m(!1)}},w.onerror=r=>{const l="Ошибка при записи аудио";g(l),e&&e(l),n(!1),m(!1)},w.start(100),n(!0);const M=Date.now();u.current=setInterval(()=>{b(Math.floor((Date.now()-M)/1e3))},1e3)}catch(d){let c="Не удалось получить доступ к микрофону";d instanceof Error&&(d.name==="NotAllowedError"||d.name==="PermissionDeniedError"?c="Доступ к микрофону запрещен. Разрешите использование микрофона в настройках браузера.":d.name==="NotFoundError"||d.name==="DevicesNotFoundError"?c="Микрофон не найден. Убедитесь, что микрофон подключен.":c=d.message||c),g(c),n(!1),e&&e(c)}},[a,e]),R=i.useCallback(()=>{x.current&&s&&(x.current.stop(),n(!1),u.current&&(clearInterval(u.current),u.current=null),p.current&&(p.current.getTracks().forEach(d=>d.stop()),p.current=null))},[s]),I=i.useCallback(()=>{x.current&&s&&(x.current.stop(),n(!1),v.current=[],b(0),g(null),u.current&&(clearInterval(u.current),u.current=null),p.current&&(p.current.getTracks().forEach(d=>d.stop()),p.current=null))},[s]);return{isRecording:s,isProcessing:o,error:f,recordingDuration:h,startRecording:T,stopRecording:R,cancelRecording:I}}const y=({onSend:a,disabled:e,isLoading:s=!1,onCancel:n})=>{const[o,m]=i.useState(""),f=i.useRef(null),g=()=>{const r=f.current;if(!r)return;if(!o.trim()){r.style.height="48px",r.style.overflowY="hidden";return}r.style.height="48px";const l=r.scrollHeight;if(l<=48+2)r.style.height="48px",r.style.overflowY="hidden";else{const E=Math.min(l,200);r.style.height=`${E}px`,r.style.overflowY=l>200?"auto":"hidden"}};i.useEffect(()=>{g()},[o]),i.useEffect(()=>{g()},[]);const h=()=>{o.trim()&&!e&&(a(o.trim()),m(""))},b=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),h())},x=(r,l)=>{m(l),setTimeout(()=>{if(f.current){f.current.focus();const N=l.length;f.current.setSelectionRange(N,N)}},0)},v=r=>{console.error("Voice input error:",r)},{isRecording:p,isProcessing:u,recordingDuration:T,startRecording:R,stopRecording:I}=q(x,v),d=()=>{p?I():R()},c=o.trim().length>0,w=!c&&!s,M=c||s;return t.jsxs("div",{className:"w-full max-w-3xl mx-auto relative group",children:[t.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-[1.5rem] blur opacity-20 group-hover:opacity-40 transition-all duration-500 ease-out group-focus-within:opacity-60 group-focus-within:blur-md"}),t.jsxs("div",{className:"relative flex items-end bg-gradient-to-br from-black/70 via-black/60 to-black/70 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-2xl shadow-indigo-500/10 transition-all group-focus-within:border-white/20 group-focus-within:shadow-indigo-500/30 group-focus-within:shadow-lg",children:[t.jsx("textarea",{ref:f,value:o,onChange:r=>m(r.target.value),onKeyDown:b,placeholder:e?"Подключение...":"Напишите мне ...",disabled:e,className:"flex-1 self-start bg-transparent text-white placeholder-white/30 text-base px-3 py-3 focus:outline-none focus:ring-0 resize-none no-scrollbar font-medium",style:{height:"48px",minHeight:"48px",maxHeight:"200px",lineHeight:"24px",boxSizing:"border-box",overflowY:"hidden"}}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 pr-[5px] pl-2 pb-[5px]",children:[!s&&t.jsx("button",{onClick:d,disabled:e||u,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${p?"bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95":w?"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]":e||u?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white/80"}`,title:p?`Запись... ${T}с`:"Голосовой ввод",children:t.jsx(A,{size:18,className:p?"animate-pulse":""})}),M&&t.jsx(t.Fragment,{children:s&&n?t.jsx("button",{onClick:n,className:"p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(239,68,68,0.4)] border border-red-500/30",title:"Остановить генерацию",children:t.jsx(P,{size:18})}):t.jsx("button",{onClick:h,disabled:!c||e||u,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${!c||e||u?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]"}`,title:"Отправить сообщение",children:t.jsx(F,{size:18,className:"ml-0.5"})})})]})]}),u&&t.jsx("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-indigo-500/20 border border-indigo-500/30 rounded-xl backdrop-blur-sm animate-in fade-in slide-in-from-top-2 duration-300",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-300",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-indigo-400/30 border-t-indigo-400 rounded-full animate-spin"}),t.jsx("span",{children:"Расшифровка..."})]})})]})};y.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{onSend:{required:!0,tsType:{name:"signature",type:"function",raw:"(text: string) => void",signature:{arguments:[{type:{name:"string"},name:"text"}],return:{name:"void"}}},description:""},disabled:{required:!0,tsType:{name:"boolean"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onCancel:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Q={title:"UI/ChatInput",component:y,tags:["autodocs"],parameters:{layout:"centered",backgrounds:{default:"dark",values:[{name:"dark",value:"#000000"}]}}},S={render:()=>{const[a,e]=i.useState([]);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(y,{onSend:s=>{e([...a,s]),console.log("Sent:",s)},disabled:!1}),a.length>0&&t.jsxs("div",{className:"mt-4 p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Отправленные сообщения:"}),t.jsx("ul",{className:"space-y-1",children:a.map((s,n)=>t.jsxs("li",{className:"text-white/80 text-sm",children:["• ",s]},n))})]})]})}},j={render:()=>t.jsx("div",{className:"w-full max-w-3xl",children:t.jsx(y,{onSend:()=>{},disabled:!0})})},k={render:()=>{const[a,e]=i.useState(!1);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(y,{onSend:()=>{e(!0),setTimeout(()=>e(!1),3e3)},disabled:!1,isLoading:a,onCancel:()=>e(!1)}),t.jsx("p",{className:"text-sm text-white/60",children:"Нажмите отправить, чтобы увидеть состояние загрузки"})]})}},_={render:()=>{const[a,e]=i.useState([]);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(y,{onSend:s=>{e([...a,s])},disabled:!1}),t.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Попробуйте ввести длинный текст - поле автоматически расширится:"}),t.jsx("p",{className:"text-xs text-white/40",children:"Введите несколько строк текста, чтобы увидеть авто-высоту"})]})]})}};S.parameters={...S.parameters,docs:{...S.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
        console.log('Sent:', text);
      }} disabled={false} />
        {messages.length > 0 && <div className="mt-4 p-4 bg-white/5 rounded-lg">
            <p className="text-sm text-white/60 mb-2">Отправленные сообщения:</p>
            <ul className="space-y-1">
              {messages.map((msg, i) => <li key={i} className="text-white/80 text-sm">• {msg}</li>)}
            </ul>
          </div>}
      </div>;
  }
}`,...S.parameters?.docs?.source}}};j.parameters={...j.parameters,docs:{...j.parameters?.docs,source:{originalSource:`{
  render: () => <div className="w-full max-w-3xl">
      <ChatInput onSend={() => {}} disabled={true} />
    </div>
}`,...j.parameters?.docs?.source}}};k.parameters={...k.parameters,docs:{...k.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [isLoading, setIsLoading] = useState(false);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={() => {
        setIsLoading(true);
        setTimeout(() => setIsLoading(false), 3000);
      }} disabled={false} isLoading={isLoading} onCancel={() => setIsLoading(false)} />
        <p className="text-sm text-white/60">Нажмите отправить, чтобы увидеть состояние загрузки</p>
      </div>;
  }
}`,...k.parameters?.docs?.source}}};_.parameters={..._.parameters,docs:{..._.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
      }} disabled={false} />
        <div className="p-4 bg-white/5 rounded-lg">
          <p className="text-sm text-white/60 mb-2">Попробуйте ввести длинный текст - поле автоматически расширится:</p>
          <p className="text-xs text-white/40">Введите несколько строк текста, чтобы увидеть авто-высоту</p>
        </div>
      </div>;
  }
}`,..._.parameters?.docs?.source}}};const W=["Default","Disabled","Loading","LongText"];export{S as Default,j as Disabled,k as Loading,_ as LongText,W as __namedExportsOrder,Q as default};
