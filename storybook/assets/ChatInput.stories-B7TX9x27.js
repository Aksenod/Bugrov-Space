import{r as i,j as t}from"./iframe-C8s8EPpo.js";import{c as D}from"./createLucideIcon-C1GSK0_N.js";import{X as $}from"./x-CB2uqh42.js";import"./preload-helper-PPVm8Dsz.js";const A=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],O=D("mic",A);const F=[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]],V=D("send-horizontal",F),L="bugrov_space_token";let C=typeof window<"u"?window.localStorage.getItem(L):null;const Y=()=>{if(typeof window<"u"){const a=window.localStorage.getItem(L);a!==C&&(C=a)}return C},H="https://bugrov-space.onrender.com/api".replace(/\/$/,""),z=(a={})=>{const e={...a};a["Content-Type"]||(e["Content-Type"]="application/json");const r=Y();return r&&(e.Authorization=`Bearer ${r}`),e};function B(a){return new Promise((e,r)=>{const n=new FileReader;n.onloadend=()=>{if(typeof n.result=="string"){const o=n.result.split(",")[1];e(o)}else r(new Error("Failed to convert blob to base64"))},n.onerror=r,n.readAsDataURL(a)})}async function K(a){try{const e=await B(a),r=a.type||"audio/webm",o=`audio.${r.split("/")[1]||"webm"}`,u=await fetch(`${H}/agents/voice/transcribe`,{method:"POST",headers:z(),body:JSON.stringify({audio:e,mimeType:r,filename:o})});if(!u.ok){const g=await u.text();let p="Ошибка при распознавании речи";try{p=JSON.parse(g).error||p}catch{p=g||p}throw new Error(p)}return(await u.json()).text}catch(e){throw e instanceof Error?e:new Error("Неизвестная ошибка при распознавании речи")}}async function q(a){try{const e=await fetch(`${H}/agents/voice/correct`,{method:"POST",headers:z(),body:JSON.stringify({text:a})});if(!e.ok){const n=await e.text();let o="Ошибка при исправлении текста";try{o=JSON.parse(n).error||o}catch{o=n||o}throw new Error(o)}return await e.json()}catch(e){throw e instanceof Error?e:new Error("Неизвестная ошибка при исправлении текста")}}function J(a,e){const[r,n]=i.useState(!1),[o,u]=i.useState(!1),[w,g]=i.useState(null),[p,N]=i.useState(0),v=i.useRef(null),S=i.useRef([]),x=i.useRef(null),m=i.useRef(null),y=i.useCallback(async()=>{try{g(null),N(0),S.current=[];const c=await navigator.mediaDevices.getUserMedia({audio:!0});x.current=c;let l="audio/webm";MediaRecorder.isTypeSupported("audio/webm")||(MediaRecorder.isTypeSupported("audio/mp4")?l="audio/mp4":MediaRecorder.isTypeSupported("audio/ogg")&&(l="audio/ogg"));const h=new MediaRecorder(c,{mimeType:l});v.current=h,h.ondataavailable=f=>{f.data.size>0&&S.current.push(f.data)},h.onstop=async()=>{try{u(!0);const f=new Blob(S.current,{type:l}),s=await K(f);if(!s||!s.trim())throw new Error("Не удалось распознать речь. Попробуйте говорить четче.");const{originalText:d,correctedText:b}=await q(s);a(d,b)}catch(f){const s=f instanceof Error?f.message:"Ошибка при обработке аудио";g(s),e&&e(s)}finally{u(!1)}},h.onerror=f=>{const s="Ошибка при записи аудио";g(s),e&&e(s),n(!1),u(!1)},h.start(100),n(!0);const E=Date.now();m.current=setInterval(()=>{N(Math.floor((Date.now()-E)/1e3))},1e3)}catch(c){let l="Не удалось получить доступ к микрофону";c instanceof Error&&(c.name==="NotAllowedError"||c.name==="PermissionDeniedError"?l="Доступ к микрофону запрещен. Разрешите использование микрофона в настройках браузера.":c.name==="NotFoundError"||c.name==="DevicesNotFoundError"?l="Микрофон не найден. Убедитесь, что микрофон подключен.":l=c.message||l),g(l),n(!1),e&&e(l)}},[a,e]),I=i.useCallback(()=>{v.current&&r&&(v.current.stop(),n(!1),m.current&&(clearInterval(m.current),m.current=null),x.current&&(x.current.getTracks().forEach(c=>c.stop()),x.current=null))},[r]),M=i.useCallback(()=>{v.current&&r&&(v.current.stop(),n(!1),S.current=[],N(0),g(null),m.current&&(clearInterval(m.current),m.current=null),x.current&&(x.current.getTracks().forEach(c=>c.stop()),x.current=null))},[r]);return{isRecording:r,isProcessing:o,error:w,recordingDuration:p,startRecording:y,stopRecording:I,cancelRecording:M}}const j=({onSend:a,disabled:e,isLoading:r=!1,onCancel:n})=>{const[o,u]=i.useState(""),w=i.useRef(null),g=()=>{const s=w.current;if(!s)return;if(!o.trim()){s.style.height="48px",s.style.overflowY="hidden";return}s.style.height="48px";const d=s.scrollHeight;if(d<=48+2)s.style.height="48px",s.style.overflowY="hidden";else{const P=Math.min(d,200);s.style.height=`${P}px`,s.style.overflowY=d>200?"auto":"hidden"}};i.useEffect(()=>{g()},[o]),i.useEffect(()=>{g()},[]);const p=()=>{o.trim()&&!e&&(a(o.trim()),u(""))},N=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),p())},v=s=>{const d=s.target;o.trim()?setTimeout(()=>{const b=o.length;d.setSelectionRange(b,b)},0):setTimeout(()=>{d.setSelectionRange(0,0),d.style.height="48px",d.style.overflowY="hidden"},0)},S=(s,d)=>{u(d),setTimeout(()=>{if(w.current){w.current.focus();const b=d.length;w.current.setSelectionRange(b,b)}},0)},x=s=>{console.error("Voice input error:",s)},{isRecording:m,isProcessing:y,recordingDuration:I,startRecording:M,stopRecording:c}=J(S,x),l=()=>{m?c():M()},h=o.trim().length>0,E=!h&&!r,f=h||r;return t.jsxs("div",{className:"w-full max-w-3xl mx-auto relative group",children:[t.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-[1.5rem] blur opacity-20 group-hover:opacity-40 transition-all duration-500 ease-out group-focus-within:opacity-60 group-focus-within:blur-md"}),t.jsxs("div",{className:"relative flex items-end bg-gradient-to-br from-black/70 via-black/60 to-black/70 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-2xl shadow-indigo-500/10 transition-all group-focus-within:border-white/20 group-focus-within:shadow-indigo-500/30 group-focus-within:shadow-lg",children:[t.jsx("textarea",{ref:w,value:o,onChange:s=>u(s.target.value),onKeyDown:N,onFocus:v,placeholder:e?"Подключение...":"Напишите мне ...",disabled:e,rows:1,className:"flex-1 self-start bg-transparent text-white placeholder-white/30 text-base px-3 py-3 focus:outline-none focus:ring-0 resize-none no-scrollbar font-medium",style:{height:"48px",minHeight:"48px",maxHeight:"200px",lineHeight:"24px",boxSizing:"border-box",overflowY:"hidden"}}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 pr-[5px] pl-2 pb-[5px]",children:[!r&&t.jsx("button",{onClick:l,disabled:e||y,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${m?"bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95":E?"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]":e||y?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white/80"}`,title:m?`Запись... ${I}с`:"Голосовой ввод",children:t.jsx(O,{size:18,className:m?"animate-pulse":""})}),f&&t.jsx(t.Fragment,{children:r&&n?t.jsx("button",{onClick:n,className:"p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(239,68,68,0.4)] border border-red-500/30",title:"Остановить генерацию",children:t.jsx($,{size:18})}):t.jsx("button",{onClick:p,disabled:!h||e||y,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${!h||e||y?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]"}`,title:"Отправить сообщение",children:t.jsx(V,{size:18,className:"ml-0.5"})})})]})]}),y&&t.jsx("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-indigo-500/20 border border-indigo-500/30 rounded-xl backdrop-blur-sm animate-in fade-in slide-in-from-top-2 duration-300",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-300",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-indigo-400/30 border-t-indigo-400 rounded-full animate-spin"}),t.jsx("span",{children:"Расшифровка..."})]})})]})};j.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{onSend:{required:!0,tsType:{name:"signature",type:"function",raw:"(text: string) => void",signature:{arguments:[{type:{name:"string"},name:"text"}],return:{name:"void"}}},description:""},disabled:{required:!0,tsType:{name:"boolean"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onCancel:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const W={title:"UI/ChatInput",component:j,tags:["autodocs"],parameters:{layout:"centered",backgrounds:{default:"dark",values:[{name:"dark",value:"#000000"}]}}},k={render:()=>{const[a,e]=i.useState([]);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(j,{onSend:r=>{e([...a,r]),console.log("Sent:",r)},disabled:!1}),a.length>0&&t.jsxs("div",{className:"mt-4 p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Отправленные сообщения:"}),t.jsx("ul",{className:"space-y-1",children:a.map((r,n)=>t.jsxs("li",{className:"text-white/80 text-sm",children:["• ",r]},n))})]})]})}},T={render:()=>t.jsx("div",{className:"w-full max-w-3xl",children:t.jsx(j,{onSend:()=>{},disabled:!0})})},_={render:()=>{const[a,e]=i.useState(!1);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(j,{onSend:()=>{e(!0),setTimeout(()=>e(!1),3e3)},disabled:!1,isLoading:a,onCancel:()=>e(!1)}),t.jsx("p",{className:"text-sm text-white/60",children:"Нажмите отправить, чтобы увидеть состояние загрузки"})]})}},R={render:()=>{const[a,e]=i.useState([]);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(j,{onSend:r=>{e([...a,r])},disabled:!1}),t.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Попробуйте ввести длинный текст - поле автоматически расширится:"}),t.jsx("p",{className:"text-xs text-white/40",children:"Введите несколько строк текста, чтобы увидеть авто-высоту"})]})]})}};k.parameters={...k.parameters,docs:{...k.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
        console.log('Sent:', text);
      }} disabled={false} />
        {messages.length > 0 && <div className="mt-4 p-4 bg-white/5 rounded-lg">
            <p className="text-sm text-white/60 mb-2">Отправленные сообщения:</p>
            <ul className="space-y-1">
              {messages.map((msg, i) => <li key={i} className="text-white/80 text-sm">• {msg}</li>)}
            </ul>
          </div>}
      </div>;
  }
}`,...k.parameters?.docs?.source}}};T.parameters={...T.parameters,docs:{...T.parameters?.docs,source:{originalSource:`{
  render: () => <div className="w-full max-w-3xl">
      <ChatInput onSend={() => {}} disabled={true} />
    </div>
}`,...T.parameters?.docs?.source}}};_.parameters={..._.parameters,docs:{..._.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [isLoading, setIsLoading] = useState(false);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={() => {
        setIsLoading(true);
        setTimeout(() => setIsLoading(false), 3000);
      }} disabled={false} isLoading={isLoading} onCancel={() => setIsLoading(false)} />
        <p className="text-sm text-white/60">Нажмите отправить, чтобы увидеть состояние загрузки</p>
      </div>;
  }
}`,..._.parameters?.docs?.source}}};R.parameters={...R.parameters,docs:{...R.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
      }} disabled={false} />
        <div className="p-4 bg-white/5 rounded-lg">
          <p className="text-sm text-white/60 mb-2">Попробуйте ввести длинный текст - поле автоматически расширится:</p>
          <p className="text-xs text-white/40">Введите несколько строк текста, чтобы увидеть авто-высоту</p>
        </div>
      </div>;
  }
}`,...R.parameters?.docs?.source}}};const Z=["Default","Disabled","Loading","LongText"];export{k as Default,T as Disabled,_ as Loading,R as LongText,Z as __namedExportsOrder,W as default};
