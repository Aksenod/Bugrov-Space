import{r as l,j as t}from"./iframe-DFO4omvp.js";import{X as D}from"./x-BFnBRW5R.js";import{c as L}from"./createLucideIcon-nteoX5ce.js";import"./preload-helper-PPVm8Dsz.js";const O=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],$=L("mic",O);const F=[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]],V=L("send-horizontal",F),z="bugrov_space_token";let C=typeof window<"u"?window.localStorage.getItem(z):null;const Y=()=>{if(typeof window<"u"){const r=window.localStorage.getItem(z);r!==C&&(C=r)}return C},A="https://bugrov-space.onrender.com/api".replace(/\/$/,""),H=(r={})=>{const e={...r};r["Content-Type"]||(e["Content-Type"]="application/json");const s=Y();return s&&(e.Authorization=`Bearer ${s}`),e};function B(r){return new Promise((e,s)=>{const o=new FileReader;o.onloadend=()=>{if(typeof o.result=="string"){const i=o.result.split(",")[1];e(i)}else s(new Error("Failed to convert blob to base64"))},o.onerror=s,o.readAsDataURL(r)})}async function K(r){try{const e=await B(r),s=r.type||"audio/webm",i=`audio.${s.split("/")[1]||"webm"}`,h=await fetch(`${A}/agents/voice/transcribe`,{method:"POST",headers:H(),body:JSON.stringify({audio:e,mimeType:s,filename:i})});if(!h.ok){const p=await h.text();let f="Ошибка при распознавании речи";try{f=JSON.parse(p).error||f}catch{f=p||f}throw new Error(f)}return(await h.json()).text}catch(e){throw e instanceof Error?e:new Error("Неизвестная ошибка при распознавании речи")}}async function q(r){try{const e=await fetch(`${A}/agents/voice/correct`,{method:"POST",headers:H(),body:JSON.stringify({text:r})});if(!e.ok){const o=await e.text();let i="Ошибка при исправлении текста";try{i=JSON.parse(o).error||i}catch{i=o||i}throw new Error(i)}return await e.json()}catch(e){throw e instanceof Error?e:new Error("Неизвестная ошибка при исправлении текста")}}function J(r,e){const[s,o]=l.useState(!1),[i,h]=l.useState(!1),[w,p]=l.useState(null),[f,y]=l.useState(0),x=l.useRef(null),S=l.useRef([]),g=l.useRef(null),u=l.useRef(null),b=l.useCallback(async()=>{if(g.current){if(g.current.getTracks().some(a=>a.readyState==="live"))return g.current;g.current=null}const n=await navigator.mediaDevices.getUserMedia({audio:!0});return g.current=n,n},[]),R=l.useCallback(async()=>{try{p(null),y(0),S.current=[];const n=await b();let m="audio/webm";MediaRecorder.isTypeSupported("audio/webm")||(MediaRecorder.isTypeSupported("audio/mp4")?m="audio/mp4":MediaRecorder.isTypeSupported("audio/ogg")&&(m="audio/ogg"));const v=new MediaRecorder(n,{mimeType:m});x.current=v,v.ondataavailable=c=>{c.data.size>0&&S.current.push(c.data)},v.onstop=async()=>{try{h(!0);const c=new Blob(S.current,{type:m}),d=await K(c);if(!d||!d.trim())throw new Error("Не удалось распознать речь. Попробуйте говорить четче.");const{originalText:E,correctedText:P}=await q(d);r(E,P)}catch(c){const d=c instanceof Error?c.message:"Ошибка при обработке аудио";p(d),e&&e(d)}finally{h(!1)}},v.onerror=c=>{const d="Ошибка при записи аудио";p(d),e&&e(d),o(!1),h(!1)},v.start(100),o(!0);const a=Date.now();u.current=setInterval(()=>{y(Math.floor((Date.now()-a)/1e3))},1e3)}catch(n){let m="Не удалось получить доступ к микрофону";n instanceof Error&&(n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?m="Доступ к микрофону запрещен. Разрешите использование микрофона в настройках браузера.":n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?m="Микрофон не найден. Убедитесь, что микрофон подключен.":m=n.message||m),p(m),o(!1),e&&e(m)}},[r,e,b]),I=l.useCallback(()=>{x.current&&s&&(x.current.stop(),o(!1),u.current&&(clearInterval(u.current),u.current=null))},[s]),M=l.useCallback(()=>{x.current&&s&&(x.current.stop(),o(!1),S.current=[],y(0),p(null),u.current&&(clearInterval(u.current),u.current=null),g.current&&(g.current.getTracks().forEach(n=>n.stop()),g.current=null))},[s]);return l.useEffect(()=>()=>{u.current&&clearInterval(u.current),x.current&&s&&x.current.stop(),g.current&&(g.current.getTracks().forEach(n=>n.stop()),g.current=null)},[s]),{isRecording:s,isProcessing:i,error:w,recordingDuration:f,startRecording:R,stopRecording:I,cancelRecording:M}}const N=({onSend:r,disabled:e,isLoading:s=!1,onCancel:o})=>{const[i,h]=l.useState(""),w=l.useRef(null),p=()=>{const a=w.current;if(!a)return;if(!i.trim()){a.style.height="48px",a.style.overflowY="hidden";return}a.style.height="48px";const c=a.scrollHeight;if(c<=48+2)a.style.height="48px",a.style.overflowY="hidden";else{const E=Math.min(c,200);a.style.height=`${E}px`,a.style.overflowY=c>200?"auto":"hidden"}};l.useEffect(()=>{p()},[i]),l.useEffect(()=>{p()},[]);const f=()=>{i.trim()&&!e&&(r(i.trim()),h(""))},y=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),f())},x=a=>{const c=a.target;i.trim()?setTimeout(()=>{const d=i.length;c.setSelectionRange(d,d)},0):setTimeout(()=>{c.setSelectionRange(0,0),c.style.height="48px",c.style.overflowY="hidden"},0)},S=(a,c)=>{h(c),setTimeout(()=>{if(w.current){w.current.focus();const d=c.length;w.current.setSelectionRange(d,d)}},0)},g=a=>{console.error("Voice input error:",a)},{isRecording:u,isProcessing:b,startRecording:R,stopRecording:I}=J(S,g),M=()=>{u?I():R()},n=i.trim().length>0,m=!n&&!s,v=n||s;return t.jsxs("div",{className:"w-full max-w-3xl mx-auto relative group",children:[t.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-[1.5rem] blur opacity-20 group-hover:opacity-40 transition-all duration-500 ease-out group-focus-within:opacity-60 group-focus-within:blur-md"}),t.jsxs("div",{className:"relative flex items-end bg-gradient-to-br from-black/70 via-black/60 to-black/70 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-2xl shadow-indigo-500/10 transition-all group-focus-within:border-white/20 group-focus-within:shadow-indigo-500/30 group-focus-within:shadow-lg",children:[t.jsx("textarea",{ref:w,value:i,onChange:a=>h(a.target.value),onKeyDown:y,onFocus:x,placeholder:e?"Подключение...":"Напишите мне ...",disabled:e,rows:1,className:"flex-1 self-start bg-transparent text-white placeholder-white/30 text-base px-3 py-3 focus:outline-none focus:ring-0 resize-none no-scrollbar font-medium",style:{height:"48px",minHeight:"48px",maxHeight:"200px",lineHeight:"24px",boxSizing:"border-box",overflowY:"hidden"}}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 pr-[5px] pl-2 pb-[5px]",children:[!s&&(!n||u)&&t.jsx("button",{onClick:M,disabled:e||b,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${u?"bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95":m?"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]":e||b?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white/80"}`,title:u?"Остановить запись":"Голосовой ввод",children:u?t.jsx(D,{size:18}):t.jsx($,{size:18})}),v&&t.jsx(t.Fragment,{children:s&&o?t.jsx("button",{onClick:o,className:"p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(239,68,68,0.4)] border border-red-500/30",title:"Остановить генерацию",children:t.jsx(D,{size:18})}):t.jsx("button",{onClick:f,disabled:!n||e||b,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${!n||e||b?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]"}`,title:"Отправить сообщение",children:t.jsx(V,{size:18,className:"ml-0.5"})})})]})]}),b&&t.jsx("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-indigo-500/20 border border-indigo-500/30 rounded-xl backdrop-blur-sm animate-in fade-in slide-in-from-top-2 duration-300",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-300",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-indigo-400/30 border-t-indigo-400 rounded-full animate-spin"}),t.jsx("span",{children:"Расшифровка..."})]})})]})};N.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{onSend:{required:!0,tsType:{name:"signature",type:"function",raw:"(text: string) => void",signature:{arguments:[{type:{name:"string"},name:"text"}],return:{name:"void"}}},description:""},disabled:{required:!0,tsType:{name:"boolean"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onCancel:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const W={title:"UI/ChatInput",component:N,tags:["autodocs"],parameters:{layout:"centered",backgrounds:{default:"dark",values:[{name:"dark",value:"#000000"}]}}},k={render:()=>{const[r,e]=l.useState([]);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(N,{onSend:s=>{e([...r,s]),console.log("Sent:",s)},disabled:!1}),r.length>0&&t.jsxs("div",{className:"mt-4 p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Отправленные сообщения:"}),t.jsx("ul",{className:"space-y-1",children:r.map((s,o)=>t.jsxs("li",{className:"text-white/80 text-sm",children:["• ",s]},o))})]})]})}},j={render:()=>t.jsx("div",{className:"w-full max-w-3xl",children:t.jsx(N,{onSend:()=>{},disabled:!0})})},T={render:()=>{const[r,e]=l.useState(!1);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(N,{onSend:()=>{e(!0),setTimeout(()=>e(!1),3e3)},disabled:!1,isLoading:r,onCancel:()=>e(!1)}),t.jsx("p",{className:"text-sm text-white/60",children:"Нажмите отправить, чтобы увидеть состояние загрузки"})]})}},_={render:()=>{const[r,e]=l.useState([]);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(N,{onSend:s=>{e([...r,s])},disabled:!1}),t.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Попробуйте ввести длинный текст - поле автоматически расширится:"}),t.jsx("p",{className:"text-xs text-white/40",children:"Введите несколько строк текста, чтобы увидеть авто-высоту"})]})]})}};k.parameters={...k.parameters,docs:{...k.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
        console.log('Sent:', text);
      }} disabled={false} />
        {messages.length > 0 && <div className="mt-4 p-4 bg-white/5 rounded-lg">
            <p className="text-sm text-white/60 mb-2">Отправленные сообщения:</p>
            <ul className="space-y-1">
              {messages.map((msg, i) => <li key={i} className="text-white/80 text-sm">• {msg}</li>)}
            </ul>
          </div>}
      </div>;
  }
}`,...k.parameters?.docs?.source}}};j.parameters={...j.parameters,docs:{...j.parameters?.docs,source:{originalSource:`{
  render: () => <div className="w-full max-w-3xl">
      <ChatInput onSend={() => {}} disabled={true} />
    </div>
}`,...j.parameters?.docs?.source}}};T.parameters={...T.parameters,docs:{...T.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [isLoading, setIsLoading] = useState(false);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={() => {
        setIsLoading(true);
        setTimeout(() => setIsLoading(false), 3000);
      }} disabled={false} isLoading={isLoading} onCancel={() => setIsLoading(false)} />
        <p className="text-sm text-white/60">Нажмите отправить, чтобы увидеть состояние загрузки</p>
      </div>;
  }
}`,...T.parameters?.docs?.source}}};_.parameters={..._.parameters,docs:{..._.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
      }} disabled={false} />
        <div className="p-4 bg-white/5 rounded-lg">
          <p className="text-sm text-white/60 mb-2">Попробуйте ввести длинный текст - поле автоматически расширится:</p>
          <p className="text-xs text-white/40">Введите несколько строк текста, чтобы увидеть авто-высоту</p>
        </div>
      </div>;
  }
}`,..._.parameters?.docs?.source}}};const Z=["Default","Disabled","Loading","LongText"];export{k as Default,j as Disabled,T as Loading,_ as LongText,Z as __namedExportsOrder,W as default};
