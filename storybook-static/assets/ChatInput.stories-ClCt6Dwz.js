import{r as c,j as t}from"./iframe-BafptweW.js";import{X as D}from"./x-D4rXjqvF.js";import{c as L}from"./createLucideIcon-DJgVC9iu.js";import"./preload-helper-PPVm8Dsz.js";const A=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],O=L("mic",A);const $=[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]],F=L("send-horizontal",$),z="bugrov_space_token";let C=typeof window<"u"?window.localStorage.getItem(z):null;const V=()=>{if(typeof window<"u"){const a=window.localStorage.getItem(z);a!==C&&(C=a)}return C},H="https://bugrov-space.onrender.com/api".replace(/\/$/,""),P=(a={})=>{const e={...a};a["Content-Type"]||(e["Content-Type"]="application/json");const r=V();return r&&(e.Authorization=`Bearer ${r}`),e};function Y(a){return new Promise((e,r)=>{const o=new FileReader;o.onloadend=()=>{if(typeof o.result=="string"){const i=o.result.split(",")[1];e(i)}else r(new Error("Failed to convert blob to base64"))},o.onerror=r,o.readAsDataURL(a)})}async function B(a){try{const e=await Y(a),r=a.type||"audio/webm",i=`audio.${r.split("/")[1]||"webm"}`,g=await fetch(`${H}/agents/voice/transcribe`,{method:"POST",headers:P(),body:JSON.stringify({audio:e,mimeType:r,filename:i})});if(!g.ok){const m=await g.text();let p="Ошибка при распознавании речи";try{p=JSON.parse(m).error||p}catch{p=m||p}throw new Error(p)}return(await g.json()).text}catch(e){throw e instanceof Error?e:new Error("Неизвестная ошибка при распознавании речи")}}async function K(a){try{const e=await fetch(`${H}/agents/voice/correct`,{method:"POST",headers:P(),body:JSON.stringify({text:a})});if(!e.ok){const o=await e.text();let i="Ошибка при исправлении текста";try{i=JSON.parse(o).error||i}catch{i=o||i}throw new Error(i)}return await e.json()}catch(e){throw e instanceof Error?e:new Error("Неизвестная ошибка при исправлении текста")}}function q(a,e){const[r,o]=c.useState(!1),[i,g]=c.useState(!1),[f,m]=c.useState(null),[p,y]=c.useState(0),w=c.useRef(null),N=c.useRef([]),h=c.useRef(null),u=c.useRef(null),b=c.useCallback(async()=>{try{m(null),y(0),N.current=[];const d=await navigator.mediaDevices.getUserMedia({audio:!0});h.current=d;let l="audio/webm";MediaRecorder.isTypeSupported("audio/webm")||(MediaRecorder.isTypeSupported("audio/mp4")?l="audio/mp4":MediaRecorder.isTypeSupported("audio/ogg")&&(l="audio/ogg"));const v=new MediaRecorder(d,{mimeType:l});w.current=v,v.ondataavailable=s=>{s.data.size>0&&N.current.push(s.data)},v.onstop=async()=>{try{g(!0);const s=new Blob(N.current,{type:l}),n=await B(s);if(!n||!n.trim())throw new Error("Не удалось распознать речь. Попробуйте говорить четче.");const{originalText:x,correctedText:E}=await K(n);a(x,E)}catch(s){const n=s instanceof Error?s.message:"Ошибка при обработке аудио";m(n),e&&e(n)}finally{g(!1)}},v.onerror=s=>{const n="Ошибка при записи аудио";m(n),e&&e(n),o(!1),g(!1)},v.start(100),o(!0);const M=Date.now();u.current=setInterval(()=>{y(Math.floor((Date.now()-M)/1e3))},1e3)}catch(d){let l="Не удалось получить доступ к микрофону";d instanceof Error&&(d.name==="NotAllowedError"||d.name==="PermissionDeniedError"?l="Доступ к микрофону запрещен. Разрешите использование микрофона в настройках браузера.":d.name==="NotFoundError"||d.name==="DevicesNotFoundError"?l="Микрофон не найден. Убедитесь, что микрофон подключен.":l=d.message||l),m(l),o(!1),e&&e(l)}},[a,e]),R=c.useCallback(()=>{w.current&&r&&(w.current.stop(),o(!1),u.current&&(clearInterval(u.current),u.current=null),h.current&&(h.current.getTracks().forEach(d=>d.stop()),h.current=null))},[r]),I=c.useCallback(()=>{w.current&&r&&(w.current.stop(),o(!1),N.current=[],y(0),m(null),u.current&&(clearInterval(u.current),u.current=null),h.current&&(h.current.getTracks().forEach(d=>d.stop()),h.current=null))},[r]);return{isRecording:r,isProcessing:i,error:f,recordingDuration:p,startRecording:b,stopRecording:R,cancelRecording:I}}const S=({onSend:a,disabled:e,isLoading:r=!1,onCancel:o})=>{const[i,g]=c.useState(""),f=c.useRef(null),m=()=>{const s=f.current;if(!s)return;if(!i.trim()){s.style.height="48px",s.style.overflowY="hidden";return}s.style.height="48px";const n=s.scrollHeight;if(n<=48+2)s.style.height="48px",s.style.overflowY="hidden";else{const E=Math.min(n,200);s.style.height=`${E}px`,s.style.overflowY=n>200?"auto":"hidden"}};c.useEffect(()=>{m()},[i]),c.useEffect(()=>{m()},[]);const p=()=>{i.trim()&&!e&&(a(i.trim()),g(""))},y=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),p())},w=s=>{const n=s.target;i.trim()?setTimeout(()=>{const x=i.length;n.setSelectionRange(x,x)},0):setTimeout(()=>{n.setSelectionRange(0,0),n.style.height="48px",n.style.overflowY="hidden"},0)},N=(s,n)=>{g(n),setTimeout(()=>{if(f.current){f.current.focus();const x=n.length;f.current.setSelectionRange(x,x)}},0)},h=s=>{console.error("Voice input error:",s)},{isRecording:u,isProcessing:b,startRecording:R,stopRecording:I}=q(N,h),d=()=>{u?I():R()},l=i.trim().length>0,v=!l&&!r,M=l||r;return t.jsxs("div",{className:"w-full max-w-3xl mx-auto relative group",children:[t.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-[1.5rem] blur opacity-20 group-hover:opacity-40 transition-all duration-500 ease-out group-focus-within:opacity-60 group-focus-within:blur-md"}),t.jsxs("div",{className:"relative flex items-end bg-gradient-to-br from-black/70 via-black/60 to-black/70 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-2xl shadow-indigo-500/10 transition-all group-focus-within:border-white/20 group-focus-within:shadow-indigo-500/30 group-focus-within:shadow-lg",children:[t.jsx("textarea",{ref:f,value:i,onChange:s=>g(s.target.value),onKeyDown:y,onFocus:w,placeholder:e?"Подключение...":"Напишите мне ...",disabled:e,rows:1,className:"flex-1 self-start bg-transparent text-white placeholder-white/30 text-base px-3 py-3 focus:outline-none focus:ring-0 resize-none no-scrollbar font-medium",style:{height:"48px",minHeight:"48px",maxHeight:"200px",lineHeight:"24px",boxSizing:"border-box",overflowY:"hidden"}}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 pr-[5px] pl-2 pb-[5px]",children:[!r&&(!l||u)&&t.jsx("button",{onClick:d,disabled:e||b,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${u?"bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95":v?"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]":e||b?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white/80"}`,title:u?"Остановить запись":"Голосовой ввод",children:u?t.jsx(D,{size:18}):t.jsx(O,{size:18})}),M&&t.jsx(t.Fragment,{children:r&&o?t.jsx("button",{onClick:o,className:"p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform bg-red-500/20 text-red-400 hover:bg-red-500/30 shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(239,68,68,0.4)] border border-red-500/30",title:"Остановить генерацию",children:t.jsx(D,{size:18})}):t.jsx("button",{onClick:p,disabled:!l||e||b,className:`p-2.5 rounded-full transition-all duration-300 ease-out will-change-transform ${!l||e||b?"bg-white/5 text-white/20 cursor-not-allowed":"bg-white text-black hover:bg-indigo-50 shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)]"}`,title:"Отправить сообщение",children:t.jsx(F,{size:18,className:"ml-0.5"})})})]})]}),b&&t.jsx("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-indigo-500/20 border border-indigo-500/30 rounded-xl backdrop-blur-sm animate-in fade-in slide-in-from-top-2 duration-300",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-300",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-indigo-400/30 border-t-indigo-400 rounded-full animate-spin"}),t.jsx("span",{children:"Расшифровка..."})]})})]})};S.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{onSend:{required:!0,tsType:{name:"signature",type:"function",raw:"(text: string) => void",signature:{arguments:[{type:{name:"string"},name:"text"}],return:{name:"void"}}},description:""},disabled:{required:!0,tsType:{name:"boolean"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onCancel:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Q={title:"UI/ChatInput",component:S,tags:["autodocs"],parameters:{layout:"centered",backgrounds:{default:"dark",values:[{name:"dark",value:"#000000"}]}}},j={render:()=>{const[a,e]=c.useState([]);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(S,{onSend:r=>{e([...a,r]),console.log("Sent:",r)},disabled:!1}),a.length>0&&t.jsxs("div",{className:"mt-4 p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Отправленные сообщения:"}),t.jsx("ul",{className:"space-y-1",children:a.map((r,o)=>t.jsxs("li",{className:"text-white/80 text-sm",children:["• ",r]},o))})]})]})}},k={render:()=>t.jsx("div",{className:"w-full max-w-3xl",children:t.jsx(S,{onSend:()=>{},disabled:!0})})},T={render:()=>{const[a,e]=c.useState(!1);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(S,{onSend:()=>{e(!0),setTimeout(()=>e(!1),3e3)},disabled:!1,isLoading:a,onCancel:()=>e(!1)}),t.jsx("p",{className:"text-sm text-white/60",children:"Нажмите отправить, чтобы увидеть состояние загрузки"})]})}},_={render:()=>{const[a,e]=c.useState([]);return t.jsxs("div",{className:"w-full max-w-3xl space-y-4",children:[t.jsx(S,{onSend:r=>{e([...a,r])},disabled:!1}),t.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Попробуйте ввести длинный текст - поле автоматически расширится:"}),t.jsx("p",{className:"text-xs text-white/40",children:"Введите несколько строк текста, чтобы увидеть авто-высоту"})]})]})}};j.parameters={...j.parameters,docs:{...j.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
        console.log('Sent:', text);
      }} disabled={false} />
        {messages.length > 0 && <div className="mt-4 p-4 bg-white/5 rounded-lg">
            <p className="text-sm text-white/60 mb-2">Отправленные сообщения:</p>
            <ul className="space-y-1">
              {messages.map((msg, i) => <li key={i} className="text-white/80 text-sm">• {msg}</li>)}
            </ul>
          </div>}
      </div>;
  }
}`,...j.parameters?.docs?.source}}};k.parameters={...k.parameters,docs:{...k.parameters?.docs,source:{originalSource:`{
  render: () => <div className="w-full max-w-3xl">
      <ChatInput onSend={() => {}} disabled={true} />
    </div>
}`,...k.parameters?.docs?.source}}};T.parameters={...T.parameters,docs:{...T.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [isLoading, setIsLoading] = useState(false);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={() => {
        setIsLoading(true);
        setTimeout(() => setIsLoading(false), 3000);
      }} disabled={false} isLoading={isLoading} onCancel={() => setIsLoading(false)} />
        <p className="text-sm text-white/60">Нажмите отправить, чтобы увидеть состояние загрузки</p>
      </div>;
  }
}`,...T.parameters?.docs?.source}}};_.parameters={..._.parameters,docs:{..._.parameters?.docs,source:{originalSource:`{
  render: () => {
    const [messages, setMessages] = useState<string[]>([]);
    return <div className="w-full max-w-3xl space-y-4">
        <ChatInput onSend={text => {
        setMessages([...messages, text]);
      }} disabled={false} />
        <div className="p-4 bg-white/5 rounded-lg">
          <p className="text-sm text-white/60 mb-2">Попробуйте ввести длинный текст - поле автоматически расширится:</p>
          <p className="text-xs text-white/40">Введите несколько строк текста, чтобы увидеть авто-высоту</p>
        </div>
      </div>;
  }
}`,..._.parameters?.docs?.source}}};const W=["Default","Disabled","Loading","LongText"];export{j as Default,k as Disabled,T as Loading,_ as LongText,W as __namedExportsOrder,Q as default};
