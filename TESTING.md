# Руководство по тестированию

## Автоматические тесты

### Backend тесты

Backend тесты используют Jest и Supertest для тестирования API endpoints.

#### Запуск тестов

```bash
cd backend
npm test
```

#### Запуск тестов в watch режиме

```bash
cd backend
npm run test:watch
```

#### Запуск тестов с покрытием

```bash
cd backend
npm run test:coverage
```

#### Тестовые файлы

- `backend/src/routes/__tests__/projects.test.ts` - тесты для API проектов
- `backend/src/routes/__tests__/agents.test.ts` - тесты для API агентов с проектами

#### Тестовая база данных

Тесты используют существующую базу данных (`dev.db`) с автоматической очисткой перед каждым тестом. Для изоляции тестов можно установить переменную окружения `TEST_DATABASE_URL` для использования отдельной тестовой базы.

### Frontend тесты

Frontend тесты используют Vitest и React Testing Library.

#### Запуск тестов

```bash
npm test
```

#### Запуск тестов в UI режиме

```bash
npm run test:ui
```

#### Запуск тестов с покрытием

```bash
npm run test:coverage
```

#### Тестовые файлы

- `components/__tests__/ProjectSelector.test.tsx` - тесты компонента выбора проекта
- `components/__tests__/CreateProjectDialog.test.tsx` - тесты диалога создания проекта
- `components/__tests__/EditProjectDialog.test.tsx` - тесты диалога редактирования проекта

## Ручное тестирование

Для ручного тестирования функционала:

1. Запустите backend сервер:
   ```bash
   cd backend
   npm run dev
   ```

2. Запустите frontend сервер:
   ```bash
   npm run dev
   ```

3. Откройте браузер и перейдите на `http://localhost:5173`

### Чеклист для ручного тестирования

#### CRUD операции с проектами

- [ ] Создать проект через UI
- [ ] Проверить валидацию (пустое название, слишком длинное название)
- [ ] Создать проект с описанием и без описания
- [ ] Проверить, что проект появляется в списке
- [ ] Редактировать проект
- [ ] Удалить проект без агентов
- [ ] Удалить проект с агентами (проверить каскадное удаление)

#### Работа с агентами в контексте проектов

- [ ] Создать агента в проекте
- [ ] Проверить, что нельзя создать агента без активного проекта
- [ ] Переключиться между проектами
- [ ] Проверить, что агенты загружаются для выбранного проекта
- [ ] Проверить, что история чата сохраняется при переключении

#### UI компоненты

- [ ] Проверить ProjectSelector (открытие/закрытие dropdown)
- [ ] Проверить CreateProjectDialog (валидация, создание)
- [ ] Проверить EditProjectDialog (редактирование, удаление)
- [ ] Проверить AdminPage (открытие, возврат)

## Покрытие тестами

### Backend API (40 тестов - все проходят ✅)

- ✅ GET /api/projects - получение всех проектов (3 теста)
- ✅ GET /api/projects/:id - получение конкретного проекта (4 теста)
- ✅ POST /api/projects - создание проекта (5 тестов)
- ✅ PUT /api/projects/:id - обновление проекта (5 тестов)
- ✅ DELETE /api/projects/:id - удаление проекта (5 тестов)
- ✅ GET /api/agents?projectId=... - получение агентов проекта (6 тестов)
- ✅ POST /api/agents - создание агента с projectId (4 теста)
- ✅ PUT /api/agents/:id - обновление агента (4 теста)

**Всего: 40 автоматических тестов для backend API**

### Frontend компоненты (готовы к запуску)

- ✅ ProjectSelector.test.tsx - рендеринг, выбор проекта, создание, редактирование
- ✅ CreateProjectDialog.test.tsx - валидация, создание проекта, обработка ошибок
- ✅ EditProjectDialog.test.tsx - редактирование, удаление, обработка ошибок

**Запуск frontend тестов:**
```bash
npm test
```

