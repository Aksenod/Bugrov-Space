const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/syntax-highlighter-5zN1qsTL.js","assets/markdown-vendor-CiFSpwUK.js","assets/react-vendor-OvXVS5lI.js","assets/index-CKjxuMfv.js"])))=>i.map(i=>d[i]);
import{j as e,r as u}from"./markdown-vendor-CiFSpwUK.js";import{c as H,F as T,X as z,y as je,z as Ne,i as P,D as ke,g as ne,G as Ce,T as re,j as Se,H as Ee}from"./index-BamWYFhK.js";import{U as se}from"./upload-DJSyzsmP.js";import{_ as ie}from"./syntax-highlighter-5zN1qsTL.js";import{A as Pe}from"./arrow-left-DhspESQF.js";import{C as De}from"./calendar-gYLDYGRq.js";import{E as $e}from"./eye-Bql10NMg.js";import"./react-vendor-OvXVS5lI.js";const Ve=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Te=H("download",Ve);const ze=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],J=H("external-link",ze);const Re=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],_e=H("maximize-2",Re);const Me=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Le=H("square-pen",Me),le=(t,r)=>{if(t.agentId){const h=r.find(a=>a.id===t.agentId);if(h)return h.name}const n=t.name.match(/^Summary\s*[-–—]\s*(.+?)\s*[-–—]\s*\d/);if(n&&n[1]){const h=n[1].trim(),a=r.find(s=>s.name===h);return a?a.name:h}const l=t.name.match(/^Документ\s*[-–—]\s*(.+?)\s*[-–—]\s*\d/);return l&&l[1]?l[1].trim():"Документ"},ce=t=>{const r=t.name.split(" - ");return r.length>1?r[r.length-1].trim():t.name},He=t=>{const r=ce(t);try{const n=new Date(r);if(isNaN(n.getTime()))return r;const l=n.getDate().toString().padStart(2,"0"),h=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getFullYear(),s=n.getHours().toString().padStart(2,"0"),o=n.getMinutes().toString().padStart(2,"0");return`${l}.${h}.${a} ${s}:${o}`}catch{return r}},Q=(t,r)=>t?t.split(",").map(l=>l.trim().toLowerCase()).includes(r.toLowerCase()):!1,de=(t,r=[])=>t.name.match(/^(Summary|Документ)\s*[-–—]/)?`${le(t,r)} - ${ce(t)}`:t.name,Ie=t=>He(t),Oe=({documents:t,selectedFileId:r,onSelectFile:n,project:l,onClose:h,onFileUpload:a,isSidebarCollapsed:s,onToggleSidebar:o})=>e.jsxs("div",{className:`border-r border-white/10 flex flex-col bg-black/40 backdrop-blur-xl transition-all duration-300 ease-in-out relative overflow-hidden ${s?"w-[60px] md:!w-[60px]":"w-full md:!w-[280px] md:min-w-[280px]"} ${r?"hidden md:flex":"flex"}`,title:s?`${t.length} ${t.length===1?"документ":t.length<5?"документа":"документов"}`:void 0,style:{transitionProperty:"width",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out",willChange:"width"},children:[e.jsxs("div",{className:`transition-all duration-300 ease-in-out border-b border-white/10 flex flex-col ${s?"p-0 items-center gap-0":"p-4 sm:p-6 gap-2"}`,children:[e.jsxs("div",{className:`transition-opacity duration-300 ease-in-out flex items-center gap-2 ${s?"opacity-0 pointer-events-none max-h-0 overflow-hidden":"opacity-100 pointer-events-auto"}`,style:{maxHeight:s?"0px":"none",transitionProperty:s?"opacity, max-height":"opacity",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out"},children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-amber-500/20 rounded-xl text-amber-400 flex-shrink-0",children:e.jsx(T,{size:18,className:"sm:w-5 sm:h-5"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white truncate",children:l?.name||"Документы"})]}),l?.projectType&&e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-1 ml-11 sm:ml-12 truncate",children:l.projectType.name})]}),e.jsx("button",{onClick:h,className:"md:hidden p-2 text-white/60 hover:text-white hover:bg-white/10 rounded-lg transition-colors flex-shrink-0","aria-label":"Закрыть",children:e.jsx(z,{size:20})}),e.jsx("button",{onClick:o,className:"hidden md:flex p-1.5 text-white/50 hover:text-white hover:bg-white/10 rounded-lg transition-all duration-200 flex-shrink-0","aria-label":"Свернуть панель документов",title:"Свернуть панель",children:e.jsx(je,{size:16})})]}),e.jsxs("div",{className:`flex flex-col items-center ${s?"opacity-100 pointer-events-auto overflow-visible pt-[30px]":"opacity-0 pointer-events-none max-h-0 overflow-hidden"}`,style:{maxWidth:s?"60px":"0px",maxHeight:s?"none":"0px",transitionProperty:s?"opacity, max-width":"opacity, max-width, max-height",transitionDuration:s?"300ms":"0ms",transitionTimingFunction:"ease-in-out"},children:[e.jsxs("button",{onClick:o,className:"relative p-2.5 bg-amber-500/20 hover:bg-amber-500/30 rounded-xl text-amber-400 transition-colors duration-200 group w-full flex items-center justify-center flex-shrink-0 mt-0","aria-label":"Развернуть панель документов",title:`${t.length} ${t.length===1?"документ":t.length<5?"документа":"документов"}`,children:[e.jsx(T,{size:22,className:"group-hover:scale-110 transition-transform duration-200"}),t.length>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 bg-indigo-500 text-white text-[11px] font-bold rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg ring-2 ring-black/60",children:t.length>9?"9+":t.length})]}),a&&e.jsx("button",{onClick:a,className:"w-full p-2.5 text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded-lg transition-colors duration-200 flex items-center justify-center border border-indigo-500/20 hover:border-indigo-500/40 flex-shrink-0 mt-3","aria-label":"Загрузить документ",title:"Загрузить документ",children:e.jsx(se,{size:18})})]}),a&&e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${s?"opacity-0 max-h-0 mt-0 pointer-events-none":"opacity-100 max-h-20 -mt-1 pointer-events-auto"}`,style:{transitionProperty:"opacity, max-height, margin-top",willChange:s?"opacity, max-height":void 0},children:e.jsxs("button",{onClick:a,className:"w-full px-4 py-2.5 border border-white/15 bg-white/8 hover:bg-white/12 text-white/80 hover:text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium",children:[e.jsx(se,{size:16}),"Загрузить"]})})]}),e.jsx("div",{className:`flex-1 overflow-hidden transition-opacity duration-300 ease-in-out ${s?"opacity-0 pointer-events-none":"opacity-100 pointer-events-auto"}`,children:e.jsx("div",{className:"h-full overflow-y-auto md:no-scrollbar",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/40 text-center p-6 border-2 border-dashed border-white/10 rounded-3xl m-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-amber-500/20 blur-xl rounded-full animate-pulse"}),e.jsx(T,{size:40,className:"relative opacity-60"})]}),e.jsx("p",{className:"text-base font-semibold text-white/70 mb-2",children:"Нет документов"}),e.jsx("p",{className:"text-xs text-white/50 max-w-[200px]",children:'Используйте кнопку "Сохранить" в чате для создания отчетов.'})]}):e.jsx("div",{className:"divide-y divide-white/10",children:t.map((d,b)=>e.jsxs("button",{onClick:()=>n(d.id),className:`w-full text-left px-4 py-3 transition-all duration-200 flex items-center gap-3 group relative cursor-pointer ${r===d.id?"bg-white/15":"bg-transparent hover:bg-white/10"}`,children:[r===d.id&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-amber-400"}),e.jsx(T,{size:18,className:`flex-shrink-0 transition-colors duration-200 ${r===d.id?"text-white/90":"text-white/60 group-hover:text-white/80"}`}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("h4",{className:`text-sm font-semibold line-clamp-2 transition-colors duration-200 ${r===d.id?"text-white":"text-white/70 group-hover:text-white/90"}`,children:de(d)})}),e.jsx(Ne,{size:16,className:`flex-shrink-0 transition-colors duration-200 ${r===d.id?"text-white/70":"text-white/40 group-hover:text-white/70"}`})]},d.id))})})})]});let Y=null,K=null;const We=async()=>(Y||(Y=(await ie(()=>import("./syntax-highlighter-5zN1qsTL.js").then(r=>r.cb),__vite__mapDeps([0,1,2]))).Prism),K||(K=(await ie(()=>import("./index-CKjxuMfv.js"),__vite__mapDeps([3,0,1,2]))).vscDarkPlus),{SyntaxHighlighter:Y,vscDarkPlus:K}),Ge=({language:t,children:r,isFullscreenView:n})=>{const[l,h]=u.useState(!1),[a,s]=u.useState(null);if(u.useEffect(()=>{let b=!0;return We().then(({SyntaxHighlighter:m,vscDarkPlus:N})=>{b&&(s({Component:m,style:N}),h(!0))}),()=>{b=!1}},[]),!l||!a)return e.jsx("div",{className:"bg-black/50 p-4 rounded-xl border border-white/10 font-mono text-sm text-white/70",children:r});const{Component:o,style:d}=a;return e.jsx(o,{style:d,language:t,PreTag:"div",customStyle:{margin:0,borderRadius:n?"1.5rem":"1rem",padding:"1.5rem",minHeight:0,maxHeight:"100%"},children:r})},Ae=({documents:t,isOpen:r})=>{const[n,l]=u.useState(null),[h,a]=u.useState(null),s=u.useMemo(()=>h||t.find(o=>o.id===n)||null,[h,t,n]);return u.useEffect(()=>{if(n){const o=t.find(d=>d.id===n);o?a(d=>{if(d&&d.id===n){const b=d.dslContent&&d.dslContent.length>0||d.verstkaContent&&d.verstkaContent.length>0,m=o.dslContent&&o.dslContent.length>0||o.verstkaContent&&o.verstkaContent.length>0;if(b&&!m)return d}return o}):(l(null),a(null))}else a(null)},[t,n]),u.useEffect(()=>{},[r]),{selectedFileId:n,setSelectedFileId:l,localSelectedFile:h,setLocalSelectedFile:a,selectedFile:s}},Xe=({selectedFile:t,agents:r,isOpen:n})=>{const[l,h]=u.useState("text"),[a,s]=u.useState("preview"),o=d=>{h(d),s("preview")};return u.useEffect(()=>{if(t){const d=r,b=t.agentId?d.find(N=>N.id===t.agentId):null;b&&Q(b?.role,"verstka")?(o("prototype"),s("preview")):(o("text"),s("preview"))}},[t?.id,n,r]),{activeTab:l,setActiveTab:o,prototypeSubTab:a,setPrototypeSubTab:s}},qe=({selectedFile:t,onDocumentUpdate:r,onShowAlert:n})=>{const[l,h]=u.useState(!1),[a,s]=u.useState(""),[o,d]=u.useState(!1);u.useEffect(()=>{t||(h(!1),s(""))},[t?.id]);const b=c=>{try{return decodeURIComponent(escape(window.atob(c)))}catch{return"Не удалось прочитать файл или это бинарный файл."}};return{isEditing:l,editedContent:a,setEditedContent:s,isSaving:o,handleEdit:()=>{if(!t)return;const c=b(t.data);s(c),h(!0)},handleCancelEdit:()=>{h(!1),s("")},handleSaveEdit:async()=>{if(t){d(!0);try{const c=window.btoa(unescape(encodeURIComponent(a))),{file:v}=await P.updateFileContent(t.id,c),E={id:v.id,name:v.name,type:v.mimeType,data:v.content,agentId:v.agentId,dslContent:v.dslContent,verstkaContent:v.verstkaContent};r&&r(E),h(!1),s(""),n&&n("Документ успешно обновлен","Успех","success")}catch(c){console.error("Failed to update file:",c),n&&n(`Не удалось обновить документ: ${c?.message||"Неизвестная ошибка"}`,"Ошибка","error")}finally{d(!1)}}},decodeContent:b}},Be=5e3,Je=300*1e3,L=t=>`prototype-generation-${t}`,Ye=(t,r)=>{try{localStorage.setItem(L(t),JSON.stringify({fileId:t,timestamp:r}))}catch{}},oe=t=>{try{const r=localStorage.getItem(L(t));if(!r)return null;const n=JSON.parse(r);return Date.now()-n.timestamp>Je?(localStorage.removeItem(L(t)),null):n}catch{return null}},ae=t=>{try{localStorage.removeItem(L(t))}catch{}},Ke=({selectedFile:t,documentCreatorAgent:r,selectedFileId:n,onDocumentUpdate:l,onShowAlert:h,setActiveTab:a,setPrototypeVersions:s,setSelectedVersionNumber:o})=>{const[d,b]=u.useState(!1),m=u.useRef(null),N=u.useRef(0),j=u.useRef(!1),c=u.useRef({onDocumentUpdate:l,onShowAlert:h,setActiveTab:a,setPrototypeVersions:s,setSelectedVersionNumber:o,selectedFile:t});u.useEffect(()=>{c.current={onDocumentUpdate:l,onShowAlert:h,setActiveTab:a,setPrototypeVersions:s,setSelectedVersionNumber:o,selectedFile:t}},[l,h,a,s,o,t]),u.useEffect(()=>(n&&oe(n)&&(b(!0),j.current=!0,P.getPrototypeVersions(n).then(({versions:g})=>{N.current=g.length,c.current.setPrototypeVersions(g),g.length>0&&c.current.setSelectedVersionNumber(g[0].versionNumber),v()}).catch(g=>{console.error("Failed to initialize versions count:",g),N.current=0,v()})),()=>{m.current&&(clearInterval(m.current),m.current=null)}),[n]);const v=()=>{m.current&&clearInterval(m.current),m.current=setInterval(async()=>{if(!n||!j.current){m.current&&(clearInterval(m.current),m.current=null);return}try{const{versions:p}=await P.getPrototypeVersions(n),g=p.length;if(g>N.current){b(!1),j.current=!1,ae(n),m.current&&(clearInterval(m.current),m.current=null),c.current.setPrototypeVersions(p),p.length>0&&c.current.setSelectedVersionNumber(p[0].versionNumber);const S=c.current.selectedFile;if(S&&c.current.onDocumentUpdate)try{const{versions:y}=await P.getPrototypeVersions(n);if(y.length>0){const D=y[0],x={...S,dslContent:D.dslContent||void 0,verstkaContent:D.verstkaContent||void 0};c.current.onDocumentUpdate(x)}}catch(y){console.error("Failed to update file after generation:",y)}c.current.onShowAlert&&c.current.onShowAlert("Прототип успешно сгенерирован","Успех","success",4e3),setTimeout(()=>{c.current.setActiveTab("prototype")},100)}else N.current=g,c.current.setPrototypeVersions(p)}catch(p){console.error("Failed to check prototype versions:",p),oe(n)||(b(!1),j.current=!1,m.current&&(clearInterval(m.current),m.current=null),c.current.onShowAlert&&c.current.onShowAlert("Генерация прототипа прервана или завершилась с ошибкой","Предупреждение","warning"))}},Be)};return{isGeneratingPrototype:d,handleGenerateResult:async()=>{if(!(!t||!r)){if(b(!0),j.current=!0,n){try{const{versions:p}=await P.getPrototypeVersions(n);N.current=p.length}catch(p){console.error("Failed to get initial versions count:",p),N.current=0}Ye(n,Date.now())}v(),P.generatePrototype(r.id,t.id).then(()=>{}).catch(p=>{b(!1),j.current=!1,n&&ae(n),m.current&&(clearInterval(m.current),m.current=null),c.current.onShowAlert&&c.current.onShowAlert(`Не удалось сгенерировать прототип: ${p?.message||"Неизвестная ошибка"}`,"Ошибка","error")})}}}},Qe=({selectedFileId:t,activeTab:r,documents:n,isOpen:l})=>{const[h,a]=u.useState([]),[s,o]=u.useState(null),[d,b]=u.useState(!1),[m,N]=u.useState(!1),j=u.useRef(null),c=u.useRef(null),v=u.useRef(n);return u.useEffect(()=>{c.current=s},[s]),u.useEffect(()=>{v.current=n},[n]),u.useEffect(()=>{(async()=>{if(!t||r!=="prototype"){a([]),o(null),j.current=t;return}const p=v.current.find(y=>y.id===t);if(!p||!p.verstkaContent&&!p.dslContent){a([]),o(null),j.current=t;return}const g=j.current!==t,S=g?null:c.current;b(!0);try{const{versions:y}=await P.getPrototypeVersions(t);if(a(y),g||S===null)if(y.length>0){const D=y[0].versionNumber;o(D),c.current=D}else o(null),c.current=null;else if(y.some(x=>x.versionNumber===S))o(x=>x===S?x:S),c.current=S;else if(y.length>0){const x=y[0].versionNumber;o(x),c.current=x}else o(null),c.current=null;j.current=t}catch(y){console.error("Failed to load prototype versions:",y),a([]),o(null),c.current=null,j.current=t}finally{b(!1)}})()},[t,r,l]),u.useEffect(()=>{const E=p=>{m&&(p.target.closest(".version-dropdown-container")||N(!1))};return document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},[m,l]),{prototypeVersions:h,setPrototypeVersions:a,selectedVersionNumber:s,setSelectedVersionNumber:o,isLoadingVersions:d,isVersionDropdownOpen:m,setIsVersionDropdownOpen:N}},Ue=(t,r,n,l)=>{if(!t)return null;if(n!==null){const h=r.find(a=>a.versionNumber===n);if(h)return l==="dsl"?h.dslContent||null:h.verstkaContent||null}return l==="dsl"?t.dslContent||null:t.verstkaContent||null},ot=({onClose:t,documents:r,onRemoveFile:n,agents:l=[],project:h,onFileUpload:a,onDocumentUpdate:s,onShowAlert:o,onShowConfirm:d,currentUser:b})=>{const{shouldShowStep:m,completeStep:N}=ke(),[j,c]=u.useState(!1),[v,E]=u.useState(!1),p=b?.role==="admin",{selectedFileId:g,setSelectedFileId:S,localSelectedFile:y,setLocalSelectedFile:D,selectedFile:x}=Ae({documents:r,isOpen:!0}),{activeTab:k,setActiveTab:I,prototypeSubTab:C,setPrototypeSubTab:O}=Xe({selectedFile:x,agents:l,isOpen:!0}),{isEditing:W,editedContent:ue,setEditedContent:he,isSaving:G,handleEdit:xe,handleCancelEdit:me,handleSaveEdit:fe,decodeContent:pe}=qe({selectedFile:x,onDocumentUpdate:s,onShowAlert:o}),{prototypeVersions:R,setPrototypeVersions:U,selectedVersionNumber:$,setSelectedVersionNumber:_,isVersionDropdownOpen:A,setIsVersionDropdownOpen:X}=Qe({selectedFileId:g,activeTab:k,documents:r,isOpen:!0}),V=x?.agentId?l.find(i=>i.id===x.agentId):null,M=V&&Q(V.role,"copywriter"),q=V&&Q(V.role,"verstka"),{isGeneratingPrototype:Z,handleGenerateResult:be}=Ke({selectedFile:x,documentCreatorAgent:V,selectedFileId:g,onDocumentUpdate:s,onShowAlert:o,setActiveTab:I,setPrototypeVersions:U,setSelectedVersionNumber:_});u.useEffect(()=>{const i=localStorage.getItem("documents-sidebar-collapsed");i!==null&&c(i==="true")},[]);const ge=()=>{const i=!j;c(i),localStorage.setItem("documents-sidebar-collapsed",String(i))},we=(i,f)=>{f.stopPropagation();const w=document.createElement("a");w.href=`data:${i.type};base64,${i.data}`,w.download=i.name,document.body.appendChild(w),w.click(),document.body.removeChild(w)},ve=async(i,f)=>{f.stopPropagation(),n&&(g===i&&(S(null),D(null)),n(i))},B=()=>{const i=y||x;if(!i)return;const f=$!==null?`?v=${$}`:"",w=`${window.location.origin}/#/prototype/${i.id}${f}`;window.open(w,"_blank")},F=()=>{const i=y||x;return i?k==="text"?i.data:k==="prototype"?Ue(i,R,$,C):null:null},ee=(i=!1)=>{const f=F();return C==="dsl"||C==="html"?f?e.jsx("div",{className:"overflow-auto w-full flex-1 flex flex-col",style:{minHeight:0,maxHeight:"100%"},children:e.jsx(Ge,{language:C==="dsl"?"markdown":"html",isFullscreenView:i,children:f})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:[e.jsx("p",{className:"text-base font-medium mb-2",children:C==="dsl"?"DSL код еще не сгенерирован":"HTML код еще не сгенерирован"}),e.jsx("p",{className:"text-sm text-white/20",children:C==="dsl"?"Контент появится после генерации DSL агентом":"Контент появится после генерации Верстальщиком"})]}):f?e.jsx("div",{className:"w-full flex-1 relative",style:{minHeight:0,maxHeight:"100%"},children:e.jsx("iframe",{srcDoc:f,className:"absolute inset-0 w-full h-full border-0 rounded-xl",title:"HTML Preview",sandbox:"allow-same-origin allow-scripts"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:[e.jsx("p",{className:"text-base font-medium mb-2",children:"Прототип еще не сгенерирован"}),e.jsx("p",{className:"text-sm text-white/20",children:'Используйте кнопку "Сгенерировать прототип" для создания HTML-макета'})]})};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-black via-black to-indigo-950/20 flex flex-col overflow-hidden",style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsx(Oe,{documents:r,selectedFileId:g,onSelectFile:S,project:h,onClose:t,onFileUpload:a,isSidebarCollapsed:j,onToggleSidebar:ge}),e.jsxs("div",{className:`flex-1 md:flex flex-col bg-black relative min-h-0 transition-all duration-300 ease-in-out ${x?"flex":"hidden md:flex"}`,style:{width:j?"calc(100% - 60px)":void 0,transitionProperty:"width",willChange:"width"},children:[e.jsxs("div",{className:"md:hidden sticky top-0 z-20 p-4 border-b border-white/10 flex items-center gap-3 bg-black/60 backdrop-blur-md flex-shrink-0",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 1rem)"},children:[e.jsx("button",{onClick:()=>S(null),className:"p-2.5 text-white hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors","aria-label":"К списку документов",children:e.jsx(Pe,{size:20,className:"font-bold"})}),e.jsx("span",{className:"font-medium truncate text-white",children:x?de(x,l):""}),e.jsx("button",{onClick:t,className:"ml-auto p-2.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Закрыть",children:e.jsx(z,{size:20})})]}),e.jsx("div",{className:"absolute top-6 right-6 z-10 hidden md:block",children:e.jsx("button",{onClick:t,className:"p-2.5 bg-black/60 backdrop-blur-md hover:bg-white/10 rounded-full text-white/70 hover:text-white transition-colors border border-white/10 shadow-lg",children:e.jsx(z,{size:20})})}),x?e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto scrollbar-thin p-4 md:p-8 lg:p-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto w-full h-full flex flex-col",children:[!(k==="prototype"&&C==="preview")&&!(k==="prototype"&&q&&C!=="preview"&&v)&&e.jsxs("div",{className:"mb-8 pb-6 border-b border-white/10",children:[e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-400 text-xs font-bold tracking-wider uppercase",children:x?le(x,l):"Документ"})}),e.jsxs("div",{className:"flex items-center justify-between gap-6 text-sm text-white/40",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(De,{size:14})," ",x?Ie(x):new Date().toLocaleString()]}),q&&C==="preview"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>E(!0),className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5",children:[e.jsx(_e,{size:16}),"Развернуть"]}),e.jsxs("button",{onClick:B,className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5",children:[e.jsx(J,{size:16}),"Открыть в новой вкладке"]})]})]}),e.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-2 bg-indigo-500/10 border border-indigo-500/30 rounded-xl shadow-lg shadow-indigo-500/10 hover:bg-indigo-500/15 hover:border-indigo-500/40 transition-all duration-200",children:[k==="text"&&!x.type.includes("image")&&(W?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:me,disabled:G,className:"p-2.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-all disabled:opacity-50",title:"Отменить","aria-label":"Отменить редактирование",children:e.jsx(z,{size:18})}),e.jsx("button",{onClick:fe,disabled:G,className:"p-2.5 text-green-400 hover:text-green-300 hover:bg-green-500/10 rounded-lg transition-all disabled:opacity-50",title:"Сохранить","aria-label":"Сохранить изменения",children:G?e.jsx(ne,{size:18,className:"animate-spin"}):e.jsx(Ce,{size:18})})]}):e.jsx("button",{onClick:xe,className:"p-2.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-all",title:"Редактировать","aria-label":"Редактировать документ",children:e.jsx(Le,{size:18})})),e.jsx("button",{onClick:i=>we(x,i),className:"p-2.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-all",title:"Скачать","aria-label":"Скачать документ",children:e.jsx(Te,{size:18})}),n&&e.jsx("button",{onClick:i=>ve(x.id,i),className:"p-2.5 text-white/80 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-all",title:"Удалить","aria-label":"Удалить документ",children:e.jsx(re,{size:18})})]})]})]}),(M||p)&&e.jsx("div",{className:"mb-6 w-full",children:e.jsxs("div",{className:"w-full rounded-xl border border-white/10 bg-white/5 p-3 space-y-2 md:p-3 md:space-y-2",children:[e.jsx("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:gap-2 md:space-y-0",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto snap-x md:flex-1",role:"tablist",children:[e.jsx("button",{role:"tab","aria-selected":k==="text","aria-controls":"documents-tab-text",onClick:()=>I("text"),className:`flex-1 min-w-[108px] snap-start h-8 px-2 text-[11px] font-semibold rounded-lg border md:min-w-[128px] md:h-9 md:px-3 md:text-xs ${k==="text"?"bg-white/10 text-white border-white/10":"text-white/70 border-transparent hover:text-white"} focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/60`,children:"Текст"}),e.jsx("button",{role:"tab","aria-selected":k==="prototype","aria-controls":"documents-tab-prototype",onClick:()=>I("prototype"),className:`flex-1 min-w-[108px] snap-start h-8 px-2 text-[11px] font-semibold rounded-lg border md:min-w-[128px] md:h-9 md:px-3 md:text-xs ${k==="prototype"?"bg-white/10 text-white border-white/10":"text-white/70 border-transparent hover:text-white"} focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/60`,children:"Прототип"})]})}),k==="prototype"&&e.jsxs("div",{className:"flex flex-col gap-2 md:gap-3",children:[M&&p&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O("preview"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${C==="preview"?"bg-white/10 text-white":"text-white/40 hover:text-white/80 hover:bg-white/5"}`,children:"Preview"}),e.jsx("button",{onClick:()=>O("dsl"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${C==="dsl"?"bg-white/10 text-white":"text-white/40 hover:text-white/80 hover:bg-white/5"}`,children:"DSL"}),e.jsx("button",{onClick:()=>O("html"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${C==="html"?"bg-white/10 text-white":"text-white/40 hover:text-white/80 hover:bg-white/5"}`,children:"HTML"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full flex-wrap",children:[R.length>0?e.jsxs("div",{className:"relative version-dropdown-container",children:[e.jsxs("button",{onClick:()=>X(!A),className:"inline-flex items-center gap-1.5 rounded-md border border-white/15 bg-white/8 h-8 px-3 text-[11px] font-semibold text-white/80 hover:bg-white/12 hover:text-white active:bg-white/15 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/60 md:h-9 md:text-xs",title:"Выбрать версию",children:[e.jsxs("span",{children:["Ver ",$||"?"]}),e.jsx(Se,{size:14,className:A?"rotate-180":""})]}),A&&e.jsx("div",{className:"absolute left-0 top-full mt-1 bg-black/95 backdrop-blur-md border border-white/10 rounded-lg shadow-xl z-50 min-w-[200px] max-h-[200px] overflow-y-auto version-dropdown-container",children:R.map(i=>e.jsxs("div",{className:`flex items-center justify-between group ${$===i.versionNumber?"bg-cyan-500/20":""}`,children:[e.jsxs("button",{onClick:()=>{_(i.versionNumber),X(!1)},className:`flex-1 text-left px-3 py-2 text-xs transition-colors ${$===i.versionNumber?"text-cyan-400":"text-white/70 hover:text-white hover:bg-white/5"}`,children:["Ver ",i.versionNumber]}),R.length>1&&d&&e.jsx("button",{onClick:f=>{f.stopPropagation(),X(!1),d&&d("Удалить версию",`Вы уверены, что хотите удалить версию ${i.versionNumber}? Это действие нельзя отменить.`,async()=>{try{await P.deletePrototypeVersion(g,i.versionNumber);const{versions:w}=await P.getPrototypeVersions(g);if(U(w),$===i.versionNumber&&(w.length>0?_(w[0].versionNumber):_(null)),s&&x){const te=r.find(ye=>ye.id===g);te&&s(te)}o&&o("Версия успешно удалена","Успех","success")}catch(w){console.error("Failed to delete version:",w),o&&o(`Не удалось удалить версию: ${w?.message||"Неизвестная ошибка"}`,"Ошибка","error")}},"danger")},className:"px-2 py-2 text-xs text-red-400 hover:text-red-300 hover:bg-red-500/10 opacity-0 group-hover:opacity-100 transition-opacity",title:"Удалить версию",children:e.jsx(re,{size:12})})]},i.id))})]}):e.jsx("span",{className:"inline-flex items-center gap-1 rounded-md bg-white/5 border border-white/10 px-2.5 py-1 text-xs text-white/70",children:"Ver нет"}),M&&!W&&e.jsx("button",{onClick:i=>{i.preventDefault(),be()},disabled:Z,className:"flex-1 min-w-[120px] inline-flex items-center justify-center gap-2 rounded-md h-9 px-3 text-xs font-semibold text-white bg-indigo-500 hover:bg-indigo-400 active:bg-indigo-500/90 shadow-[0_10px_30px_-12px_rgba(99,102,241,0.45)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400/60 focus-visible:ring-offset-2 focus-visible:ring-offset-black disabled:opacity-60 disabled:cursor-not-allowed md:h-9 md:px-3 md:text-xs",children:Z?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:16,className:"animate-spin"}),"Генерация..."]}):e.jsx(e.Fragment,{children:"⚡ Сгенерировать"})}),e.jsxs("button",{onClick:B,className:"inline-flex items-center gap-1.5 rounded-md border border-white/15 bg-white/8 h-9 px-3 text-xs font-semibold text-white/80 hover:bg-white/12 hover:text-white active:bg-white/15 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/60 transition-colors md:h-9 md:px-3 md:text-xs",title:"Открыть в новом окне",children:[e.jsx(J,{size:14}),e.jsx("span",{className:"sr-only md:inline",children:"Открыть"})]})]})]})]})}),e.jsx("div",{ref:i=>{if(i){const f=window.getComputedStyle(i);fetch("http://127.0.0.1:7242/ingest/9d98fffd-a48f-4d13-a7f2-828626c8ca26",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"DocumentsPage.tsx:563",message:"Content container mounted",data:{containerWidth:f.width,containerMinWidth:f.minWidth,containerMaxWidth:f.maxWidth,containerOverflowX:f.overflowX,containerOverflowY:f.overflowY,containerDisplay:f.display,containerFlexDirection:f.flexDirection,containerClientWidth:i.clientWidth,containerScrollWidth:i.scrollWidth},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{})}},className:"bg-black/50 backdrop-blur-sm border-[5px] border-white/10 shadow-inner rounded-[2rem] overflow-y-auto flex-1 p-4 sm:p-6 md:p-8 min-w-0 max-w-full",style:{margin:0,display:"flex",flexDirection:"column",maxHeight:"100%",overflowX:"visible"},children:x&&x.type.includes("image")&&k==="text"?e.jsx("img",{src:`data:${x.type};base64,${x.data}`,alt:"Preview",className:"max-w-full h-auto rounded-2xl shadow-2xl"}):(()=>{if(!x)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/40 text-center px-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-xl rounded-full animate-pulse"}),e.jsx(T,{size:40,className:"relative opacity-50"})]}),e.jsx("p",{className:"text-base font-semibold text-white/60",children:"Выберите документ для просмотра"})]});const i=F();return k==="prototype"&&M||q?ee():i===null?e.jsx("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:e.jsx("p",{className:"text-base font-medium mb-2",children:"Нет контента"})}):W?e.jsx("textarea",{value:ue,onChange:f=>he(f.target.value),className:"w-full h-full min-h-[500px] bg-black/30 text-white p-4 rounded-xl border border-white/10 focus:border-white/30 focus:outline-none resize-none font-mono text-sm",placeholder:"Введите текст документа..."}):e.jsx("div",{ref:f=>{if(f){const w=window.getComputedStyle(f);fetch("http://127.0.0.1:7242/ingest/9d98fffd-a48f-4d13-a7f2-828626c8ca26",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"DocumentsPage.tsx:607",message:"Prose wrapper mounted",data:{proseWidth:w.width,proseMinWidth:w.minWidth,proseMaxWidth:w.maxWidth,proseOverflowX:w.overflowX,proseDisplay:w.display},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"B,E"})}).catch(()=>{})}},className:"max-w-none break-words w-full",style:{overflowX:"visible",minWidth:0},children:e.jsx(Ee,{content:pe(i)})})})()})]})}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-white/30 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-2xl rounded-full animate-pulse"}),e.jsx("div",{className:"relative w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx($e,{size:48,className:"opacity-50"})})]}),e.jsx("p",{className:"text-lg font-semibold text-white/60 mb-2",children:"Выберите документ"}),e.jsx("p",{className:"text-sm text-white/40 text-center max-w-sm",children:"Выберите документ из списка слева для просмотра"})]})]})]}),v&&k==="prototype"&&C==="preview"&&e.jsxs("div",{className:"fixed inset-0 z-[60] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/80 backdrop-blur-md border-b border-white/10",children:[e.jsx("h3",{className:"text-white font-medium",children:"Просмотр верстки"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:B,className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5 transition-colors",children:[e.jsx(J,{size:16}),"Открыть в новой вкладке"]}),e.jsx("button",{onClick:()=>E(!1),className:"p-2 text-white/70 hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(z,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-8",children:e.jsx("div",{className:"w-full h-full bg-black/40 border border-white/10 rounded-2xl p-4",children:ee(!0)})})]})]})};export{ot as DocumentsPage};
