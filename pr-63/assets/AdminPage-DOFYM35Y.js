import{r as a,R as le,j as t}from"./markdown-vendor-CiFSpwUK.js";import{c as _e,r as ht,L as B,B as Js,d as Pt,e as ss,Z as Qs,R as Jn,S as ns,f as Qn,W as Zn,g as ge,h as er,i as $,P as ms,j as Zs,M as rs,X as zt,T as Ot,k as Ms,l as tr,I as $e,m as Yt,F as sr,n as nr,o as rr,A as ir}from"./index-Cwby3Rey.js";import{S as or,G as qt}from"./search-D4CK3-DB.js";import{C as ar}from"./calendar-Di6BDbAq.js";import{U as lr}from"./users-DeOd5Yom.js";import{P as Et}from"./panels-top-left-CMu4TdIi.js";import{C as Is}from"./code-xml-B2PufeOz.js";import{U as cr}from"./upload-D3I9Acxx.js";import"./react-vendor-OvXVS5lI.js";import"./syntax-highlighter-C2HkY6UG.js";const dr=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Kt=_e("arrow-down",dr);const ur=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Vt=_e("arrow-up",ur);const mr=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],xr=_e("file-check",mr);const hr=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],pr=_e("funnel",hr);const fr=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],gr=_e("gift",fr);const br=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],vr=_e("grip-vertical",br);const wr=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],yr=_e("pen-line",wr);const jr=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Jt=_e("shield",jr);function Nr(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return a.useMemo(()=>r=>{s.forEach(i=>i(r))},s)}const Ut=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function it(e){const s=Object.prototype.toString.call(e);return s==="[object Window]"||s==="[object global]"}function xs(e){return"nodeType"in e}function ce(e){var s,n;return e?it(e)?e:xs(e)&&(s=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function hs(e){const{Document:s}=ce(e);return e instanceof s}function yt(e){return it(e)?!1:e instanceof ce(e).HTMLElement}function en(e){return e instanceof ce(e).SVGElement}function ot(e){return e?it(e)?e.document:xs(e)?hs(e)?e:yt(e)||en(e)?e.ownerDocument:document:document:document}const Ie=Ut?a.useLayoutEffect:a.useEffect;function ps(e){const s=a.useRef(e);return Ie(()=>{s.current=e}),a.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return s.current==null?void 0:s.current(...r)},[])}function Sr(){const e=a.useRef(null),s=a.useCallback((r,i)=>{e.current=setInterval(r,i)},[]),n=a.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[s,n]}function bt(e,s){s===void 0&&(s=[e]);const n=a.useRef(e);return Ie(()=>{n.current!==e&&(n.current=e)},s),n}function jt(e,s){const n=a.useRef();return a.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...s])}function Lt(e){const s=ps(e),n=a.useRef(null),r=a.useCallback(i=>{i!==n.current&&s?.(i,n.current),n.current=i},[]);return[n,r]}function is(e){const s=a.useRef();return a.useEffect(()=>{s.current=e},[e]),s.current}let Qt={};function Nt(e,s){return a.useMemo(()=>{if(s)return s;const n=Qt[e]==null?0:Qt[e]+1;return Qt[e]=n,e+"-"+n},[e,s])}function tn(e){return function(s){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((o,l)=>{const c=Object.entries(l);for(const[u,h]of c){const p=o[u];p!=null&&(o[u]=p+e*h)}return o},{...s})}}const rt=tn(1),$t=tn(-1);function Cr(e){return"clientX"in e&&"clientY"in e}function fs(e){if(!e)return!1;const{KeyboardEvent:s}=ce(e.target);return s&&e instanceof s}function kr(e){if(!e)return!1;const{TouchEvent:s}=ce(e.target);return s&&e instanceof s}function os(e){if(kr(e)){if(e.touches&&e.touches.length){const{clientX:s,clientY:n}=e.touches[0];return{x:s,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:s,clientY:n}=e.changedTouches[0];return{x:s,y:n}}}return Cr(e)?{x:e.clientX,y:e.clientY}:null}const vt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:s,y:n}=e;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:s,scaleY:n}=e;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[vt.Translate.toString(e),vt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:s,duration:n,easing:r}=e;return s+" "+n+"ms "+r}}}),Ps="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Dr(e){return e.matches(Ps)?e:e.querySelector(Ps)}const Tr={display:"none"};function Rr(e){let{id:s,value:n}=e;return le.createElement("div",{id:s,style:Tr},n)}function Ar(e){let{id:s,announcement:n,ariaLiveType:r="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return le.createElement("div",{id:s,style:i,role:"status","aria-live":r,"aria-atomic":!0},n)}function Er(){const[e,s]=a.useState("");return{announce:a.useCallback(r=>{r!=null&&s(r)},[]),announcement:e}}const sn=a.createContext(null);function Mr(e){const s=a.useContext(sn);a.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(e)},[e,s])}function Ir(){const[e]=a.useState(()=>new Set),s=a.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[a.useCallback(r=>{let{type:i,event:o}=r;e.forEach(l=>{var c;return(c=l[i])==null?void 0:c.call(l,o)})},[e]),s]}const Pr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},zr={onDragStart(e){let{active:s}=e;return"Picked up draggable item "+s.id+"."},onDragOver(e){let{active:s,over:n}=e;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(e){let{active:s,over:n}=e;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(e){let{active:s}=e;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function Fr(e){let{announcements:s=zr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:i=Pr}=e;const{announce:o,announcement:l}=Er(),c=Nt("DndLiveRegion"),[u,h]=a.useState(!1);if(a.useEffect(()=>{h(!0)},[]),Mr(a.useMemo(()=>({onDragStart(m){let{active:b}=m;o(s.onDragStart({active:b}))},onDragMove(m){let{active:b,over:x}=m;s.onDragMove&&o(s.onDragMove({active:b,over:x}))},onDragOver(m){let{active:b,over:x}=m;o(s.onDragOver({active:b,over:x}))},onDragEnd(m){let{active:b,over:x}=m;o(s.onDragEnd({active:b,over:x}))},onDragCancel(m){let{active:b,over:x}=m;o(s.onDragCancel({active:b,over:x}))}}),[o,s])),!u)return null;const p=le.createElement(le.Fragment,null,le.createElement(Rr,{id:r,value:i.draggable}),le.createElement(Ar,{id:c,announcement:l}));return n?ht.createPortal(p,n):p}var K;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(K||(K={}));function Gt(){}function zs(e,s){return a.useMemo(()=>({sensor:e,options:s??{}}),[e,s])}function Or(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return a.useMemo(()=>[...s].filter(r=>r!=null),[...s])}const Ce=Object.freeze({x:0,y:0});function Lr(e,s){return Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))}function $r(e,s){let{data:{value:n}}=e,{data:{value:r}}=s;return n-r}function Gr(e,s){let{data:{value:n}}=e,{data:{value:r}}=s;return r-n}function Fs(e){let{left:s,top:n,height:r,width:i}=e;return[{x:s,y:n},{x:s+i,y:n},{x:s,y:n+r},{x:s+i,y:n+r}]}function _r(e,s){if(!e||e.length===0)return null;const[n]=e;return n[s]}const Ur=e=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=e;const i=Fs(s),o=[];for(const l of r){const{id:c}=l,u=n.get(c);if(u){const h=Fs(u),p=i.reduce((b,x,w)=>b+Lr(h[w],x),0),m=Number((p/4).toFixed(4));o.push({id:c,data:{droppableContainer:l,value:m}})}}return o.sort($r)};function Br(e,s){const n=Math.max(s.top,e.top),r=Math.max(s.left,e.left),i=Math.min(s.left+s.width,e.left+e.width),o=Math.min(s.top+s.height,e.top+e.height),l=i-r,c=o-n;if(r<i&&n<o){const u=s.width*s.height,h=e.width*e.height,p=l*c,m=p/(u+h-p);return Number(m.toFixed(4))}return 0}const Wr=e=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=e;const i=[];for(const o of r){const{id:l}=o,c=n.get(l);if(c){const u=Br(c,s);u>0&&i.push({id:l,data:{droppableContainer:o,value:u}})}}return i.sort(Gr)};function Hr(e,s,n){return{...e,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function nn(e,s){return e&&s?{x:e.left-s.left,y:e.top-s.top}:Ce}function Xr(e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i.reduce((l,c)=>({...l,top:l.top+e*c.y,bottom:l.bottom+e*c.y,left:l.left+e*c.x,right:l.right+e*c.x}),{...n})}}const Yr=Xr(1);function qr(e){if(e.startsWith("matrix3d(")){const s=e.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(e.startsWith("matrix(")){const s=e.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function Kr(e,s,n){const r=qr(s);if(!r)return e;const{scaleX:i,scaleY:o,x:l,y:c}=r,u=e.left-l-(1-i)*parseFloat(n),h=e.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),p=i?e.width/i:e.width,m=o?e.height/o:e.height;return{width:p,height:m,top:h,right:u+p,bottom:h+m,left:u}}const Vr={ignoreTransform:!1};function at(e,s){s===void 0&&(s=Vr);let n=e.getBoundingClientRect();if(s.ignoreTransform){const{transform:h,transformOrigin:p}=ce(e).getComputedStyle(e);h&&(n=Kr(n,h,p))}const{top:r,left:i,width:o,height:l,bottom:c,right:u}=n;return{top:r,left:i,width:o,height:l,bottom:c,right:u}}function Os(e){return at(e,{ignoreTransform:!0})}function Jr(e){const s=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function Qr(e,s){return s===void 0&&(s=ce(e).getComputedStyle(e)),s.position==="fixed"}function Zr(e,s){s===void 0&&(s=ce(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const o=s[i];return typeof o=="string"?n.test(o):!1})}function gs(e,s){const n=[];function r(i){if(s!=null&&n.length>=s||!i)return n;if(hs(i)&&i.scrollingElement!=null&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!yt(i)||en(i)||n.includes(i))return n;const o=ce(e).getComputedStyle(i);return i!==e&&Zr(i,o)&&n.push(i),Qr(i,o)?n:r(i.parentNode)}return e?r(e):n}function rn(e){const[s]=gs(e,1);return s??null}function Zt(e){return!Ut||!e?null:it(e)?e:xs(e)?hs(e)||e===ot(e).scrollingElement?window:yt(e)?e:null:null}function on(e){return it(e)?e.scrollX:e.scrollLeft}function an(e){return it(e)?e.scrollY:e.scrollTop}function as(e){return{x:on(e),y:an(e)}}var Q;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Q||(Q={}));function ln(e){return!Ut||!e?!1:e===document.scrollingElement}function cn(e){const s={x:0,y:0},n=ln(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=s.y,o=e.scrollLeft<=s.x,l=e.scrollTop>=r.y,c=e.scrollLeft>=r.x;return{isTop:i,isLeft:o,isBottom:l,isRight:c,maxScroll:r,minScroll:s}}const ei={x:.2,y:.2};function ti(e,s,n,r,i){let{top:o,left:l,right:c,bottom:u}=n;r===void 0&&(r=10),i===void 0&&(i=ei);const{isTop:h,isBottom:p,isLeft:m,isRight:b}=cn(e),x={x:0,y:0},w={x:0,y:0},v={height:s.height*i.y,width:s.width*i.x};return!h&&o<=s.top+v.height?(x.y=Q.Backward,w.y=r*Math.abs((s.top+v.height-o)/v.height)):!p&&u>=s.bottom-v.height&&(x.y=Q.Forward,w.y=r*Math.abs((s.bottom-v.height-u)/v.height)),!b&&c>=s.right-v.width?(x.x=Q.Forward,w.x=r*Math.abs((s.right-v.width-c)/v.width)):!m&&l<=s.left+v.width&&(x.x=Q.Backward,w.x=r*Math.abs((s.left+v.width-l)/v.width)),{direction:x,speed:w}}function si(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:l}=window;return{top:0,left:0,right:o,bottom:l,width:o,height:l}}const{top:s,left:n,right:r,bottom:i}=e.getBoundingClientRect();return{top:s,left:n,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function dn(e){return e.reduce((s,n)=>rt(s,as(n)),Ce)}function ni(e){return e.reduce((s,n)=>s+on(n),0)}function ri(e){return e.reduce((s,n)=>s+an(n),0)}function ii(e,s){if(s===void 0&&(s=at),!e)return;const{top:n,left:r,bottom:i,right:o}=s(e);rn(e)&&(i<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const oi=[["x",["left","right"],ni],["y",["top","bottom"],ri]];class bs{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=gs(n),i=dn(r);this.rect={...s},this.width=s.width,this.height=s.height;for(const[o,l,c]of oi)for(const u of l)Object.defineProperty(this,u,{get:()=>{const h=c(r),p=i[o]-h;return this.rect[u]+p},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class pt{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=s}add(s,n,r){var i;(i=this.target)==null||i.addEventListener(s,n,r),this.listeners.push([s,n,r])}}function ai(e){const{EventTarget:s}=ce(e);return e instanceof s?e:ot(e)}function es(e,s){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof s=="number"?Math.sqrt(n**2+r**2)>s:"x"in s&&"y"in s?n>s.x&&r>s.y:"x"in s?n>s.x:"y"in s?r>s.y:!1}var fe;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(fe||(fe={}));function Ls(e){e.preventDefault()}function li(e){e.stopPropagation()}var F;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(F||(F={}));const un={start:[F.Space,F.Enter],cancel:[F.Esc],end:[F.Space,F.Enter,F.Tab]},ci=(e,s)=>{let{currentCoordinates:n}=s;switch(e.code){case F.Right:return{...n,x:n.x+25};case F.Left:return{...n,x:n.x-25};case F.Down:return{...n,y:n.y+25};case F.Up:return{...n,y:n.y-25}}};class mn{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new pt(ot(n)),this.windowListeners=new pt(ce(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(fe.Resize,this.handleCancel),this.windowListeners.add(fe.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(fe.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,r=s.node.current;r&&ii(r),n(Ce)}handleKeyDown(s){if(fs(s)){const{active:n,context:r,options:i}=this.props,{keyboardCodes:o=un,coordinateGetter:l=ci,scrollBehavior:c="smooth"}=i,{code:u}=s;if(o.end.includes(u)){this.handleEnd(s);return}if(o.cancel.includes(u)){this.handleCancel(s);return}const{collisionRect:h}=r.current,p=h?{x:h.left,y:h.top}:Ce;this.referenceCoordinates||(this.referenceCoordinates=p);const m=l(s,{active:n,context:r.current,currentCoordinates:p});if(m){const b=$t(m,p),x={x:0,y:0},{scrollableAncestors:w}=r.current;for(const v of w){const y=s.code,{isTop:N,isRight:k,isLeft:D,isBottom:R,maxScroll:T,minScroll:C}=cn(v),f=si(v),g={x:Math.min(y===F.Right?f.right-f.width/2:f.right,Math.max(y===F.Right?f.left:f.left+f.width/2,m.x)),y:Math.min(y===F.Down?f.bottom-f.height/2:f.bottom,Math.max(y===F.Down?f.top:f.top+f.height/2,m.y))},A=y===F.Right&&!k||y===F.Left&&!D,E=y===F.Down&&!R||y===F.Up&&!N;if(A&&g.x!==m.x){const I=v.scrollLeft+b.x,M=y===F.Right&&I<=T.x||y===F.Left&&I>=C.x;if(M&&!b.y){v.scrollTo({left:I,behavior:c});return}M?x.x=v.scrollLeft-I:x.x=y===F.Right?v.scrollLeft-T.x:v.scrollLeft-C.x,x.x&&v.scrollBy({left:-x.x,behavior:c});break}else if(E&&g.y!==m.y){const I=v.scrollTop+b.y,M=y===F.Down&&I<=T.y||y===F.Up&&I>=C.y;if(M&&!b.x){v.scrollTo({top:I,behavior:c});return}M?x.y=v.scrollTop-I:x.y=y===F.Down?v.scrollTop-T.y:v.scrollTop-C.y,x.y&&v.scrollBy({top:-x.y,behavior:c});break}}this.handleMove(s,rt($t(m,this.referenceCoordinates),x))}}}handleMove(s,n){const{onMove:r}=this.props;s.preventDefault(),r(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}mn.activators=[{eventName:"onKeyDown",handler:(e,s,n)=>{let{keyboardCodes:r=un,onActivation:i}=s,{active:o}=n;const{code:l}=e.nativeEvent;if(r.start.includes(l)){const c=o.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),i?.({event:e.nativeEvent}),!0)}return!1}}];function $s(e){return!!(e&&"distance"in e)}function Gs(e){return!!(e&&"delay"in e)}class vs{constructor(s,n,r){var i;r===void 0&&(r=ai(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:o}=s,{target:l}=o;this.props=s,this.events=n,this.document=ot(l),this.documentListeners=new pt(this.document),this.listeners=new pt(r),this.windowListeners=new pt(ce(l)),this.initialCoordinates=(i=os(o))!=null?i:Ce,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(fe.Resize,this.handleCancel),this.windowListeners.add(fe.DragStart,Ls),this.windowListeners.add(fe.VisibilityChange,this.handleCancel),this.windowListeners.add(fe.ContextMenu,Ls),this.documentListeners.add(fe.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Gs(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if($s(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:r,onPending:i}=this.props;i(r,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(fe.Click,li,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(fe.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:r,initialCoordinates:i,props:o}=this,{onMove:l,options:{activationConstraint:c}}=o;if(!i)return;const u=(n=os(s))!=null?n:Ce,h=$t(i,u);if(!r&&c){if($s(c)){if(c.tolerance!=null&&es(h,c.tolerance))return this.handleCancel();if(es(h,c.distance))return this.handleStart()}if(Gs(c)&&es(h,c.tolerance))return this.handleCancel();this.handlePending(c,h);return}s.cancelable&&s.preventDefault(),l(u)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===F.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const di={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class ws extends vs{constructor(s){const{event:n}=s,r=ot(n.target);super(s,di,r)}}ws.activators=[{eventName:"onPointerDown",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const ui={move:{name:"mousemove"},end:{name:"mouseup"}};var ls;(function(e){e[e.RightClick=2]="RightClick"})(ls||(ls={}));class mi extends vs{constructor(s){super(s,ui,ot(s.event.target))}}mi.activators=[{eventName:"onMouseDown",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;return n.button===ls.RightClick?!1:(r?.({event:n}),!0)}}];const ts={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class xn extends vs{constructor(s){super(s,ts)}static setup(){return window.addEventListener(ts.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(ts.move.name,s)};function s(){}}}xn.activators=[{eventName:"onTouchStart",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;const{touches:i}=n;return i.length>1?!1:(r?.({event:n}),!0)}}];var ft;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(ft||(ft={}));var _t;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(_t||(_t={}));function xi(e){let{acceleration:s,activator:n=ft.Pointer,canScroll:r,draggingRect:i,enabled:o,interval:l=5,order:c=_t.TreeOrder,pointerCoordinates:u,scrollableAncestors:h,scrollableAncestorRects:p,delta:m,threshold:b}=e;const x=pi({delta:m,disabled:!o}),[w,v]=Sr(),y=a.useRef({x:0,y:0}),N=a.useRef({x:0,y:0}),k=a.useMemo(()=>{switch(n){case ft.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case ft.DraggableRect:return i}},[n,i,u]),D=a.useRef(null),R=a.useCallback(()=>{const C=D.current;if(!C)return;const f=y.current.x*N.current.x,g=y.current.y*N.current.y;C.scrollBy(f,g)},[]),T=a.useMemo(()=>c===_t.TreeOrder?[...h].reverse():h,[c,h]);a.useEffect(()=>{if(!o||!h.length||!k){v();return}for(const C of T){if(r?.(C)===!1)continue;const f=h.indexOf(C),g=p[f];if(!g)continue;const{direction:A,speed:E}=ti(C,g,k,s,b);for(const I of["x","y"])x[I][A[I]]||(E[I]=0,A[I]=0);if(E.x>0||E.y>0){v(),D.current=C,w(R,l),y.current=E,N.current=A;return}}y.current={x:0,y:0},N.current={x:0,y:0},v()},[s,R,r,v,o,l,JSON.stringify(k),JSON.stringify(x),w,h,T,p,JSON.stringify(b)])}const hi={x:{[Q.Backward]:!1,[Q.Forward]:!1},y:{[Q.Backward]:!1,[Q.Forward]:!1}};function pi(e){let{delta:s,disabled:n}=e;const r=is(s);return jt(i=>{if(n||!r||!i)return hi;const o={x:Math.sign(s.x-r.x),y:Math.sign(s.y-r.y)};return{x:{[Q.Backward]:i.x[Q.Backward]||o.x===-1,[Q.Forward]:i.x[Q.Forward]||o.x===1},y:{[Q.Backward]:i.y[Q.Backward]||o.y===-1,[Q.Forward]:i.y[Q.Forward]||o.y===1}}},[n,s,r])}function fi(e,s){const n=s!=null?e.get(s):void 0,r=n?n.node.current:null;return jt(i=>{var o;return s==null?null:(o=r??i)!=null?o:null},[r,s])}function gi(e,s){return a.useMemo(()=>e.reduce((n,r)=>{const{sensor:i}=r,o=i.activators.map(l=>({eventName:l.eventName,handler:s(l.handler,r)}));return[...n,...o]},[]),[e,s])}var wt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(wt||(wt={}));var cs;(function(e){e.Optimized="optimized"})(cs||(cs={}));const _s=new Map;function bi(e,s){let{dragging:n,dependencies:r,config:i}=s;const[o,l]=a.useState(null),{frequency:c,measure:u,strategy:h}=i,p=a.useRef(e),m=y(),b=bt(m),x=a.useCallback(function(N){N===void 0&&(N=[]),!b.current&&l(k=>k===null?N:k.concat(N.filter(D=>!k.includes(D))))},[b]),w=a.useRef(null),v=jt(N=>{if(m&&!n)return _s;if(!N||N===_s||p.current!==e||o!=null){const k=new Map;for(let D of e){if(!D)continue;if(o&&o.length>0&&!o.includes(D.id)&&D.rect.current){k.set(D.id,D.rect.current);continue}const R=D.node.current,T=R?new bs(u(R),R):null;D.rect.current=T,T&&k.set(D.id,T)}return k}return N},[e,o,n,m,u]);return a.useEffect(()=>{p.current=e},[e]),a.useEffect(()=>{m||x()},[n,m]),a.useEffect(()=>{o&&o.length>0&&l(null)},[JSON.stringify(o)]),a.useEffect(()=>{m||typeof c!="number"||w.current!==null||(w.current=setTimeout(()=>{x(),w.current=null},c))},[c,m,x,...r]),{droppableRects:v,measureDroppableContainers:x,measuringScheduled:o!=null};function y(){switch(h){case wt.Always:return!1;case wt.BeforeDragging:return n;default:return!n}}}function hn(e,s){return jt(n=>e?n||(typeof s=="function"?s(e):e):null,[s,e])}function vi(e,s){return hn(e,s)}function wi(e){let{callback:s,disabled:n}=e;const r=ps(s),i=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return a.useEffect(()=>()=>i?.disconnect(),[i]),i}function Bt(e){let{callback:s,disabled:n}=e;const r=ps(s),i=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return a.useEffect(()=>()=>i?.disconnect(),[i]),i}function yi(e){return new bs(at(e),e)}function Us(e,s,n){s===void 0&&(s=yi);const[r,i]=a.useState(null);function o(){i(u=>{if(!e)return null;if(e.isConnected===!1){var h;return(h=u??n)!=null?h:null}const p=s(e);return JSON.stringify(u)===JSON.stringify(p)?u:p})}const l=wi({callback(u){if(e)for(const h of u){const{type:p,target:m}=h;if(p==="childList"&&m instanceof HTMLElement&&m.contains(e)){o();break}}}}),c=Bt({callback:o});return Ie(()=>{o(),e?(c?.observe(e),l?.observe(document.body,{childList:!0,subtree:!0})):(c?.disconnect(),l?.disconnect())},[e]),r}function ji(e){const s=hn(e);return nn(e,s)}const Bs=[];function Ni(e){const s=a.useRef(e),n=jt(r=>e?r&&r!==Bs&&e&&s.current&&e.parentNode===s.current.parentNode?r:gs(e):Bs,[e]);return a.useEffect(()=>{s.current=e},[e]),n}function Si(e){const[s,n]=a.useState(null),r=a.useRef(e),i=a.useCallback(o=>{const l=Zt(o.target);l&&n(c=>c?(c.set(l,as(l)),new Map(c)):null)},[]);return a.useEffect(()=>{const o=r.current;if(e!==o){l(o);const c=e.map(u=>{const h=Zt(u);return h?(h.addEventListener("scroll",i,{passive:!0}),[h,as(h)]):null}).filter(u=>u!=null);n(c.length?new Map(c):null),r.current=e}return()=>{l(e),l(o)};function l(c){c.forEach(u=>{const h=Zt(u);h?.removeEventListener("scroll",i)})}},[i,e]),a.useMemo(()=>e.length?s?Array.from(s.values()).reduce((o,l)=>rt(o,l),Ce):dn(e):Ce,[e,s])}function Ws(e,s){s===void 0&&(s=[]);const n=a.useRef(null);return a.useEffect(()=>{n.current=null},s),a.useEffect(()=>{const r=e!==Ce;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?$t(e,n.current):Ce}function Ci(e){a.useEffect(()=>{if(!Ut)return;const s=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of s)n?.()}},e.map(s=>{let{sensor:n}=s;return n}))}function ki(e,s){return a.useMemo(()=>e.reduce((n,r)=>{let{eventName:i,handler:o}=r;return n[i]=l=>{o(l,s)},n},{}),[e,s])}function pn(e){return a.useMemo(()=>e?Jr(e):null,[e])}const Hs=[];function Di(e,s){s===void 0&&(s=at);const[n]=e,r=pn(n?ce(n):null),[i,o]=a.useState(Hs);function l(){o(()=>e.length?e.map(u=>ln(u)?r:new bs(s(u),u)):Hs)}const c=Bt({callback:l});return Ie(()=>{c?.disconnect(),l(),e.forEach(u=>c?.observe(u))},[e]),i}function Ti(e){if(!e)return null;if(e.children.length>1)return e;const s=e.children[0];return yt(s)?s:e}function Ri(e){let{measure:s}=e;const[n,r]=a.useState(null),i=a.useCallback(h=>{for(const{target:p}of h)if(yt(p)){r(m=>{const b=s(p);return m?{...m,width:b.width,height:b.height}:b});break}},[s]),o=Bt({callback:i}),l=a.useCallback(h=>{const p=Ti(h);o?.disconnect(),p&&o?.observe(p),r(p?s(p):null)},[s,o]),[c,u]=Lt(l);return a.useMemo(()=>({nodeRef:c,rect:n,setRef:u}),[n,c,u])}const Ai=[{sensor:ws,options:{}},{sensor:mn,options:{}}],Ei={current:{}},Ft={draggable:{measure:Os},droppable:{measure:Os,strategy:wt.WhileDragging,frequency:cs.Optimized},dragOverlay:{measure:at}};class gt extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,r;return(n=(r=this.get(s))==null?void 0:r.node.current)!=null?n:void 0}}const Mi={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new gt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Gt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ft,measureDroppableContainers:Gt,windowRect:null,measuringScheduled:!1},Ii={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Gt,draggableNodes:new Map,over:null,measureDroppableContainers:Gt},Wt=a.createContext(Ii),fn=a.createContext(Mi);function Pi(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new gt}}}function zi(e,s){switch(s.type){case K.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case K.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:s.coordinates.x-e.draggable.initialCoordinates.x,y:s.coordinates.y-e.draggable.initialCoordinates.y}}};case K.DragEnd:case K.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case K.RegisterDroppable:{const{element:n}=s,{id:r}=n,i=new gt(e.droppable.containers);return i.set(r,n),{...e,droppable:{...e.droppable,containers:i}}}case K.SetDroppableDisabled:{const{id:n,key:r,disabled:i}=s,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const l=new gt(e.droppable.containers);return l.set(n,{...o,disabled:i}),{...e,droppable:{...e.droppable,containers:l}}}case K.UnregisterDroppable:{const{id:n,key:r}=s,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const o=new gt(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Fi(e){let{disabled:s}=e;const{active:n,activatorEvent:r,draggableNodes:i}=a.useContext(Wt),o=is(r),l=is(n?.id);return a.useEffect(()=>{if(!s&&!r&&o&&l!=null){if(!fs(o)||document.activeElement===o.target)return;const c=i.get(l);if(!c)return;const{activatorNode:u,node:h}=c;if(!u.current&&!h.current)return;requestAnimationFrame(()=>{for(const p of[u.current,h.current]){if(!p)continue;const m=Dr(p);if(m){m.focus();break}}})}},[r,s,i,l,o]),null}function Oi(e,s){let{transform:n,...r}=s;return e!=null&&e.length?e.reduce((i,o)=>o({transform:i,...r}),n):n}function Li(e){return a.useMemo(()=>({draggable:{...Ft.draggable,...e?.draggable},droppable:{...Ft.droppable,...e?.droppable},dragOverlay:{...Ft.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function $i(e){let{activeNode:s,measure:n,initialRect:r,config:i=!0}=e;const o=a.useRef(!1),{x:l,y:c}=typeof i=="boolean"?{x:i,y:i}:i;Ie(()=>{if(!l&&!c||!s){o.current=!1;return}if(o.current||!r)return;const h=s?.node.current;if(!h||h.isConnected===!1)return;const p=n(h),m=nn(p,r);if(l||(m.x=0),c||(m.y=0),o.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const b=rn(h);b&&b.scrollBy({top:m.y,left:m.x})}},[s,l,c,r,n])}const gn=a.createContext({...Ce,scaleX:1,scaleY:1});var Ge;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ge||(Ge={}));const Gi=a.memo(function(s){var n,r,i,o;let{id:l,accessibility:c,autoScroll:u=!0,children:h,sensors:p=Ai,collisionDetection:m=Wr,measuring:b,modifiers:x,...w}=s;const v=a.useReducer(zi,void 0,Pi),[y,N]=v,[k,D]=Ir(),[R,T]=a.useState(Ge.Uninitialized),C=R===Ge.Initialized,{draggable:{active:f,nodes:g,translate:A},droppable:{containers:E}}=y,I=f!=null?g.get(f):null,M=a.useRef({initial:null,translated:null}),W=a.useMemo(()=>{var q;return f!=null?{id:f,data:(q=I?.data)!=null?q:Ei,rect:M}:null},[f,I]),te=a.useRef(null),[H,O]=a.useState(null),[X,Ze]=a.useState(null),ke=bt(w,Object.values(w)),Oe=Nt("DndDescribedBy",l),Ue=a.useMemo(()=>E.getEnabled(),[E]),se=Li(b),{droppableRects:xe,measureDroppableContainers:Pe,measuringScheduled:Le}=bi(Ue,{dragging:C,dependencies:[A.x,A.y],config:se.droppable}),ie=fi(g,f),et=a.useMemo(()=>X?os(X):null,[X]),De=Fe(),be=vi(ie,se.draggable.measure);$i({activeNode:f!=null?g.get(f):null,config:De.layoutShiftCompensation,initialRect:be,measure:se.draggable.measure});const P=Us(ie,se.draggable.measure,be),ve=Us(ie?ie.parentElement:null),oe=a.useRef({activatorEvent:null,active:null,activeNode:ie,collisionRect:null,collisions:null,droppableRects:xe,draggableNodes:g,draggingNode:null,draggingNodeRect:null,droppableContainers:E,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),he=E.getNodeFor((n=oe.current.over)==null?void 0:n.id),re=Ri({measure:se.dragOverlay.measure}),Te=(r=re.nodeRef.current)!=null?r:ie,U=C?(i=re.rect)!=null?i:P:null,ze=!!(re.nodeRef.current&&re.rect),Y=ji(ze?null:P),Be=pn(Te?ce(Te):null),we=Ni(C?he??ie:null),We=Di(we),tt=Oi(x,{transform:{x:A.x-Y.x,y:A.y-Y.y,scaleX:1,scaleY:1},activatorEvent:X,active:W,activeNodeRect:P,containerNodeRect:ve,draggingNodeRect:U,over:oe.current.over,overlayNodeRect:re.rect,scrollableAncestors:we,scrollableAncestorRects:We,windowRect:Be}),st=et?rt(et,A):null,St=Si(we),Re=Ws(St),Ct=Ws(St,[P]),ye=rt(tt,Re),Ae=U?Yr(U,tt):null,ae=W&&Ae?m({active:W,collisionRect:Ae,droppableRects:xe,droppableContainers:Ue,pointerCoordinates:st}):null,lt=_r(ae,"id"),[de,ct]=a.useState(null),nt=ze?tt:rt(tt,Ct),kt=Hr(nt,(o=de?.rect)!=null?o:null,P),ue=a.useRef(null),dt=a.useCallback((q,G)=>{let{sensor:ne,options:pe}=G;if(te.current==null)return;const V=g.get(te.current);if(!V)return;const Z=q.nativeEvent,ee=new ne({active:te.current,activeNode:V,event:Z,options:pe,context:oe,onAbort(_){if(!g.get(_))return;const{onDragAbort:me}=ke.current,Ne={id:_};me?.(Ne),k({type:"onDragAbort",event:Ne})},onPending(_,je,me,Ne){if(!g.get(_))return;const{onDragPending:qe}=ke.current,Me={id:_,constraint:je,initialCoordinates:me,offset:Ne};qe?.(Me),k({type:"onDragPending",event:Me})},onStart(_){const je=te.current;if(je==null)return;const me=g.get(je);if(!me)return;const{onDragStart:Ne}=ke.current,Ye={activatorEvent:Z,active:{id:je,data:me.data,rect:M}};ht.unstable_batchedUpdates(()=>{Ne?.(Ye),T(Ge.Initializing),N({type:K.DragStart,initialCoordinates:_,active:je}),k({type:"onDragStart",event:Ye}),O(ue.current),Ze(Z)})},onMove(_){N({type:K.DragMove,coordinates:_})},onEnd:Ee(K.DragEnd),onCancel:Ee(K.DragCancel)});ue.current=ee;function Ee(_){return async function(){const{active:me,collisions:Ne,over:Ye,scrollAdjustedTranslate:qe}=oe.current;let Me=null;if(me&&qe){const{cancelDrop:Ke}=ke.current;Me={activatorEvent:Z,active:me,collisions:Ne,delta:qe,over:Ye},_===K.DragEnd&&typeof Ke=="function"&&await Promise.resolve(Ke(Me))&&(_=K.DragCancel)}te.current=null,ht.unstable_batchedUpdates(()=>{N({type:_}),T(Ge.Uninitialized),ct(null),O(null),Ze(null),ue.current=null;const Ke=_===K.DragEnd?"onDragEnd":"onDragCancel";if(Me){const mt=ke.current[Ke];mt?.(Me),k({type:Ke,event:Me})}})}}},[g]),He=a.useCallback((q,G)=>(ne,pe)=>{const V=ne.nativeEvent,Z=g.get(pe);if(te.current!==null||!Z||V.dndKit||V.defaultPrevented)return;const ee={active:Z};q(ne,G.options,ee)===!0&&(V.dndKit={capturedBy:G.sensor},te.current=pe,dt(ne,G))},[g,dt]),ut=gi(p,He);Ci(p),Ie(()=>{P&&R===Ge.Initializing&&T(Ge.Initialized)},[P,R]),a.useEffect(()=>{const{onDragMove:q}=ke.current,{active:G,activatorEvent:ne,collisions:pe,over:V}=oe.current;if(!G||!ne)return;const Z={active:G,activatorEvent:ne,collisions:pe,delta:{x:ye.x,y:ye.y},over:V};ht.unstable_batchedUpdates(()=>{q?.(Z),k({type:"onDragMove",event:Z})})},[ye.x,ye.y]),a.useEffect(()=>{const{active:q,activatorEvent:G,collisions:ne,droppableContainers:pe,scrollAdjustedTranslate:V}=oe.current;if(!q||te.current==null||!G||!V)return;const{onDragOver:Z}=ke.current,ee=pe.get(lt),Ee=ee&&ee.rect.current?{id:ee.id,rect:ee.rect.current,data:ee.data,disabled:ee.disabled}:null,_={active:q,activatorEvent:G,collisions:ne,delta:{x:V.x,y:V.y},over:Ee};ht.unstable_batchedUpdates(()=>{ct(Ee),Z?.(_),k({type:"onDragOver",event:_})})},[lt]),Ie(()=>{oe.current={activatorEvent:X,active:W,activeNode:ie,collisionRect:Ae,collisions:ae,droppableRects:xe,draggableNodes:g,draggingNode:Te,draggingNodeRect:U,droppableContainers:E,over:de,scrollableAncestors:we,scrollAdjustedTranslate:ye},M.current={initial:U,translated:Ae}},[W,ie,ae,Ae,g,Te,U,xe,E,de,we,ye]),xi({...De,delta:A,draggingRect:Ae,pointerCoordinates:st,scrollableAncestors:we,scrollableAncestorRects:We});const Xe=a.useMemo(()=>({active:W,activeNode:ie,activeNodeRect:P,activatorEvent:X,collisions:ae,containerNodeRect:ve,dragOverlay:re,draggableNodes:g,droppableContainers:E,droppableRects:xe,over:de,measureDroppableContainers:Pe,scrollableAncestors:we,scrollableAncestorRects:We,measuringConfiguration:se,measuringScheduled:Le,windowRect:Be}),[W,ie,P,X,ae,ve,re,g,E,xe,de,Pe,we,We,se,Le,Be]),Dt=a.useMemo(()=>({activatorEvent:X,activators:ut,active:W,activeNodeRect:P,ariaDescribedById:{draggable:Oe},dispatch:N,draggableNodes:g,over:de,measureDroppableContainers:Pe}),[X,ut,W,P,N,Oe,g,de,Pe]);return le.createElement(sn.Provider,{value:D},le.createElement(Wt.Provider,{value:Dt},le.createElement(fn.Provider,{value:Xe},le.createElement(gn.Provider,{value:kt},h)),le.createElement(Fi,{disabled:c?.restoreFocus===!1})),le.createElement(Fr,{...c,hiddenTextDescribedById:Oe}));function Fe(){const q=H?.autoScrollEnabled===!1,G=typeof u=="object"?u.enabled===!1:u===!1,ne=C&&!q&&!G;return typeof u=="object"?{...u,enabled:ne}:{enabled:ne}}}),_i=a.createContext(null),Xs="button",Ui="Draggable";function Bi(e){let{id:s,data:n,disabled:r=!1,attributes:i}=e;const o=Nt(Ui),{activators:l,activatorEvent:c,active:u,activeNodeRect:h,ariaDescribedById:p,draggableNodes:m,over:b}=a.useContext(Wt),{role:x=Xs,roleDescription:w="draggable",tabIndex:v=0}=i??{},y=u?.id===s,N=a.useContext(y?gn:_i),[k,D]=Lt(),[R,T]=Lt(),C=ki(l,s),f=bt(n);Ie(()=>(m.set(s,{id:s,key:o,node:k,activatorNode:R,data:f}),()=>{const A=m.get(s);A&&A.key===o&&m.delete(s)}),[m,s]);const g=a.useMemo(()=>({role:x,tabIndex:v,"aria-disabled":r,"aria-pressed":y&&x===Xs?!0:void 0,"aria-roledescription":w,"aria-describedby":p.draggable}),[r,x,v,y,w,p.draggable]);return{active:u,activatorEvent:c,activeNodeRect:h,attributes:g,isDragging:y,listeners:r?void 0:C,node:k,over:b,setNodeRef:D,setActivatorNodeRef:T,transform:N}}function Wi(){return a.useContext(fn)}const Hi="Droppable",Xi={timeout:25};function Yi(e){let{data:s,disabled:n=!1,id:r,resizeObserverConfig:i}=e;const o=Nt(Hi),{active:l,dispatch:c,over:u,measureDroppableContainers:h}=a.useContext(Wt),p=a.useRef({disabled:n}),m=a.useRef(!1),b=a.useRef(null),x=a.useRef(null),{disabled:w,updateMeasurementsFor:v,timeout:y}={...Xi,...i},N=bt(v??r),k=a.useCallback(()=>{if(!m.current){m.current=!0;return}x.current!=null&&clearTimeout(x.current),x.current=setTimeout(()=>{h(Array.isArray(N.current)?N.current:[N.current]),x.current=null},y)},[y]),D=Bt({callback:k,disabled:w||!l}),R=a.useCallback((g,A)=>{D&&(A&&(D.unobserve(A),m.current=!1),g&&D.observe(g))},[D]),[T,C]=Lt(R),f=bt(s);return a.useEffect(()=>{!D||!T.current||(D.disconnect(),m.current=!1,D.observe(T.current))},[T,D]),a.useEffect(()=>(c({type:K.RegisterDroppable,element:{id:r,key:o,disabled:n,node:T,rect:b,data:f}}),()=>c({type:K.UnregisterDroppable,key:o,id:r})),[r]),a.useEffect(()=>{n!==p.current.disabled&&(c({type:K.SetDroppableDisabled,id:r,key:o,disabled:n}),p.current.disabled=n)},[r,o,n,c]),{active:l,rect:b,isOver:u?.id===r,node:T,over:u,setNodeRef:C}}function ys(e,s,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(s,1)[0]),r}function qi(e,s){return e.reduce((n,r,i)=>{const o=s.get(r);return o&&(n[i]=o),n},Array(e.length))}function Mt(e){return e!==null&&e>=0}function Ki(e,s){if(e===s)return!0;if(e.length!==s.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==s[n])return!1;return!0}function Vi(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const bn=e=>{let{rects:s,activeIndex:n,overIndex:r,index:i}=e;const o=ys(s,r,n),l=s[i],c=o[i];return!c||!l?null:{x:c.left-l.left,y:c.top-l.top,scaleX:c.width/l.width,scaleY:c.height/l.height}},It={scaleX:1,scaleY:1},Ji=e=>{var s;let{activeIndex:n,activeNodeRect:r,index:i,rects:o,overIndex:l}=e;const c=(s=o[n])!=null?s:r;if(!c)return null;if(i===n){const h=o[l];return h?{x:0,y:n<l?h.top+h.height-(c.top+c.height):h.top-c.top,...It}:null}const u=Qi(o,i,n);return i>n&&i<=l?{x:0,y:-c.height-u,...It}:i<n&&i>=l?{x:0,y:c.height+u,...It}:{x:0,y:0,...It}};function Qi(e,s,n){const r=e[s],i=e[s-1],o=e[s+1];return r?n<s?i?r.top-(i.top+i.height):o?o.top-(r.top+r.height):0:o?o.top-(r.top+r.height):i?r.top-(i.top+i.height):0:0}const vn="Sortable",wn=le.createContext({activeIndex:-1,containerId:vn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:bn,disabled:{draggable:!1,droppable:!1}});function Zi(e){let{children:s,id:n,items:r,strategy:i=bn,disabled:o=!1}=e;const{active:l,dragOverlay:c,droppableRects:u,over:h,measureDroppableContainers:p}=Wi(),m=Nt(vn,n),b=c.rect!==null,x=a.useMemo(()=>r.map(C=>typeof C=="object"&&"id"in C?C.id:C),[r]),w=l!=null,v=l?x.indexOf(l.id):-1,y=h?x.indexOf(h.id):-1,N=a.useRef(x),k=!Ki(x,N.current),D=y!==-1&&v===-1||k,R=Vi(o);Ie(()=>{k&&w&&p(x)},[k,x,w,p]),a.useEffect(()=>{N.current=x},[x]);const T=a.useMemo(()=>({activeIndex:v,containerId:m,disabled:R,disableTransforms:D,items:x,overIndex:y,useDragOverlay:b,sortedRects:qi(x,u),strategy:i}),[v,m,R.draggable,R.droppable,D,x,y,u,b,i]);return le.createElement(wn.Provider,{value:T},s)}const eo=e=>{let{id:s,items:n,activeIndex:r,overIndex:i}=e;return ys(n,r,i).indexOf(s)},to=e=>{let{containerId:s,isSorting:n,wasDragging:r,index:i,items:o,newIndex:l,previousItems:c,previousContainerId:u,transition:h}=e;return!h||!r||c!==o&&i===l?!1:n?!0:l!==i&&s===u},so={duration:200,easing:"ease"},yn="transform",no=vt.Transition.toString({property:yn,duration:0,easing:"linear"}),ro={roleDescription:"sortable"};function io(e){let{disabled:s,index:n,node:r,rect:i}=e;const[o,l]=a.useState(null),c=a.useRef(n);return Ie(()=>{if(!s&&n!==c.current&&r.current){const u=i.current;if(u){const h=at(r.current,{ignoreTransform:!0}),p={x:u.left-h.left,y:u.top-h.top,scaleX:u.width/h.width,scaleY:u.height/h.height};(p.x||p.y)&&l(p)}}n!==c.current&&(c.current=n)},[s,n,r,i]),a.useEffect(()=>{o&&l(null)},[o]),o}function oo(e){let{animateLayoutChanges:s=to,attributes:n,disabled:r,data:i,getNewIndex:o=eo,id:l,strategy:c,resizeObserverConfig:u,transition:h=so}=e;const{items:p,containerId:m,activeIndex:b,disabled:x,disableTransforms:w,sortedRects:v,overIndex:y,useDragOverlay:N,strategy:k}=a.useContext(wn),D=ao(r,x),R=p.indexOf(l),T=a.useMemo(()=>({sortable:{containerId:m,index:R,items:p},...i}),[m,i,R,p]),C=a.useMemo(()=>p.slice(p.indexOf(l)),[p,l]),{rect:f,node:g,isOver:A,setNodeRef:E}=Yi({id:l,data:T,disabled:D.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...u}}),{active:I,activatorEvent:M,activeNodeRect:W,attributes:te,setNodeRef:H,listeners:O,isDragging:X,over:Ze,setActivatorNodeRef:ke,transform:Oe}=Bi({id:l,data:T,attributes:{...ro,...n},disabled:D.draggable}),Ue=Nr(E,H),se=!!I,xe=se&&!w&&Mt(b)&&Mt(y),Pe=!N&&X,Le=Pe&&xe?Oe:null,et=xe?Le??(c??k)({rects:v,activeNodeRect:W,activeIndex:b,overIndex:y,index:R}):null,De=Mt(b)&&Mt(y)?o({id:l,items:p,activeIndex:b,overIndex:y}):R,be=I?.id,P=a.useRef({activeId:be,items:p,newIndex:De,containerId:m}),ve=p!==P.current.items,oe=s({active:I,containerId:m,isDragging:X,isSorting:se,id:l,index:R,items:p,newIndex:P.current.newIndex,previousItems:P.current.items,previousContainerId:P.current.containerId,transition:h,wasDragging:P.current.activeId!=null}),he=io({disabled:!oe,index:R,node:g,rect:f});return a.useEffect(()=>{se&&P.current.newIndex!==De&&(P.current.newIndex=De),m!==P.current.containerId&&(P.current.containerId=m),p!==P.current.items&&(P.current.items=p)},[se,De,m,p]),a.useEffect(()=>{if(be===P.current.activeId)return;if(be!=null&&P.current.activeId==null){P.current.activeId=be;return}const Te=setTimeout(()=>{P.current.activeId=be},50);return()=>clearTimeout(Te)},[be]),{active:I,activeIndex:b,attributes:te,data:T,rect:f,index:R,newIndex:De,items:p,isOver:A,isSorting:se,isDragging:X,listeners:O,node:g,overIndex:y,over:Ze,setNodeRef:Ue,setActivatorNodeRef:ke,setDroppableNodeRef:E,setDraggableNodeRef:H,transform:he??et,transition:re()};function re(){if(he||ve&&P.current.newIndex===R)return no;if(!(Pe&&!fs(M)||!h)&&(se||oe))return vt.Transition.toString({...h,property:yn})}}function ao(e,s){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:s.draggable,droppable:(r=e?.droppable)!=null?r:s.droppable}}F.Down,F.Right,F.Up,F.Left;const ds=e=>{if(!e)return"";try{const s=new Date(e),r=new Date().getTime()-s.getTime(),i=Math.floor(r/(1e3*60*60*24)),o={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"};return i===0?`Сегодня, ${s.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:i===1?`Вчера, ${s.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:s.toLocaleString("ru-RU",o)}catch{return""}},jn=(e,s=16,n="")=>{const i=Array.from(e).reduce((c,u)=>c+u.charCodeAt(0),0)%8,o={size:s,className:`text-indigo-400 shrink-0 ${n}`};return[t.jsx(Js,{...o},"bot"),t.jsx(Pt,{...o},"brain"),t.jsx(ss,{...o},"cpu"),t.jsx(Qs,{...o},"zap"),t.jsx(Jn,{...o},"rocket"),t.jsx(ns,{...o},"sparkles"),t.jsx(Qn,{...o},"circuit"),t.jsx(Zn,{...o},"wand")][i]},us=e=>e===B.GPT52?B.GPT52:e===B.GPT51?B.GPT51:e===B.GPT5_MINI?B.GPT5_MINI:e===B.GPT4O?B.GPT4O:e===B.GPT4O_MINI?B.GPT4O_MINI:B.GPT5_MINI,lo=({agent:e,index:s})=>{const{attributes:n,listeners:r,setNodeRef:i,transform:o,transition:l,isDragging:c}=oo({id:e.id}),u={transform:vt.Transform.toString(o),transition:l};return t.jsxs("div",{ref:i,style:u,className:`flex items-center gap-2 sm:gap-3 p-2 sm:p-2.5 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-colors ${c?"opacity-50 z-20":""}`,children:[t.jsx("div",{...n,...r,className:"cursor-grab active:cursor-grabbing text-white/40 hover:text-white/60 transition-colors",children:t.jsx(vr,{size:14,className:"sm:w-4 sm:h-4"})}),t.jsx("span",{className:"text-xs sm:text-sm text-white/50 font-medium w-6 sm:w-8 text-center",children:s+1}),jn(e.id,14,"sm:w-4 sm:h-4"),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs sm:text-sm text-white font-medium truncate",children:e.name}),e.description&&t.jsx("div",{className:"text-[10px] sm:text-xs text-white/60 truncate mt-0.5",children:e.description})]})]})},co=({users:e,isLoadingUsers:s,totalUsers:n,totalProjects:r,onUsersReload:i})=>{const[o,l]=a.useState(new Set),[c,u]=a.useState(new Set),h=async m=>{if(!o.has(m)){l(b=>new Set(b).add(m));try{(await $.fixUserSubscription(m)).success&&(alert(`Подписка для пользователя ${m} успешно активирована!`),i&&i())}catch(b){console.error("[AdminUsersTab] Failed to fix subscription:",b);const x=b?.message||"Неизвестная ошибка";x.includes("No successful payments")?alert(`У пользователя ${m} нет успешных платежей для активации подписки.`):alert(`Ошибка при активации подписки: ${x}`)}finally{l(b=>{const x=new Set(b);return x.delete(m),x})}}},p=async(m,b)=>{if(!c.has(m)){u(x=>new Set(x).add(m));try{(await $.toggleUserFreeAccess(m,!b)).success&&i&&i()}catch(x){console.error("[AdminUsersTab] Failed to toggle free access:",x),alert(`Ошибка при изменении бесплатного доступа: ${x?.message||"Неизвестная ошибка"}`)}finally{u(x=>{const w=new Set(x);return w.delete(m),w})}}};return t.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold text-white",children:"Пользователи"}),(n>0||r>0)&&t.jsxs("span",{className:"text-xs sm:text-sm text-white/60",children:["(",n," ",n===1?"пользователь":n<5?"пользователя":"пользователей",", ",r," ",r===1?"проект":r<5?"проекта":"проектов",")"]})]}),s?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx(ge,{size:24,className:"animate-spin text-indigo-400"})}):e.length===0?t.jsxs("div",{className:"text-center py-8 text-white/60 text-sm",children:[t.jsx("p",{children:"Пользователи не найдены"}),t.jsx("p",{className:"text-xs text-white/40 mt-2",children:"В базе данных пока нет зарегистрированных пользователей"})]}):t.jsx("div",{className:"space-y-2 sm:space-y-3",children:e.map(m=>t.jsx("div",{className:"bg-white/5 rounded-lg border border-white/10 p-3 sm:p-4",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-8 gap-3 sm:gap-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] sm:text-xs text-white/60 uppercase tracking-wider mb-1",children:"Логин"}),t.jsx("div",{className:"text-sm sm:text-base text-white font-medium",children:m.username})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] sm:text-xs text-white/60 uppercase tracking-wider mb-1",children:"Пароль"}),t.jsx("div",{className:"text-sm sm:text-base text-white/80",children:"••••••"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] sm:text-xs text-white/60 uppercase tracking-wider mb-1",children:"Дата регистрации"}),t.jsx("div",{className:"text-sm sm:text-base text-white/80",children:ds(m.createdAt)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] sm:text-xs text-white/60 uppercase tracking-wider mb-1",children:"Проектов"}),t.jsx("div",{className:"text-sm sm:text-base text-white font-medium",children:m.projectsCount})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] sm:text-xs text-white/60 uppercase tracking-wider mb-1",children:"Подписка"}),t.jsxs("div",{className:"flex items-center gap-2",children:[m.isPaid?t.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-emerald-500/20 text-emerald-300 text-xs rounded-full border border-emerald-500/30 font-medium",children:"✓ Оплачена"}):t.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-500/20 text-red-300 text-xs rounded-full border border-red-500/30 font-medium",children:"✗ Не оплачена"}),!m.isPaid&&t.jsx("button",{onClick:()=>h(m.username),disabled:o.has(m.username),className:"p-1.5 text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Активировать подписку (если есть успешный платеж)",children:o.has(m.username)?t.jsx(ge,{size:14,className:"animate-spin"}):t.jsx(er,{size:14})})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] sm:text-xs text-white/60 uppercase tracking-wider mb-1",children:"Действует до"}),t.jsx("div",{className:"text-sm sm:text-base text-white/80",children:m.subscriptionExpiresAt?ds(m.subscriptionExpiresAt):"—"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] sm:text-xs text-white/60 uppercase tracking-wider mb-1",children:"Бесплатно"}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("button",{onClick:()=>p(m.id,m.hasFreeAccess??!1),disabled:c.has(m.id),className:`inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full border font-medium transition-all ${m.hasFreeAccess?"bg-amber-500/20 text-amber-300 border-amber-500/30 hover:bg-amber-500/30":"bg-gray-500/20 text-gray-400 border-gray-500/30 hover:bg-gray-500/30"} disabled:opacity-50 disabled:cursor-not-allowed`,title:m.hasFreeAccess?"Отключить бесплатный доступ":"Включить бесплатный доступ",children:[c.has(m.id)?t.jsx(ge,{size:12,className:"animate-spin"}):t.jsx(gr,{size:12}),m.hasFreeAccess?"Да":"Нет"]})})]})]})},m.id))})]})},uo=({agents:e,isLoadingAgents:s,projectTypes:n,searchQuery:r,setSearchQuery:i,selectedProjectTypeFilters:o,selectedRoleFilters:l,selectedModelFilters:c,sortBy:u,sortOrder:h,setSortBy:p,setSortOrder:m,isFiltersOpen:b,setIsFiltersOpen:x,onCreateAgent:w,onEditAgent:v,onDeleteAgent:y,onToggleProjectTypeFilter:N,onToggleRoleFilter:k,onToggleModelFilter:D,onResetFilters:R})=>{const T=a.useMemo(()=>{let f=[...e];if(r.trim()){const g=r.toLowerCase().trim();f=f.filter(A=>A.name.toLowerCase().includes(g)||A.description&&A.description.toLowerCase().includes(g))}return o.length>0&&(f=f.filter(g=>{const A=g.projectTypes?.map(E=>E.id)||[];return o.some(E=>A.includes(E))})),l.length>0&&(f=f.filter(g=>l.includes("none")&&!g.role?!0:g.role&&l.includes(g.role))),c.length>0&&(f=f.filter(g=>g.model&&c.includes(g.model))),f.sort((g,A)=>{let E=0;if(u==="name")E=g.name.localeCompare(A.name);else if(u==="createdAt"){const I=g.createdAt?new Date(g.createdAt).getTime():0;E=(A.createdAt?new Date(A.createdAt).getTime():0)-I}else if(u==="projectTypesCount"){const I=g.projectTypes?.length||0;E=(A.projectTypes?.length||0)-I}return h==="asc"?E:-E}),f},[e,r,o,l,c,u,h]),C=a.useMemo(()=>{let f=0;return r.trim()&&f++,o.length>0&&f++,l.length>0&&f++,c.length>0&&f++,f},[r,o,l,c]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-3 sm:mb-4 gap-2 sm:gap-2",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold text-white",children:"Агенты-шаблоны"}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[t.jsx("span",{className:"text-[10px] sm:text-xs text-white/60 font-medium",children:"Сортировка:"}),t.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsxs("button",{onClick:()=>{p("name"),m("asc"),x(!1)},className:`px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium transition-all ${u==="name"&&h==="asc"?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10"}`,title:"По имени A-Z",children:[t.jsx("span",{className:"hidden sm:inline",children:"Имя"}),t.jsx("span",{className:"sm:hidden",children:"И"}),t.jsx(Vt,{size:10,className:"inline ml-0.5"})]}),t.jsx("button",{onClick:()=>{p("name"),m("desc"),x(!1)},className:`px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium transition-all ${u==="name"&&h==="desc"?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10"}`,title:"По имени Z-A",children:t.jsx(Kt,{size:10,className:"inline"})})]}),t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsxs("button",{onClick:()=>{p("createdAt"),m("desc"),x(!1)},className:`px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium transition-all ${u==="createdAt"&&h==="desc"?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10"}`,title:"Новые сначала",children:[t.jsx("span",{className:"hidden sm:inline",children:"Дата"}),t.jsx("span",{className:"sm:hidden",children:"Д"}),t.jsx(Kt,{size:10,className:"inline ml-0.5"})]}),t.jsx("button",{onClick:()=>{p("createdAt"),m("asc"),x(!1)},className:`px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium transition-all ${u==="createdAt"&&h==="asc"?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10"}`,title:"Старые сначала",children:t.jsx(Vt,{size:10,className:"inline"})})]}),t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsxs("button",{onClick:()=>{p("projectTypesCount"),m("desc"),x(!1)},className:`px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium transition-all ${u==="projectTypesCount"&&h==="desc"?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10"}`,title:"Больше типов",children:[t.jsx("span",{className:"hidden sm:inline",children:"Типы"}),t.jsx("span",{className:"sm:hidden",children:"Т"}),t.jsx(Kt,{size:10,className:"inline ml-0.5"})]}),t.jsx("button",{onClick:()=>{p("projectTypesCount"),m("asc"),x(!1)},className:`px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium transition-all ${u==="projectTypesCount"&&h==="asc"?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10"}`,title:"Меньше типов",children:t.jsx(Vt,{size:10,className:"inline"})})]})]})]}),t.jsxs("button",{onClick:()=>w(),className:"px-2.5 sm:px-4 py-1.5 sm:py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-xs sm:text-sm font-semibold transition-colors flex items-center gap-1 sm:gap-2",children:[t.jsx(ms,{size:14,className:"sm:w-4 sm:h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Создать агента"}),t.jsx("span",{className:"sm:hidden",children:"Создать"})]})]})]}),t.jsxs("div",{className:"mb-3 sm:mb-4",children:[t.jsxs("button",{onClick:()=>x(!b),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-white transition-colors flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(pr,{size:16,className:"sm:w-5 sm:h-5"}),t.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Фильтры"}),C>0&&t.jsx("span",{className:"px-2 py-0.5 bg-indigo-500/20 text-indigo-300 text-[10px] sm:text-xs rounded-full border border-indigo-500/30 font-semibold",children:C})]}),t.jsx(Zs,{size:16,className:`sm:w-5 sm:h-5 transition-transform duration-200 ${b?"rotate-180":""}`})]}),b&&t.jsxs("div",{className:"mt-2 p-2.5 sm:p-3 bg-white/5 border border-white/10 rounded-lg space-y-3",children:[t.jsx("div",{children:t.jsxs("div",{className:"relative",children:[t.jsx(or,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-white/40"}),t.jsx("input",{type:"text",value:r,onChange:f=>i(f.target.value),placeholder:"Поиск по имени или описанию...",className:"w-full pl-9 pr-2.5 py-1.5 bg-black/40 border border-white/10 rounded-lg text-xs sm:text-sm text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent"})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] sm:text-xs font-medium text-white/60 mb-1.5 uppercase tracking-wider",children:"Типы проектов"}),t.jsx("div",{className:"flex flex-wrap gap-1.5 max-h-24 overflow-y-auto",children:n.length===0?t.jsx("p",{className:"text-[10px] text-white/40",children:"Нет типов"}):n.map(f=>{const g=o.includes(f.id);return t.jsx("button",{onClick:()=>N(f.id),className:`px-2 py-1 rounded-md text-[10px] sm:text-xs font-medium transition-all ${g?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50 shadow-sm shadow-indigo-500/20":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10 hover:border-white/20"}`,children:f.name},f.id)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] sm:text-xs font-medium text-white/60 mb-1.5 uppercase tracking-wider",children:"Роли"}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{value:"copywriter",label:"Копирайтер"},{value:"layout",label:"Верстальщик"},{value:"dsl",label:"DSL"},{value:"none",label:"Без роли"}].map(f=>{const g=l.includes(f.value);return t.jsx("button",{onClick:()=>k(f.value),className:`px-2 py-1 rounded-md text-[10px] sm:text-xs font-medium transition-all ${g?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50 shadow-sm shadow-indigo-500/20":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10 hover:border-white/20"}`,children:f.label},f.value)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] sm:text-xs font-medium text-white/60 mb-1.5 uppercase tracking-wider",children:"Модели"}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:rs.map(f=>{const g=c.includes(f.id);return t.jsx("button",{onClick:()=>D(f.id),className:`px-2 py-1 rounded-md text-[10px] sm:text-xs font-medium transition-all ${g?"bg-indigo-500/30 text-indigo-300 border border-indigo-500/50 shadow-sm shadow-indigo-500/20":"bg-white/5 text-white/70 border border-white/10 hover:bg-white/10 hover:border-white/20"}`,children:f.name},f.id)})})]}),C>0&&t.jsxs("button",{onClick:R,className:"w-full px-2.5 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-[10px] sm:text-xs text-white/80 transition-colors flex items-center justify-center gap-1.5",children:[t.jsx(zt,{size:12}),"Сбросить фильтры (",C,")"]})]})]}),!s&&e.length>0&&t.jsxs("div",{className:"mb-2 text-xs sm:text-sm text-white/60",children:["Показано ",T.length," из ",e.length," агентов"]}),s?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx(ge,{size:24,className:"animate-spin text-indigo-400"})}):t.jsx("div",{className:"space-y-2 sm:space-y-2",children:e.length===0?t.jsx("div",{className:"text-center py-6 sm:py-8 text-sm sm:text-base text-white/60",children:"Нет агентов. Создайте первого агента."}):T.length===0?t.jsx("div",{className:"text-center py-6 sm:py-8 text-sm sm:text-base text-white/60",children:"Нет агентов, соответствующих фильтрам."}):T.map(f=>t.jsxs("div",{onClick:()=>v(f),className:"group relative p-3 sm:p-3.5 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 hover:border-white/20 hover:shadow-lg hover:shadow-indigo-500/10 transition-all duration-200 cursor-pointer",children:[t.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-2 z-10",children:[f.createdAt&&t.jsxs("div",{className:"flex items-center gap-1 text-[9px] sm:text-[10px] text-white/50",children:[t.jsx(ar,{size:9,className:"text-white/30 shrink-0"}),t.jsx("span",{children:ds(f.createdAt)})]}),t.jsx("button",{onClick:g=>{g.stopPropagation(),y(f.id,f.name)},className:"p-1 rounded-lg text-white/40 hover:text-red-400 hover:bg-red-500/10 transition-all",title:"Удалить",children:t.jsx(Ot,{size:12,className:"sm:w-3.5 sm:h-3.5"})})]}),t.jsxs("div",{className:"flex-1 min-w-0 pr-16",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[jn(f.id,14,"sm:w-4 sm:h-4"),t.jsx("h3",{className:"text-xs sm:text-sm text-white font-semibold truncate",children:f.name})]}),f.description&&t.jsx("p",{className:"text-[10px] sm:text-xs text-white/60 mb-2.5 line-clamp-2 leading-tight",children:f.description}),f.projectTypes&&f.projectTypes.length>0&&t.jsx("div",{className:"flex items-center flex-wrap gap-1.5 mt-2",children:f.projectTypes.map(g=>t.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-500/20 text-indigo-300 text-[9px] sm:text-[10px] rounded-full border border-indigo-500/30 font-medium",children:g.name},g.id))})]})]},f.id))})]})},mo=({projectTypes:e,projectTypeAgents:s,loadingAgentsForType:n,isLoading:r,isCreating:i,newTypeName:o,setNewTypeName:l,newTypeIsAdminOnly:c,setNewTypeIsAdminOnly:u,editingId:h,editingName:p,setEditingName:m,editingIsAdminOnly:b,setEditingIsAdminOnly:x,setEditingId:w,reorderingTypeId:v,collapsedTypes:y,onCreate:N,onStartEdit:k,onSaveEdit:D,onDelete:R,onDragEnd:T,onToggleCollapse:C})=>{const f=Or(zs(ws,{activationConstraint:{distance:5}}),zs(xn,{activationConstraint:{delay:150,tolerance:5}}));return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-white/5 rounded-lg border border-white/10 p-3 sm:p-4 space-y-3 sm:space-y-4",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("h3",{className:"text-sm sm:text-base font-semibold text-white",children:"Создать новый тип проекта"})}),t.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[t.jsx("input",{type:"text",value:o,onChange:g=>l(g.target.value),onKeyPress:g=>g.key==="Enter"&&N(),placeholder:"Название типа проекта",className:"flex-1 px-2.5 sm:px-4 py-2 sm:py-2.5 text-sm bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-indigo-500/70 focus:border-transparent"}),t.jsxs("button",{onClick:N,disabled:i||!o.trim(),className:"px-2.5 sm:px-4 py-2 sm:py-2.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-xs sm:text-sm font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 sm:gap-2",children:[i?t.jsx(ge,{size:14,className:"sm:w-4 sm:h-4 animate-spin"}):t.jsx(ms,{size:14,className:"sm:w-4 sm:h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Создать"})]})]}),t.jsx("div",{className:"pt-2 border-t border-white/10",children:t.jsxs("label",{className:"flex items-start gap-2.5 sm:gap-3 text-sm sm:text-base text-white/80 cursor-pointer group",title:"Если включено, этот тип проекта будет доступен только администраторам",children:[t.jsx("div",{className:"relative flex-shrink-0 mt-0.5",children:t.jsx("input",{type:"checkbox",checked:c,onChange:g=>u(g.target.checked),className:"w-4 h-4 sm:w-5 sm:h-5 rounded border-white/30 bg-white/5 text-indigo-500 focus:ring-2 focus:ring-indigo-500/70 focus:ring-offset-0 cursor-pointer transition-all checked:bg-indigo-500 checked:border-indigo-500","aria-label":"Только для администратора","aria-describedby":"admin-only-hint"})}),t.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[t.jsx(Jt,{size:16,className:`sm:w-5 sm:h-5 flex-shrink-0 transition-colors ${c?"text-indigo-400":"text-white/50 group-hover:text-white/70"}`,"aria-hidden":"true"}),t.jsx("span",{className:"font-medium",children:"Только для администратора"}),t.jsxs("div",{className:"relative group/tooltip",children:[t.jsx(Ms,{size:14,className:"sm:w-4 sm:h-4 text-white/40 hover:text-white/60 transition-colors cursor-help","aria-label":"Подсказка"}),t.jsx("div",{id:"admin-only-hint",className:"absolute left-0 bottom-full mb-2 hidden group-hover/tooltip:block z-10 w-48 sm:w-64 p-2 bg-black/90 border border-white/20 rounded-lg text-xs text-white/90 shadow-lg",role:"tooltip",children:"Этот тип проекта будет виден и доступен только пользователям с правами администратора"})]})]})]})})]}),t.jsx("div",{className:"pt-2 sm:pt-3",children:r?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx(ge,{size:24,className:"animate-spin text-indigo-400"})}):t.jsx("div",{className:"space-y-3 sm:space-y-4",children:e.map(g=>{const E=[...s.get(g.id)||[]].sort((M,W)=>M.order===W.order?M.name.localeCompare(W.name):(M.order??0)-(W.order??0)),I=n.has(g.id);return t.jsxs("div",{className:`bg-white/5 rounded-lg border overflow-hidden ${g.isAdminOnly?"border-l-4 border-l-indigo-500/60 border-r border-t border-b border-white/10":"border border-white/10"}`,children:[t.jsx("div",{className:"flex items-center gap-2 sm:gap-3 p-2.5 sm:p-4 hover:bg-white/10 transition-colors",children:h===g.id?t.jsxs("div",{className:"flex-1 space-y-3",children:[t.jsx("input",{type:"text",value:p,onChange:M=>m(M.target.value),onKeyPress:M=>M.key==="Enter"&&D(g.id),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 text-sm bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/70",autoFocus:!0}),t.jsx("div",{className:"pt-2 border-t border-white/10",children:t.jsxs("label",{className:"flex items-start gap-2.5 sm:gap-3 text-sm sm:text-base text-white/80 cursor-pointer group",title:"Если включено, этот тип проекта будет доступен только администраторам",children:[t.jsx("div",{className:"relative flex-shrink-0 mt-0.5",children:t.jsx("input",{type:"checkbox",checked:b,onChange:M=>x(M.target.checked),className:"w-4 h-4 sm:w-5 sm:h-5 rounded border-white/30 bg-white/5 text-indigo-500 focus:ring-2 focus:ring-indigo-500/70 focus:ring-offset-0 cursor-pointer transition-all checked:bg-indigo-500 checked:border-indigo-500","aria-label":"Только для администратора","aria-describedby":`admin-only-edit-hint-${g.id}`})}),t.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[t.jsx(Jt,{size:16,className:`sm:w-5 sm:h-5 flex-shrink-0 transition-colors ${b?"text-indigo-400":"text-white/50 group-hover:text-white/70"}`,"aria-hidden":"true"}),t.jsx("span",{className:"font-medium",children:"Только для администратора"}),t.jsxs("div",{className:"relative group/tooltip",children:[t.jsx(Ms,{size:14,className:"sm:w-4 sm:h-4 text-white/40 hover:text-white/60 transition-colors cursor-help","aria-label":"Подсказка"}),t.jsx("div",{id:`admin-only-edit-hint-${g.id}`,className:"absolute left-0 bottom-full mb-2 hidden group-hover/tooltip:block z-10 w-48 sm:w-64 p-2 bg-black/90 border border-white/20 rounded-lg text-xs text-white/90 shadow-lg",role:"tooltip",children:"Этот тип проекта будет виден и доступен только пользователям с правами администратора"})]})]})]})}),t.jsxs("div",{className:"flex gap-2 pt-1",children:[t.jsx("button",{onClick:()=>D(g.id),className:"px-2 sm:px-3 py-1.5 sm:py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-xs sm:text-sm font-semibold transition-colors",children:"Сохранить"}),t.jsx("button",{onClick:()=>{w(null),m(""),x(!1)},className:"px-2 sm:px-3 py-1.5 sm:py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg text-xs sm:text-sm transition-colors",children:"Отмена"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>C(g.id),className:"p-1 rounded-lg text-white/40 hover:text-white/60 hover:bg-white/10 transition-all",title:y.has(g.id)?"Развернуть":"Свернуть",children:t.jsx(Zs,{size:16,className:`sm:w-5 sm:h-5 transition-transform duration-200 ${y.has(g.id)?"-rotate-90":""}`})}),t.jsxs("span",{className:"flex-1 text-white text-sm sm:text-base font-medium flex items-center gap-2 sm:gap-3",children:[g.isAdminOnly?t.jsx(Jt,{size:18,className:"sm:w-5 sm:h-5 text-indigo-400 flex-shrink-0","aria-label":"Только для администратора"}):t.jsx(lr,{size:18,className:"sm:w-5 sm:h-5 text-white/50 flex-shrink-0","aria-label":"Доступно всем пользователям"}),t.jsxs("span",{className:"flex items-center gap-2",children:[g.name,g.isAdminOnly&&t.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold bg-indigo-500/30 text-indigo-200 rounded-md border border-indigo-500/50 shadow-sm shadow-indigo-500/20",children:"Только админ"}),!g.isAdminOnly&&t.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-white/40 rounded-md border border-white/10 bg-white/5",children:"Для всех"})]}),E.length>0&&t.jsxs("span",{className:"text-xs text-white/50",children:["(",E.length," ",E.length===1?"агент":E.length<5?"агента":"агентов",")"]})]}),t.jsx("button",{onClick:()=>k(g),className:"p-1.5 sm:p-2 rounded-lg text-white/60 hover:text-indigo-400 hover:bg-indigo-500/10 transition-all",title:"Редактировать",children:t.jsx(tr,{size:14,className:"sm:w-4 sm:h-4"})}),g.id!=="default"&&t.jsx("button",{onClick:()=>R(g.id,g.name),className:"p-1.5 sm:p-2 rounded-lg text-white/60 hover:text-red-400 hover:bg-red-500/10 transition-all",title:"Удалить",children:t.jsx(Ot,{size:14,className:"sm:w-4 sm:h-4"})})]})}),!h&&!y.has(g.id)&&t.jsxs("div",{className:"px-2.5 sm:px-4 pb-2.5 sm:pb-4",children:[I?t.jsx("div",{className:"flex items-center justify-center py-4",children:t.jsx(ge,{size:16,className:"animate-spin text-indigo-400"})}):E.length===0?t.jsx("div",{className:"text-xs sm:text-sm text-white/40 py-2 px-2",children:"Нет прикрепленных агентов"}):t.jsx(Gi,{sensors:f,collisionDetection:Ur,onDragEnd:M=>T(M,g.id),children:t.jsx(Zi,{items:E.map(M=>M.id),strategy:Ji,children:t.jsx("div",{className:"space-y-1.5 sm:space-y-2 mt-2",children:E.map((M,W)=>t.jsx(lo,{agent:M,index:W},M.id))})})}),v===g.id&&t.jsxs("div",{className:"flex items-center justify-center py-2 mt-2",children:[t.jsx(ge,{size:14,className:"animate-spin text-indigo-400 mr-2"}),t.jsx("span",{className:"text-xs text-white/60",children:"Сохранение порядка..."})]})]})]},g.id)})})})]})},Ys="admin_agent_draft",xo=({onAgentUpdated:e,projectTypes:s})=>{const[n,r]=a.useState(!1),[i,o]=a.useState(null),[l,c]=a.useState([]),u=a.useRef(e);return a.useEffect(()=>{u.current=e},[e]),{isAgentDialogOpen:n,editingAgent:i,agentFiles:l,setAgentFiles:c,handleOpenAgentDialog:async b=>{if(b&&typeof b=="object"&&"id"in b&&"name"in b){if(o(b),b.id)try{const{files:x}=await $.getAdminAgentFiles(b.id);c(x.map(w=>({id:w.id,name:w.name,type:w.mimeType,data:w.content,agentId:w.agentId})))}catch(x){console.error("Failed to load agent files",x),c([])}else c([]);localStorage.removeItem(Ys)}else try{const{agent:x}=await $.createAgentTemplate({name:"Новый агент",description:"",systemInstruction:"",summaryInstruction:"",model:B.GPT5_MINI,isHiddenFromSidebar:!1});if(!x?.id)throw console.error("Created agent does not have an ID:",x),new Error("Агент создан без ID. Пожалуйста, попробуйте еще раз.");const w={...x,id:x.id};o(w),c([])}catch(x){throw console.error("Failed to create agent",x),x}r(!0)},handleCloseAgentDialog:()=>{localStorage.removeItem(Ys),r(!1),o(null),c([])},onAgentUpdatedRef:u,updateEditingAgent:b=>{o(b)}}},qs="admin_agent_draft",ho=({editingAgent:e,isDialogOpen:s})=>{const[n,r]=a.useState(""),[i,o]=a.useState(""),[l,c]=a.useState(""),[u,h]=a.useState(""),[p,m]=a.useState(B.GPT5_MINI),[b,x]=a.useState(""),[w,v]=a.useState(!1),[y,N]=a.useState(!1),[k,D]=a.useState([]),[R,T]=a.useState([]),[C,f]=a.useState(!1),[g,A]=a.useState(!1),[E,I]=a.useState(!1),M=a.useRef([]);a.useEffect(()=>{if(e&&s){r(e.name||""),o(e.description||""),c(e.systemInstruction||""),h(e.summaryInstruction||""),m(us(e.model)),x(e.role||""),v(e.isHiddenFromSidebar||!1),N(e.disableGlobalPrompt||!1),D(e.quickMessages||[]);const H=e.projectTypes?.map(O=>O.id)||[];T(H),M.current=[...H]}else!e&&s&&(r(""),o(""),c(""),h(""),m(B.GPT5_MINI),x(""),v(!1),N(!1),D([]),T([]),M.current=[])},[e,s]),a.useEffect(()=>{if(s&&e)try{const H=localStorage.getItem(qs);if(!H)return;const O=JSON.parse(H);if(O.agentId&&e&&O.agentId===e.id){r(O.name||""),o(O.description||""),c(O.systemInstruction||""),h(O.summaryInstruction||""),m(O.model||B.GPT5_MINI),x(O.role||""),v(O.isHiddenFromSidebar||!1),N(O.disableGlobalPrompt||!1),D(O.quickMessages||[]);const X=O.selectedProjectTypeIds||[];T(X),M.current=[...X]}}catch(H){console.error("Failed to load draft from localStorage",H)}},[s,e]);const W=()=>{if(!e)return;const H={agentId:e.id,name:n,description:i,systemInstruction:l,summaryInstruction:u,model:p,role:b,isHiddenFromSidebar:w,disableGlobalPrompt:y,quickMessages:k,selectedProjectTypeIds:R};try{localStorage.setItem(qs,JSON.stringify(H))}catch(O){console.error("Failed to save draft to localStorage",O)}};return a.useEffect(()=>{e&&s&&W()},[n,i,l,u,p,b,w,y,k,R,e?.id,s]),{agentName:n,setAgentName:r,agentDescription:i,setAgentDescription:o,agentSystemInstruction:l,setAgentSystemInstruction:c,agentSummaryInstruction:u,setAgentSummaryInstruction:h,agentModel:p,setAgentModel:m,agentRole:b,setAgentRole:x,agentIsHiddenFromSidebar:w,setAgentIsHiddenFromSidebar:v,agentDisableGlobalPrompt:y,setAgentDisableGlobalPrompt:N,agentQuickMessages:k,setAgentQuickMessages:D,selectedProjectTypeIds:R,setSelectedProjectTypeIds:T,isProjectTypesDropdownOpen:C,setIsProjectTypesDropdownOpen:f,isRoleDropdownOpen:g,setIsRoleDropdownOpen:A,isModelDropdownOpen:E,setIsModelDropdownOpen:I,toggleProjectType:H=>{T(O=>O.includes(H)?O.filter(X=>X!==H):[...O,H])},initialProjectTypeIdsRef:M}},po=({editingAgent:e,agentName:s,agentDescription:n,agentSystemInstruction:r,agentSummaryInstruction:i,agentModel:o,agentRole:l,agentIsHiddenFromSidebar:c,agentDisableGlobalPrompt:u,agentQuickMessages:h,selectedProjectTypeIds:p,initialProjectTypeIdsRef:m,onAgentUpdatedRef:b,loadAgents:x,loadAgentsForType:w,onEditingAgentUpdated:v})=>{const y=a.useRef(null),N=async()=>{!e||!s?.trim()||e.id&&(y.current&&clearTimeout(y.current),y.current=setTimeout(async()=>{try{await $.updateAgentTemplate(e.id,{name:s?.trim()||"",description:n?.trim()||"",systemInstruction:r?.trim()||"",summaryInstruction:i?.trim()||"",model:o,role:l?.trim()||void 0,isHiddenFromSidebar:c,disableGlobalPrompt:u,quickMessages:h||[]});const D=m.current,R=p;if(D.length!==R.length||!D.every(C=>R.includes(C))||!R.every(C=>D.includes(C)))try{await $.attachAgentToProjectTypes(e.id,p),m.current=[...p];const C=new Set([...p,...e.projectTypes?.map(f=>f.id)||[]]);await Promise.all(Array.from(C).map(f=>w(f)))}catch{}await x(),b.current&&b.current();try{const{agent:C}=await $.getAgent(e.id);let f=[];try{const{projectTypes:A}=await $.getAgentProjectTypes(e.id);f=A}catch{}const g={...C,projectTypes:f};v&&v(g),y.current&&(clearTimeout(y.current),y.current=null)}catch{}}catch{}},1e3))};return a.useEffect(()=>(e&&e.id&&N(),()=>{y.current&&clearTimeout(y.current)}),[s,n,r,i,o,l,c,u,h,p,e?.id]),{saveTimeoutRef:y,clearSaveTimeout:()=>{y.current&&(clearTimeout(y.current),y.current=null)}}},fo=2*1024*1024,go=[".txt",".md"],bo=["text/plain","text/markdown"],vo=e=>new Promise((s,n)=>{const r=new FileReader;r.onload=()=>{const i=r.result;s(i.split(",")[1])},r.onerror=n,r.readAsDataURL(e)}),wo=({editingAgent:e,agentFiles:s,setAgentFiles:n,showAlert:r,showConfirm:i})=>{const[o,l]=a.useState(!1),c=a.useRef(null),u=async x=>{if(!e||!x.length){e||r("Сначала создайте агента","Ошибка","error",5e3);return}l(!0);const w=[],v=[];for(let y=0;y<x.length;y++){const N=x[y],k=N.name.toLowerCase().substring(N.name.lastIndexOf(".")),D=go.includes(k),R=!N.type||bo.includes(N.type);if(!D&&!R){v.push(`Файл ${N.name} не поддерживается. Разрешены только .txt и .md файлы.`);continue}if(N.size>fo){v.push(`Файл ${N.name} слишком большой (>2MB)`);continue}try{const T=await vo(N),{file:C}=await $.uploadAdminAgentFile(e.id,{name:N.name,mimeType:N.type||"text/plain",content:T,isKnowledgeBase:!0});w.push({id:C.id,name:C.name,type:C.mimeType,data:C.content,agentId:C.agentId})}catch(T){console.error("File upload failed",T);let C=`Не удалось загрузить ${N.name}`;const f=T?.status||T?.statusCode||"unknown";f===500?C+=": Ошибка сервера. Возможно, миграция базы данных не применена.":f===404?C+=": Агент не найден.":f===401||f===403?C+=": Недостаточно прав доступа.":T?.message?C+=`: ${T.message}`:C+=": Неизвестная ошибка. Проверьте консоль браузера.",v.push(C)}}if(v.length>0&&r(`Ошибки при загрузке файлов:
${v.join(`
`)}`,"Ошибка","error",5e3),w.length>0){n(y=>[...y,...w]);try{const{files:y}=await $.getAdminAgentFiles(e.id);n(y.map(N=>({id:N.id,name:N.name,type:N.mimeType,data:N.content,agentId:N.agentId})))}catch(y){console.error("[AdminPage] Failed to reload files after upload",y)}r(`Успешно загружено файлов: ${w.length}`,"Успех","success",3e3)}l(!1),c.current&&(c.current.value="")};return{isUploadingFiles:o,fileInputRef:c,handleFileChange:x=>{x.target.files&&x.target.files.length>0&&u(x.target.files)},handleDragOver:x=>{x.preventDefault(),x.stopPropagation()},handleDrop:x=>{x.preventDefault(),x.stopPropagation(),x.dataTransfer.files&&x.dataTransfer.files.length>0&&u(x.dataTransfer.files)},handleRemoveFile:async x=>{e&&i("Удалить файл из базы знаний?",`Файл будет удален из базы знаний.

Это действие нельзя отменить.`,async()=>{try{await $.deleteAdminAgentFile(e.id,x),n(w=>w.filter(v=>v.id!==x)),r("Файл успешно удален",void 0,"success",3e3)}catch(w){console.error("Failed to remove file",w),r(`Не удалось удалить файл: ${w?.message||"Неизвестная ошибка"}`,"Ошибка","error",5e3)}},"danger")}}},Ks="admin_agents_filters",yo=()=>{const[e,s]=a.useState(""),[n,r]=a.useState([]),[i,o]=a.useState([]),[l,c]=a.useState([]),[u,h]=a.useState(!1);return a.useEffect(()=>{try{const w=localStorage.getItem(Ks);if(w){const v=JSON.parse(w);s(v.searchQuery||""),r(v.selectedProjectTypeFilters||[]),o(v.selectedRoleFilters||[]),c(v.selectedModelFilters||[])}}catch(w){console.error("Failed to load filters from localStorage",w)}},[]),a.useEffect(()=>{try{localStorage.setItem(Ks,JSON.stringify({searchQuery:e,selectedProjectTypeFilters:n,selectedRoleFilters:i,selectedModelFilters:l}))}catch(w){console.error("Failed to save filters to localStorage",w)}},[e,n,i,l]),{searchQuery:e,setSearchQuery:s,selectedProjectTypeFilters:n,selectedRoleFilters:i,selectedModelFilters:l,isFiltersOpen:u,setIsFiltersOpen:h,toggleProjectTypeFilter:w=>{r(v=>v.includes(w)?v.filter(y=>y!==w):[...v,w])},toggleRoleFilter:w=>{o(v=>v.includes(w)?v.filter(y=>y!==w):[...v,w])},toggleModelFilter:w=>{c(v=>v.includes(w)?v.filter(y=>y!==w):[...v,w])},resetFilters:()=>{s(""),r([]),o([]),c([])}}},Vs="admin_agents_sort",jo=()=>{const[e,s]=a.useState("name"),[n,r]=a.useState("asc"),[i,o]=a.useState(!1);return a.useEffect(()=>{try{const l=localStorage.getItem(Vs);if(l){const c=JSON.parse(l);s(c.sortBy||"name"),r(c.sortOrder||"asc")}}catch(l){console.error("Failed to load sort from localStorage",l)}},[]),a.useEffect(()=>{try{localStorage.setItem(Vs,JSON.stringify({sortBy:e,sortOrder:n}))}catch(l){console.error("Failed to save sort to localStorage",l)}},[e,n]),{sortBy:e,setSortBy:s,sortOrder:n,setSortOrder:r,isSortDropdownOpen:i,setIsSortDropdownOpen:o}},No=5e3,So=e=>{const[s,n]=a.useState(""),[r,i]=a.useState(""),[o,l]=a.useState(!1),[c,u]=a.useState(!1),[h,p]=a.useState(null),[m,b]=a.useState(null),x=a.useMemo(()=>s!==r,[s,r]),w=a.useMemo(()=>{if(!h)return null;try{return new Date(h).toLocaleString("ru-RU")}catch{return h}},[h]),v=a.useCallback(async()=>{l(!0),b(null);try{const{globalPrompt:N}=await $.getGlobalPrompt(),k=N?.content??"";n(k),i(k),p(N?.updatedAt??N?.createdAt??null)}catch(N){N?.status===404?(n(""),i(""),p(null)):(console.error("Failed to load global prompt",N),b(N?.message||"Не удалось загрузить глобальный промт"))}finally{l(!1)}},[]);return{globalPrompt:s,setGlobalPrompt:n,initialGlobalPrompt:r,isLoadingGlobalPrompt:o,isSavingGlobalPrompt:c,globalPromptUpdatedAt:h,globalPromptError:m,setGlobalPromptError:b,globalPromptHasChanges:x,formattedGlobalPromptUpdatedAt:w,GLOBAL_PROMPT_LIMIT:No,loadGlobalPrompt:v,handleSaveGlobalPrompt:async()=>{if(!(c||o||!x)){u(!0),b(null);try{const{globalPrompt:N}=await $.updateGlobalPrompt({content:s}),k=N?.content??"";n(k),i(k),p(N?.updatedAt??N?.createdAt??null),e("Глобальный промт обновлён и будет применяться ко всем агентам","Готово","success",3e3)}catch(N){let k=N?.message||"Не удалось сохранить глобальный промт";N?.status===404&&(k="Функция глобального промта не доступна на сервере (404). Возможно, требуется обновление сервера."),b(k),e(k,"Ошибка","error",4e3)}finally{u(!1)}}}}},zo=({onClose:e,onOpenStorybook:s,initialAgentId:n,onAgentUpdated:r})=>{const[i,o]=a.useState("agents"),[l,c]=a.useState([]),[u,h]=a.useState(!1),[p,m]=a.useState(!1),[b,x]=a.useState(""),[w,v]=a.useState(!1),[y,N]=a.useState(null),[k,D]=a.useState(""),[R,T]=a.useState(!1),[C,f]=a.useState(new Map),[g,A]=a.useState(new Set),[E,I]=a.useState(null),[M,W]=a.useState(new Set),[te,H]=a.useState([]),[O,X]=a.useState(!1),[Ze,ke]=a.useState(!1),[Oe,Ue]=a.useState(!1),[se,xe]=a.useState([]),[Pe,Le]=a.useState(!1),[ie,et]=a.useState(0),[De,be]=a.useState(0),P=a.useRef(!1),[ve,oe]=a.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[he,re]=a.useState({isOpen:!1,message:""}),Te=(d,j,S,z="danger")=>{oe({isOpen:!0,title:d,message:j,onConfirm:()=>{S(),oe(L=>({...L,isOpen:!1}))},variant:z})},U=(d,j,S="info",z=0)=>{re({isOpen:!0,message:d,title:j,variant:S,duration:z}),z>0&&setTimeout(()=>{re(L=>({...L,isOpen:!1}))},z)},{isAgentDialogOpen:ze,editingAgent:Y,agentFiles:Be,setAgentFiles:we,handleOpenAgentDialog:We,handleCloseAgentDialog:tt,onAgentUpdatedRef:st,updateEditingAgent:St}=xo({onAgentUpdated:r,projectTypes:l}),{agentName:Re,setAgentName:Ct,agentDescription:ye,setAgentDescription:Ae,agentSystemInstruction:ae,setAgentSystemInstruction:lt,agentSummaryInstruction:de,setAgentSummaryInstruction:ct,agentModel:nt,setAgentModel:kt,agentRole:ue,setAgentRole:dt,agentIsHiddenFromSidebar:He,setAgentIsHiddenFromSidebar:ut,agentDisableGlobalPrompt:Xe,setAgentDisableGlobalPrompt:Dt,agentQuickMessages:Fe,setAgentQuickMessages:q,selectedProjectTypeIds:G,setSelectedProjectTypeIds:ne,isProjectTypesDropdownOpen:pe,setIsProjectTypesDropdownOpen:V,isRoleDropdownOpen:Z,setIsRoleDropdownOpen:ee,isModelDropdownOpen:Ee,setIsModelDropdownOpen:_,toggleProjectType:je,initialProjectTypeIdsRef:me}=ho({editingAgent:Y,isDialogOpen:ze}),{searchQuery:Ne,setSearchQuery:Ye,selectedProjectTypeFilters:qe,selectedRoleFilters:Me,selectedModelFilters:Ke,isFiltersOpen:mt,setIsFiltersOpen:Nn,toggleProjectTypeFilter:Sn,toggleRoleFilter:Cn,toggleModelFilter:kn,resetFilters:Dn}=yo(),{sortBy:Tn,setSortBy:Rn,sortOrder:An,setSortOrder:En}=jo(),{globalPrompt:js,setGlobalPrompt:Mn,isLoadingGlobalPrompt:Ns,isSavingGlobalPrompt:Ss,globalPromptError:Ht,setGlobalPromptError:In,globalPromptHasChanges:Pn,formattedGlobalPromptUpdatedAt:Cs,GLOBAL_PROMPT_LIMIT:ks,loadGlobalPrompt:Ds,handleSaveGlobalPrompt:zn}=So(U),{isUploadingFiles:xt,fileInputRef:Ts,handleFileChange:Fn,handleDragOver:On,handleDrop:Ln,handleRemoveFile:$n}=wo({editingAgent:Y,agentFiles:Be,setAgentFiles:we,showAlert:U,showConfirm:Te});a.useEffect(()=>{Tt()},[]),a.useEffect(()=>{Ds()},[Ds]),a.useEffect(()=>{i==="agents"?At():i==="users"&&Rs()},[i]),a.useEffect(()=>{P.current=!1,n&&o("agents")},[n]),a.useEffect(()=>{if(n&&!ze&&!P.current){P.current=!0;let d=!0;return(async()=>{try{const{agent:S}=await $.getAgent(n);if(!d)return;let z=[];try{const{projectTypes:Se}=await $.getAgentProjectTypes(n);z=Se}catch{}if(!d)return;let L=[];try{const{files:Se}=await $.getAdminAgentFiles(n);L=Se.map(Je=>({id:Je.id,name:Je.name,type:Je.mimeType,data:Je.content,agentId:Je.agentId}))}catch(Se){console.error("Failed to load agent files",Se)}if(!d)return;const J={...S,projectTypes:z};setEditingAgent(J),Ct(S.name||""),Ae(S.description||""),lt(S.systemInstruction||""),ct(S.summaryInstruction||""),kt(us(S.model)),dt(S.role||""),ut(S.isHiddenFromSidebar||!1),Dt(S.disableGlobalPrompt||!1),q(S.quickMessages||[]);const Ve=z.map(Se=>Se.id);ne(Ve),me.current=[...Ve],we(L),setIsAgentDialogOpen(!0)}catch(S){console.error("Failed to load agent directly",S),d&&(S?.message?.includes("не найден")||S?.message?.includes("not found")||S?.status===404?(re({isOpen:!0,message:"Агент был удалён или не существует",title:"Агент не найден",variant:"warning",duration:3e3}),setTimeout(()=>{re(L=>({...L,isOpen:!1}))},3e3)):P.current=!1)}})(),()=>{d=!1}}},[n,ze]),a.useEffect(()=>{if(n&&te.length>0&&!ze&&!P.current){const d=te.find(j=>j.id===n);d&&(P.current=!0,We(d))}},[n,te,ze]);const Tt=async()=>{h(!0);try{const{projectTypes:d}=await $.getProjectTypes();c(d),await Gn(d)}catch(d){console.error("Failed to load project types",d)}finally{h(!1)}},Gn=async d=>{const j=new Map,S=new Set,z=d.map(async L=>{S.add(L.id);try{const{agents:J}=await $.getProjectTypeAgents(L.id);j.set(L.id,J)}catch(J){console.error(`Failed to load agents for project type ${L.id}`,J),j.set(L.id,[])}finally{S.delete(L.id)}});await Promise.all(z),f(j),A(S)},Rt=async d=>{A(j=>new Set(j).add(d));try{const{agents:j}=await $.getProjectTypeAgents(d);f(S=>{const z=new Map(S);return z.set(d,j),z})}catch(j){console.error(`Failed to load agents for project type ${d}`,j),f(S=>{const z=new Map(S);return z.set(d,[]),z})}finally{A(j=>{const S=new Set(j);return S.delete(d),S})}},At=async()=>{X(!0);try{const{agents:d}=await $.getAllAgents();H(d)}catch(d){console.error("Failed to load agents",d),d?.status!==404&&U("Не удалось загрузить список агентов","Ошибка","error",5e3)}finally{X(!1)}},Rs=async()=>{Le(!0);try{const d=await $.getUsers(),j=d?.users||[];xe(j),et(d?.totalUsers??0),be(d?.totalProjects??0)}catch(d){if(console.error("[AdminPage] Failed to load users",{name:d?.name,stack:d?.stack}),xe([]),d?.status===403)U("Доступ запрещен. Требуются права администратора. Убедитесь, что вы вошли под учетной записью администратора.","Ошибка доступа","error",5e3);else if(d?.status!==404){const j=d?.message||"Неизвестная ошибка";U(`Не удалось загрузить список пользователей: ${j}`,"Ошибка","error",5e3)}}finally{Le(!1)}},_n=async()=>{if(b.trim()){m(!0);try{const{projectType:d}=await $.createProjectType(b.trim(),w);x(""),v(!1),await Tt(),await Rt(d.id)}catch(d){console.error("Failed to create project type",d)}finally{m(!1)}}},Un=d=>{N(d.id),D(d.name),T(d.isAdminOnly??!1)},Bn=async d=>{if(k.trim())try{await $.updateProjectType(d,k.trim(),R),N(null),D(""),T(!1),await Tt()}catch(j){console.error("Failed to update project type",j)}},Wn=async(d,j)=>{Te("Удалить тип проекта?",`Удалить тип проекта "${j}"?`,async()=>{try{await $.deleteProjectType(d),await Tt()}catch(S){U(S?.message||"Не удалось удалить тип проекта","Ошибка","error",5e3)}},"danger")},{saveTimeoutRef:Hn}=po({editingAgent:Y,agentName:Re,agentDescription:ye,agentSystemInstruction:ae,agentSummaryInstruction:de,agentModel:nt,agentRole:ue,agentIsHiddenFromSidebar:He,agentDisableGlobalPrompt:Xe,agentQuickMessages:Fe,selectedProjectTypeIds:G,initialProjectTypeIdsRef:me,onAgentUpdatedRef:st,loadAgents:At,loadAgentsForType:Rt,onEditingAgentUpdated:St}),As=async d=>{try{await We(d),d||await At()}catch(j){console.error("Failed to open agent dialog",j);const S=j?.status===404?"Эндпоинт для создания агентов не найден. Убедитесь, что сервер перезапущен.":j?.message||"Не удалось создать агента";U(S,"Ошибка","error",5e3)}},Xn=async()=>{if(!Y?.id){U("Агент еще не создан. Пожалуйста, подождите...","Ошибка","error",3e3);return}if(!(Re||"").trim()){U("Для генерации описания необходимо указать название агента","Ошибка","error",3e3);return}if(!(ae||"").trim()){U("Для генерации описания необходимо указать системную инструкцию агента","Ошибка","error",3e3);return}Ue(!0);try{const{description:d}=await $.generateAgentDescription(Y.id);Ae(d),U("Описание успешно сгенерировано",void 0,"success",2e3)}catch(d){console.error("Failed to generate description",d),U(d?.message||"Не удалось сгенерировать описание","Ошибка","error",5e3)}finally{Ue(!1)}},Yn=async(d,j)=>{Te(`Удалить агента "${j}"?`,`Агент и все связанные данные будут безвозвратно удалены.

Это действие нельзя отменить.`,async()=>{try{await $.deleteAgentTemplate(d),await At(),U("Агент успешно удален",void 0,"success",3e3)}catch(S){U(S?.message||"Не удалось удалить агента","Ошибка","error",5e3)}},"danger")},Es=d=>d===B.GPT4O_MINI?t.jsx(Qs,{size:14,className:"text-amber-400"}):d===B.GPT52?t.jsx(Pt,{size:14,className:"text-violet-400"}):d===B.GPT51?t.jsx(Pt,{size:14,className:"text-emerald-300"}):t.jsx(ss,{size:14,className:"text-pink-400"}),qn=async(d,j)=>{I(d);try{const S=j.map((L,J)=>({id:L.id,order:J}));await $.reorderProjectTypeAgents(d,S);const z=j.map((L,J)=>({...L,order:J}));f(L=>{const J=new Map(L);return J.set(d,z),J}),await Rt(d),setTimeout(()=>{st.current&&st.current()},500)}catch(S){console.error("Failed to reorder agents",S),U(S?.message||"Не удалось изменить порядок агентов","Ошибка","error",5e3),await Rt(d)}finally{I(null)}},Kn=(d,j)=>{const{active:S,over:z}=d;if(!z||S.id===z.id)return;const J=[...C.get(j)||[]].sort((Qe,Xt)=>Qe.order===Xt.order?Qe.name.localeCompare(Xt.name):(Qe.order??0)-(Xt.order??0)),Ve=J.findIndex(Qe=>Qe.id===S.id),Se=J.findIndex(Qe=>Qe.id===z.id);if(Ve===-1||Se===-1)return;const Je=ys(J,Ve,Se);qn(j,Je)},Vn=d=>{W(j=>{const S=new Set(j);return S.has(d)?S.delete(d):S.add(d),S})};return t.jsxs("div",{className:"h-screen bg-gradient-to-br from-black via-black to-indigo-950/20 overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"container mx-auto px-3 sm:px-4 py-3 sm:py-6 max-w-6xl w-full flex flex-col flex-1 min-h-0 overflow-hidden",children:[t.jsxs("div",{className:"mb-4 sm:mb-6 shrink-0",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:[t.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-white",children:"Админ-панель"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>s?.(),className:"px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg bg-indigo-500/15 text-indigo-200 hover:bg-indigo-500/25 hover:text-white transition-colors flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[t.jsx(Et,{size:16,className:"sm:w-4 sm:h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"UI Kit"}),t.jsx("span",{className:"sm:hidden",children:"UI"})]}),t.jsxs("button",{onClick:e,className:"px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg bg-white/5 text-white/60 hover:bg-white/20 hover:text-white transition-colors flex items-center gap-1 sm:gap-2 text-sm sm:text-base",children:[t.jsx(zt,{size:16,className:"sm:w-5 sm:h-5"}),t.jsx("span",{className:"hidden sm:inline",children:"Назад"})]})]})]}),t.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[t.jsx("button",{onClick:()=>o("agents"),className:`flex-1 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all ${i==="agents"?"bg-indigo-500/20 text-indigo-300 border border-indigo-500/30":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white/80"}`,children:"Агенты"}),t.jsx("button",{onClick:()=>o("projectTypes"),className:`flex-1 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all ${i==="projectTypes"?"bg-indigo-500/20 text-indigo-300 border border-indigo-500/30":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white/80"}`,children:"Типы проектов"}),t.jsx("button",{onClick:()=>o("users"),className:`flex-1 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all ${i==="users"?"bg-indigo-500/20 text-indigo-300 border border-indigo-500/30":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white/80"}`,children:"Пользователи"})]})]}),t.jsx("div",{className:"space-y-3 sm:space-y-4 flex-1 min-h-0 overflow-y-auto overflow-x-hidden",children:i==="projectTypes"?t.jsx(mo,{projectTypes:l,projectTypeAgents:C,loadingAgentsForType:g,isLoading:u,isCreating:p,newTypeName:b,setNewTypeName:x,newTypeIsAdminOnly:w,setNewTypeIsAdminOnly:v,editingId:y,editingName:k,setEditingName:D,editingIsAdminOnly:R,setEditingIsAdminOnly:T,setEditingId:N,reorderingTypeId:E,collapsedTypes:M,onCreate:_n,onStartEdit:Un,onSaveEdit:Bn,onDelete:Wn,onDragEnd:Kn,onToggleCollapse:Vn}):i==="agents"?t.jsx(uo,{agents:te,isLoadingAgents:O,projectTypes:l,searchQuery:Ne,setSearchQuery:Ye,selectedProjectTypeFilters:qe,selectedRoleFilters:Me,selectedModelFilters:Ke,sortBy:Tn,sortOrder:An,setSortBy:Rn,setSortOrder:En,isFiltersOpen:mt,setIsFiltersOpen:Nn,onCreateAgent:As,onEditAgent:As,onDeleteAgent:Yn,onToggleProjectTypeFilter:Sn,onToggleRoleFilter:Cn,onToggleModelFilter:kn,onResetFilters:Dn}):t.jsx(co,{users:se,isLoadingUsers:Pe,totalUsers:ie,totalProjects:De,onUsersReload:Rs})})]}),ze&&t.jsx("div",{className:"fixed inset-0 z-[110] bg-black/95 backdrop-blur-2xl flex flex-col items-stretch justify-start p-0 overflow-y-auto overflow-x-hidden",onClick:d=>{d.target===d.currentTarget&&(V(!1),ee(!1),_(!1))},children:t.jsxs("div",{className:"w-full min-h-full bg-gradient-to-b from-black/90 via-black/80 to-black/90 backdrop-blur-2xl border-0 rounded-none shadow-none flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"border-b border-white/10 bg-white/5 shrink-0",children:[t.jsxs("div",{className:"p-3 sm:p-4 md:p-6 flex justify-between items-center",children:[t.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-white",children:Y?"Редактировать агента":"Создать агента"}),t.jsx("button",{onClick:tt,className:"p-1.5 sm:p-2 rounded-lg bg-white/5 text-white/60 hover:bg-white/20 hover:text-white transition-colors",children:t.jsx(zt,{size:18,className:"sm:w-5 sm:h-5"})})]}),t.jsx("div",{className:"px-3 sm:px-4 md:px-6 pb-2 sm:pb-3",children:t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsx("div",{className:"flex items-center gap-2",children:(()=>{if(!Y)return null;const d=Fe||[],j=Y.quickMessages||[],S=d.length!==j.length||!d.every((J,Ve)=>J===j[Ve]),z=(Re||"").trim()!==(Y.name||"")||(ye||"").trim()!==(Y.description||"")||(ae||"").trim()!==(Y.systemInstruction||"")||(de||"").trim()!==(Y.summaryInstruction||"")||nt!==us(Y.model)||ue!==(Y.role||"")||He!==(Y.isHiddenFromSidebar||!1)||Xe!==(Y.disableGlobalPrompt||!1)||S;if(Ze)return t.jsxs(t.Fragment,{children:[t.jsx(ge,{size:12,className:"animate-spin text-indigo-400"}),t.jsx("span",{className:"text-indigo-400",children:"Сохранение..."})]});const L=Hn?.current!==null;return z&&L?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-400 animate-pulse"}),t.jsx("span",{className:"text-amber-400",children:"Сохранение через 1 сек..."})]}):z&&!L?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-400 animate-pulse"}),t.jsx("span",{className:"text-amber-400",children:"Изменения не сохранены"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-400"}),t.jsx("span",{className:"text-emerald-400",children:"Все изменения сохранены"})]})})()}),t.jsx("span",{className:"text-white/30 text-[10px]",children:"Автосохранение включено"})]})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6",children:[t.jsxs("div",{className:"space-y-3 sm:space-y-4 p-3 sm:p-4 md:p-5 bg-gradient-to-br from-indigo-950/30 to-purple-950/20 rounded-xl sm:rounded-2xl border border-indigo-500/20",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-3 sm:mb-4",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-indigo-500/20 rounded-lg",children:t.jsx(Js,{size:12,className:"sm:w-3.5 sm:h-3.5 text-indigo-300"})}),t.jsx("h3",{className:"text-xs sm:text-sm font-bold text-white",children:"Основная информация"})]}),t.jsxs("section",{children:[t.jsxs("label",{className:"flex items-center gap-1.5 sm:gap-2 text-[9px] sm:text-[10px] font-bold text-white/50 uppercase tracking-widest mb-1.5 sm:mb-2",children:["Имя агента",t.jsx("span",{className:"text-red-400",children:"*"}),t.jsxs("div",{className:"group relative",children:[t.jsx($e,{size:9,className:"sm:w-2.5 sm:h-2.5 text-white/30 hover:text-white/60 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-full mt-2 w-40 sm:w-48 p-1.5 sm:p-2 bg-black/95 border border-white/10 rounded-lg text-[9px] sm:text-[10px] text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 pointer-events-none",children:"Уникальное имя для идентификации агента в системе"})]})]}),t.jsxs("div",{className:"relative group",children:[t.jsx("input",{type:"text",value:Re,onChange:d=>Ct(d.target.value),className:`w-full bg-black/40 border rounded-lg sm:rounded-xl px-2.5 sm:px-4 py-2 sm:py-3 pl-8 sm:pl-10 pr-14 sm:pr-20 text-xs sm:text-sm text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent transition-all shadow-inner ${(Re||"").trim()?"border-white/10":"border-red-500/30 focus:border-red-500/50"}`,placeholder:"Например: Ассистент по маркетингу",maxLength:100}),t.jsx(yr,{size:12,className:"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 text-white/30 group-focus-within:text-indigo-400 transition-colors sm:w-3.5 sm:h-3.5"}),t.jsxs("div",{className:"absolute right-1.5 sm:right-3 top-1/2 -translate-y-1/2 text-[9px] sm:text-[10px] text-white/30",children:[(Re||"").length,"/100"]})]}),!(Re||"").trim()&&t.jsx("p",{className:"mt-1 text-[9px] sm:text-[10px] text-red-400",children:"Имя агента обязательно"})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5 sm:mb-2",children:[t.jsxs("label",{className:"flex items-center gap-1.5 sm:gap-2 text-[9px] sm:text-[10px] font-bold text-white/50 uppercase tracking-widest",children:["Описание",t.jsxs("div",{className:"group relative",children:[t.jsx($e,{size:9,className:"sm:w-2.5 sm:h-2.5 text-white/30 hover:text-white/60 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-full mt-2 w-40 sm:w-48 p-1.5 sm:p-2 bg-black/95 border border-white/10 rounded-lg text-[9px] sm:text-[10px] text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 pointer-events-none",children:"Краткое описание назначения и функций агента"})]})]}),t.jsx("button",{type:"button",onClick:Xn,disabled:Oe||!Y?.id||!(Re||"").trim()||!(ae||"").trim(),className:"flex items-center gap-1.5 px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-300 border border-indigo-500/30 text-[9px] sm:text-[10px] font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-indigo-500/20",children:Oe?t.jsxs(t.Fragment,{children:[t.jsx(ge,{size:12,className:"animate-spin"}),t.jsx("span",{className:"hidden sm:inline",children:"Генерация..."}),t.jsx("span",{className:"sm:hidden",children:"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(ns,{size:12}),t.jsx("span",{className:"hidden sm:inline",children:"Сгенерировать описание"}),t.jsx("span",{className:"sm:hidden",children:"Сгенерировать"})]})})]}),t.jsx("textarea",{value:ye,onChange:d=>Ae(d.target.value),className:"w-full h-20 sm:h-24 bg-black/40 border border-white/10 rounded-lg sm:rounded-xl p-2 sm:p-3 text-xs text-white/90 focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent placeholder-white/20 resize-none transition-all shadow-inner",placeholder:"Опишите, для чего предназначен этот агент...",maxLength:500}),t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("span",{className:"text-[9px] sm:text-[10px] text-white/30",children:"Опционально"}),t.jsxs("span",{className:"text-[9px] sm:text-[10px] text-white/30",children:[(ye||"").length,"/500"]})]})]})]}),t.jsxs("div",{className:"space-y-3 sm:space-y-4 p-3 sm:p-4 md:p-5 bg-gradient-to-br from-amber-950/30 to-orange-950/20 rounded-xl sm:rounded-2xl border border-amber-500/20",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-3 sm:mb-4",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-amber-500/20 rounded-lg",children:t.jsx(Yt,{size:12,className:"sm:w-3.5 sm:h-3.5 text-amber-300"})}),t.jsx("h3",{className:"text-xs sm:text-sm font-bold text-white",children:"Инструкции агента"})]}),t.jsxs("section",{children:[t.jsxs("label",{className:"flex items-center gap-1.5 sm:gap-2 text-[9px] sm:text-[10px] font-bold text-white/50 uppercase tracking-widest mb-1.5 sm:mb-2",children:["Системная инструкция",t.jsx("span",{className:"text-red-400",children:"*"}),t.jsxs("div",{className:"group relative",children:[t.jsx($e,{size:9,className:"sm:w-2.5 sm:h-2.5 text-white/30 hover:text-white/60 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-full mt-2 w-52 sm:w-64 p-1.5 sm:p-2 bg-black/95 border border-white/10 rounded-lg text-[9px] sm:text-[10px] text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 pointer-events-none",children:"Основные правила поведения агента. Опишите, как агент должен отвечать на вопросы и взаимодействовать с пользователем."})]})]}),t.jsx("textarea",{value:ae,onChange:d=>lt(d.target.value),className:`w-full h-32 sm:h-40 bg-black/40 border rounded-lg sm:rounded-xl p-2 sm:p-3 text-xs text-white/90 focus:ring-2 focus:ring-amber-500/50 focus:border-transparent placeholder-white/20 resize-none transition-all shadow-inner leading-relaxed font-mono ${(ae||"").trim()?"border-white/10":"border-red-500/30 focus:border-red-500/50"}`,placeholder:"Ты - полезный AI-ассистент. Твоя задача - помогать пользователям...",maxLength:5e3}),t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[(ae||"").trim()?t.jsx("span",{className:"text-[9px] sm:text-[10px] text-white/30",children:"Рекомендуется: 200-1000 символов"}):t.jsx("span",{className:"text-[9px] sm:text-[10px] text-red-400",children:"Системная инструкция обязательна"}),t.jsxs("span",{className:"text-[9px] sm:text-[10px] text-white/30",children:[(ae||"").length,"/5000"]})]})]}),t.jsxs("section",{className:"bg-gradient-to-br from-indigo-900/20 to-purple-900/10 p-3 sm:p-4 rounded-lg sm:rounded-xl border border-indigo-500/20",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2 text-indigo-300",children:[t.jsx(xr,{size:12,className:"sm:w-3.5 sm:h-3.5"}),t.jsxs("label",{className:"flex items-center gap-1.5 sm:gap-2 text-[9px] sm:text-[10px] font-bold uppercase tracking-widest",children:["Инструкция для сохранения результатов",t.jsxs("div",{className:"group relative",children:[t.jsx($e,{size:9,className:"sm:w-2.5 sm:h-2.5 text-indigo-300/50 hover:text-indigo-300 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-full mt-2 w-52 sm:w-64 p-1.5 sm:p-2 bg-black/95 border border-white/10 rounded-lg text-[9px] sm:text-[10px] text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 pointer-events-none",children:"Укажите, как агент должен форматировать и сохранять результаты работы"})]})]})]}),t.jsx("textarea",{value:de,onChange:d=>ct(d.target.value),className:"w-full h-20 sm:h-24 bg-black/30 border border-white/10 rounded-lg p-2 sm:p-3 text-xs text-white/80 focus:ring-1 focus:ring-indigo-500/50 focus:border-transparent placeholder-white/20 resize-none transition-all",placeholder:"Для копирайтера: 'Сохрани последнее сообщение БЕЗ ИЗМЕНЕНИЙ, точно как написано, с сохранением всей markdown разметки.' Для других: 'Сформируй резюме с markdown разметкой...'",maxLength:2e3}),t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("span",{className:"text-[9px] sm:text-[10px] text-white/30",children:"Опционально"}),t.jsxs("span",{className:"text-[9px] sm:text-[10px] text-white/30",children:[(de||"").length,"/2000"]})]})]})]}),t.jsxs("div",{className:"space-y-3 sm:space-y-4 p-3 sm:p-4 md:p-5 bg-gradient-to-br from-purple-950/30 to-pink-950/20 rounded-xl sm:rounded-2xl border border-purple-500/20",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-3 sm:mb-4",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-purple-500/20 rounded-lg",children:t.jsx(ss,{size:12,className:"sm:w-3.5 sm:h-3.5 text-purple-300"})}),t.jsx("h3",{className:"text-xs sm:text-sm font-bold text-white",children:"Конфигурация модели"})]}),t.jsxs("section",{children:[t.jsxs("label",{className:"flex items-center gap-1.5 sm:gap-2 text-[9px] sm:text-[10px] font-bold text-white/50 uppercase tracking-widest mb-1.5 sm:mb-2",children:["Модель ИИ",t.jsx("span",{className:"text-red-400",children:"*"}),t.jsxs("div",{className:"group relative",children:[t.jsx($e,{size:9,className:"sm:w-2.5 sm:h-2.5 text-white/30 hover:text-white/60 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-full mt-2 w-48 sm:w-56 p-1.5 sm:p-2 bg-black/95 border border-white/10 rounded-lg text-[9px] sm:text-[10px] text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 pointer-events-none",children:"Выберите модель для обработки запросов. GPT-5.1 - самый мощный, GPT-4o-mini - самый быстрый"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>{_(!Ee),V(!1),ee(!1)},className:"w-full bg-black/40 border border-white/10 rounded-lg sm:rounded-xl px-2.5 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-white focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all shadow-inner flex items-center justify-between hover:bg-black/50 group",children:[t.jsx("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:(()=>{const d=rs.find(j=>j.id===nt);return d?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-purple-500/30 shrink-0",children:Es(d.id)}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-wrap",children:[t.jsx("span",{className:"text-xs sm:text-sm font-bold text-white",children:d.name}),t.jsx("span",{className:"text-[9px] sm:text-[10px] text-purple-300 font-semibold bg-purple-500/20 px-1.5 sm:px-2 py-0.5 rounded-full",children:d.id===B.GPT4O_MINI?"⚡ Быстрая":d.id===B.GPT51?"🧠 Мощная":"💎 Сбалансированная"})]}),t.jsx("p",{className:"text-[9px] sm:text-[10px] text-white/60 truncate mt-0.5 text-left",children:d.description})]})]}):null})()}),t.jsx("svg",{className:`w-4 h-4 text-white/40 transition-transform shrink-0 ml-2 ${Ee?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),Ee&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>_(!1)}),t.jsx("div",{className:"absolute z-20 w-full mt-2 bg-gradient-to-b from-black/95 via-black/90 to-black/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl overflow-hidden",children:t.jsx("div",{className:"py-1",children:rs.map(d=>{const j=nt===d.id;return t.jsxs("button",{type:"button",onClick:S=>{S.stopPropagation(),kt(d.id),_(!1)},className:`w-full flex items-center gap-3 px-4 py-3 transition-colors text-left ${j?"bg-purple-500/10 hover:bg-purple-500/15":"hover:bg-white/5"}`,children:[t.jsx("div",{className:`p-2 rounded-lg shrink-0 ${j?"bg-purple-500/30":"bg-white/5"}`,children:Es(d.id)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:`text-sm font-bold ${j?"text-white":"text-white/80"}`,children:d.name}),t.jsx("span",{className:"text-[10px] text-white/50",children:d.id===B.GPT4O_MINI?"⚡ Быстрая":d.id===B.GPT51?"🧠 Мощная":"💎 Сбалансированная"})]}),t.jsx("p",{className:"text-[11px] text-white/60 leading-relaxed text-left",children:d.description})]}),j&&t.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-400 shadow-[0_0_8px_rgba(168,85,247,1)]"}),t.jsx("span",{className:"text-[10px] text-purple-300 font-semibold",children:"Выбрано"})]})]},d.id)})})})]})]})]})]}),t.jsxs("div",{className:"space-y-3 sm:space-y-4 p-3 sm:p-4 md:p-5 bg-gradient-to-br from-cyan-950/30 to-blue-950/20 rounded-xl sm:rounded-2xl border border-cyan-500/20",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-3 sm:mb-4",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-cyan-500/20 rounded-lg",children:t.jsx(Et,{size:12,className:"sm:w-3.5 sm:h-3.5 text-cyan-300"})}),t.jsx("h3",{className:"text-xs sm:text-sm font-bold text-white",children:"Привязки к проектам"})]}),t.jsxs("section",{children:[t.jsxs("label",{className:"flex items-center gap-1.5 sm:gap-2 text-[9px] sm:text-[10px] font-bold text-white/50 uppercase tracking-widest mb-1.5 sm:mb-2",children:["Типы проектов",t.jsxs("div",{className:"group relative",children:[t.jsx($e,{size:9,className:"sm:w-2.5 sm:h-2.5 text-white/30 hover:text-white/60 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-full mt-2 w-40 sm:w-48 p-1.5 sm:p-2 bg-black/95 border border-white/10 rounded-lg text-[9px] sm:text-[10px] text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 pointer-events-none",children:"Выберите типы проектов, где будет доступен этот агент"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>{V(!pe),ee(!1),_(!1)},className:"w-full bg-black/40 border border-white/10 rounded-lg sm:rounded-xl px-2.5 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-white focus:ring-2 focus:ring-cyan-500/50 focus:border-transparent transition-all shadow-inner flex items-center justify-between hover:bg-black/50 min-h-[40px] sm:min-h-[48px]",children:[t.jsx("div",{className:"flex-1 flex items-center gap-2 flex-wrap min-w-0",children:G.length>0?t.jsxs(t.Fragment,{children:[G.slice(0,2).map(d=>{const j=l.find(S=>S.id===d);return j?t.jsx("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-cyan-500/20 text-cyan-300 text-xs rounded-full border border-cyan-500/30 font-medium shrink-0",children:j.name},d):null}),G.length>2&&t.jsxs("span",{className:"text-xs text-white/60 font-medium",children:["+",G.length-2]})]}):t.jsx("span",{className:"text-white/40",children:"Выберите типы проектов"})}),t.jsx("svg",{className:`w-4 h-4 text-white/40 transition-transform shrink-0 ml-2 ${pe?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),pe&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>V(!1)}),t.jsxs("div",{className:"absolute z-20 w-full mt-2 bg-gradient-to-b from-black/95 via-black/90 to-black/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl overflow-hidden",children:[G.length>0&&t.jsxs("div",{className:"p-3 border-b border-white/10 bg-cyan-500/5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:"text-xs font-semibold text-cyan-300 uppercase tracking-wider",children:["Выбрано: ",G.length]}),t.jsx("button",{onClick:d=>{d.stopPropagation(),ne([])},className:"text-[10px] text-cyan-300/60 hover:text-cyan-300 transition-colors",type:"button",children:"Очистить все"})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(d=>{const j=l.find(S=>S.id===d);return j?t.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-cyan-500/20 text-cyan-300 text-xs rounded-full border border-cyan-500/30",children:[j.name,t.jsx("button",{onClick:S=>{S.stopPropagation(),je(d)},className:"hover:text-cyan-100 transition-colors rounded-full hover:bg-cyan-500/20 p-0.5",type:"button",children:t.jsx(zt,{size:12})})]},d):null})})]}),t.jsx("div",{className:"max-h-64 overflow-y-auto",children:l.length===0?t.jsx("div",{className:"p-4 text-center text-white/60 text-sm",children:"Нет доступных типов проектов"}):l.map(d=>{const j=G.includes(d.id);return t.jsxs("label",{className:`flex items-center gap-3 p-3 cursor-pointer transition-colors ${j?"bg-cyan-500/10 hover:bg-cyan-500/15":"hover:bg-white/5"}`,onClick:S=>S.stopPropagation(),children:[t.jsx("input",{type:"checkbox",checked:j,onChange:()=>je(d.id),className:"w-4 h-4 rounded border-white/20 bg-black/30 text-cyan-500 focus:ring-cyan-500/50 focus:ring-offset-0 cursor-pointer",onClick:S=>S.stopPropagation()}),t.jsx("span",{className:`text-sm flex-1 ${j?"text-cyan-300 font-medium":"text-white"}`,children:d.name})]},d.id)})})]})]})]})]}),t.jsxs("section",{children:[t.jsxs("label",{className:"flex items-center gap-1.5 sm:gap-2 text-[9px] sm:text-[10px] font-bold text-white/50 uppercase tracking-widest mb-1.5 sm:mb-2",children:["Специализация",t.jsxs("div",{className:"group relative",children:[t.jsx($e,{size:9,className:"sm:w-2.5 sm:h-2.5 text-white/30 hover:text-white/60 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-full mt-2 w-40 sm:w-48 p-1.5 sm:p-2 bg-black/95 border border-white/10 rounded-lg text-[9px] sm:text-[10px] text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 pointer-events-none",children:"Роль определяет особое поведение агента в системе"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>{ee(!Z),V(!1)},className:"w-full bg-black/40 border border-white/10 rounded-lg sm:rounded-xl px-2.5 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-white focus:ring-2 focus:ring-cyan-500/50 focus:border-transparent transition-all shadow-inner flex items-center justify-between hover:bg-black/50 group",children:[t.jsx("div",{className:"flex items-center gap-3",children:(()=>{const d={"":{icon:null,label:"Не выбрано",color:"text-white/40"},copywriter:{icon:Yt,label:"Копирайтер",color:"text-cyan-300"},layout:{icon:Et,label:"Верстальщик",color:"text-purple-300"},dsl:{icon:Is,label:"DSL",color:"text-emerald-300"},search:{icon:qt,label:"Исследователь",color:"text-blue-300"}},j=d[ue]||d[""],S=j.icon;return t.jsxs(t.Fragment,{children:[S&&t.jsx("div",{className:`p-1.5 rounded-lg bg-${ue==="copywriter"?"cyan":ue==="layout"?"purple":ue==="dsl"?"emerald":ue==="search"?"blue":"white"}-500/20`,children:t.jsx(S,{size:14,className:j.color})}),t.jsx("span",{className:ue?"text-white":"text-white/40",children:j.label})]})})()}),t.jsx("svg",{className:`w-4 h-4 text-white/40 transition-transform ${Z?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),Z&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>ee(!1)}),t.jsx("div",{className:"absolute z-20 w-full mt-2 bg-gradient-to-b from-black/95 via-black/90 to-black/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl overflow-hidden",children:t.jsx("div",{className:"py-1",children:[{value:"",label:"Не выбрано",icon:null,color:"text-white/60"},{value:"copywriter",label:"Копирайтер",icon:Yt,color:"text-cyan-300",bgColor:"bg-cyan-500/20",borderColor:"border-cyan-500/30"},{value:"layout",label:"Верстальщик",icon:Et,color:"text-purple-300",bgColor:"bg-purple-500/20",borderColor:"border-purple-500/30"},{value:"dsl",label:"DSL",icon:Is,color:"text-emerald-300",bgColor:"bg-emerald-500/20",borderColor:"border-emerald-500/30"},{value:"search",label:"Исследователь",icon:qt,color:"text-blue-300",bgColor:"bg-blue-500/20",borderColor:"border-blue-500/30"}].map(d=>{const j=ue===d.value,S=d.icon;return t.jsxs("button",{type:"button",onClick:z=>{z.stopPropagation(),dt(d.value),ee(!1)},className:`w-full flex items-center gap-3 px-4 py-3 transition-colors ${j?"bg-cyan-500/10 hover:bg-cyan-500/15":"hover:bg-white/5"}`,children:[S?t.jsx("div",{className:`p-1.5 rounded-lg ${j?d.bgColor:"bg-white/5"} border ${j?d.borderColor:"border-white/10"}`,children:t.jsx(S,{size:14,className:j?d.color:"text-white/50"})}):t.jsx("div",{className:"w-8 h-8"}),t.jsx("span",{className:`text-sm flex-1 text-left ${j?"text-cyan-300 font-medium":"text-white"}`,children:d.label}),j&&t.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-400 shadow-[0_0_8px_rgba(34,211,238,1)]"})]},d.value)})})})]})]})]})]}),t.jsxs("section",{className:"bg-gradient-to-br from-emerald-900/20 to-teal-900/10 p-3 sm:p-4 md:p-5 rounded-xl sm:rounded-2xl border border-emerald-500/20",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-emerald-500/20 rounded-lg",children:t.jsx(Pt,{size:14,className:"sm:w-4 sm:h-4 text-emerald-300"})}),t.jsx("label",{className:"block text-xs sm:text-sm font-bold text-emerald-300",children:"База знаний"}),t.jsxs("div",{className:"group relative",children:[t.jsx($e,{size:9,className:"sm:w-2.5 sm:h-2.5 text-emerald-300/50 hover:text-emerald-300 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-full mt-2 w-48 sm:w-56 p-1.5 sm:p-2 bg-black/95 border border-white/10 rounded-lg text-[9px] sm:text-[10px] text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 pointer-events-none",children:"Загрузите документы (.txt, .md), которые агент будет использовать как справочную информацию"})]})]}),t.jsxs("span",{className:"px-2 sm:px-3 py-1 sm:py-1.5 bg-emerald-500/20 rounded-full text-[10px] sm:text-xs text-emerald-300 font-semibold border border-emerald-500/30",children:[Be.filter(d=>!d.name.startsWith("Summary")).length," файлов"]})]}),Y&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{onClick:()=>!xt&&Ts.current?.click(),onDragOver:On,onDrop:Ln,className:`border-2 border-dashed rounded-lg sm:rounded-xl p-4 sm:p-6 text-center transition-all group mb-2 sm:mb-3 ${xt?"border-emerald-500/20 bg-emerald-500/5 cursor-wait opacity-60":"border-emerald-500/30 hover:border-emerald-400/60 hover:bg-emerald-500/10 bg-emerald-500/5 cursor-pointer"}`,children:[xt?t.jsxs(t.Fragment,{children:[t.jsx(ge,{className:"mx-auto h-5 w-5 sm:h-7 sm:w-7 text-emerald-300/70 mb-1.5 sm:mb-2 animate-spin"}),t.jsx("p",{className:"text-[10px] sm:text-xs font-medium text-emerald-200/80 transition-colors mb-1",children:"Загрузка файлов..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(cr,{className:"mx-auto h-5 w-5 sm:h-7 sm:w-7 text-emerald-300/70 group-hover:text-emerald-300 mb-1.5 sm:mb-2 transition-colors duration-300"}),t.jsx("p",{className:"text-[10px] sm:text-xs font-medium text-emerald-200/80 group-hover:text-emerald-200 transition-colors mb-1",children:"Перетащите файлы сюда или нажмите для загрузки"}),t.jsx("p",{className:"text-[9px] sm:text-[10px] text-emerald-300/50",children:".txt, .md файлы только"})]}),t.jsx("input",{type:"file",ref:Ts,onChange:Fn,className:"hidden",multiple:!0,accept:".txt,.md",disabled:xt})]}),(()=>{const d=Be.filter(j=>!j.name.startsWith("Summary"));return d.length>0&&t.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:d.map(j=>t.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-emerald-500/10 rounded-lg border border-emerald-500/20 hover:bg-emerald-500/15 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2.5 overflow-hidden flex-1 min-w-0",children:[t.jsx("div",{className:"bg-emerald-500/30 p-1.5 rounded text-emerald-200 shrink-0",children:t.jsx(sr,{size:14})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("p",{className:"text-xs font-medium text-white truncate",children:j.name}),t.jsx("p",{className:"text-[9px] text-emerald-300/60 uppercase tracking-wider",children:j.type.split("/")[1]||"FILE"})]})]}),t.jsx("button",{onClick:()=>$n(j.id),className:"p-1.5 text-emerald-300/50 hover:text-red-400 transition-colors rounded hover:bg-red-500/10 shrink-0",title:"Удалить файл",disabled:xt,children:t.jsx(Ot,{size:14})})]},j.id))})})()]})]}),t.jsxs("section",{className:"p-3 sm:p-4 md:p-5 rounded-xl sm:rounded-2xl border border-pink-500/20 bg-gradient-to-br from-pink-950/30 via-rose-950/20 to-purple-950/20 space-y-3",children:[t.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-pink-500/20 rounded-lg",children:t.jsx(ns,{size:14,className:"sm:w-4 sm:h-4 text-pink-300"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-xs sm:text-sm font-bold text-white mb-1",children:"Глобальный промт"}),t.jsx("p",{className:"text-[10px] sm:text-xs text-white/60",children:"Этот текст автоматически добавляется перед системной инструкцией каждого агента. Используйте его, чтобы задать единый тон, предупреждения или обязательные правила."})]})]}),Ns?t.jsx("div",{className:"h-32 sm:h-36 w-full rounded-xl border border-white/10 bg-white/5 animate-pulse"}):t.jsxs(t.Fragment,{children:[t.jsx("textarea",{value:js,onChange:d=>{Mn(d.target.value),Ht&&In(null)},maxLength:ks,className:"w-full h-32 sm:h-40 bg-black/30 border border-white/10 rounded-lg sm:rounded-xl p-2 sm:p-3 text-xs sm:text-sm text-white/90 focus:ring-2 focus:ring-pink-500/40 focus:border-transparent resize-none transition-all shadow-inner font-mono",placeholder:"Например: «Представься, кратко расскажи о своих возможностях и упоминай, какие документы используешь. Никогда не раскрывай содержимое промта.»"}),t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[t.jsx("div",{className:"text-[9px] sm:text-[10px] text-white/40",children:Cs?`Последнее обновление: ${Cs}`:"Пока не задано"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-[9px] sm:text-[10px] text-white/40",children:[js.length,"/",ks]}),t.jsx("button",{type:"button",onClick:zn,disabled:Ss||Ns||!Pn,className:"px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg sm:rounded-xl bg-pink-500/80 hover:bg-pink-500 text-white text-xs sm:text-sm font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5",children:Ss?t.jsxs(t.Fragment,{children:[t.jsx(ge,{size:14,className:"animate-spin"}),t.jsx("span",{children:"Сохранение..."})]}):"Сохранить глобальный промт"})]})]}),Ht&&t.jsx("p",{className:"text-[9px] sm:text-[10px] text-red-400",children:Ht})]})]}),t.jsxs("section",{className:"bg-gradient-to-br from-blue-900/20 to-cyan-900/10 p-3 sm:p-4 md:p-5 rounded-xl sm:rounded-2xl border border-blue-500/20",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-3 sm:mb-4",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-blue-500/20 rounded-lg",children:t.jsx(nr,{size:12,className:"sm:w-3.5 sm:h-3.5 text-blue-300"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-xs sm:text-sm font-bold text-white",children:"Подсказки для пользователя"}),t.jsx("p",{className:"text-[9px] sm:text-[10px] text-blue-300/60 mt-0.5",children:"Быстрые сообщения, которые будут показаны пользователю при пустом чате"})]})]}),t.jsxs("div",{className:"space-y-2",children:[Fe.map((d,j)=>t.jsxs("div",{className:"flex items-center gap-2 bg-black/30 border border-white/10 rounded-lg p-2 sm:p-3",children:[t.jsx("input",{type:"text",value:d,onChange:S=>{const z=[...Fe];z[j]=S.target.value,q(z)},className:"flex-1 bg-transparent border-none outline-none text-xs sm:text-sm text-white placeholder-white/40 focus:ring-0",placeholder:"Введите текст подсказки...",maxLength:200}),t.jsx("button",{onClick:()=>{const S=Fe.filter((z,L)=>L!==j);q(S)},className:"p-1.5 text-white/40 hover:text-red-400 transition-colors rounded hover:bg-red-500/10 shrink-0",title:"Удалить подсказку",children:t.jsx(Ot,{size:14})})]},j)),t.jsxs("button",{onClick:()=>{q([...Fe,""])},className:"w-full px-3 py-2 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 rounded-lg text-xs sm:text-sm text-blue-300 font-medium transition-colors flex items-center justify-center gap-2",children:[t.jsx(ms,{size:14}),"Добавить подсказку"]}),Fe.length===0&&t.jsx("p",{className:"text-[9px] sm:text-[10px] text-white/40 text-center py-2",children:"Подсказки не заданы. Пользователи увидят стандартное сообщение."})]})]}),t.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{className:"flex items-center justify-between p-2.5 sm:p-3 bg-gradient-to-br from-purple-900/20 to-indigo-900/10 border border-purple-500/20 rounded-xl",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 min-w-0",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-purple-500/20 rounded-lg flex-shrink-0",children:t.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-purple-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("label",{className:"block text-xs sm:text-sm font-bold text-purple-300 truncate",children:"Не отображать в сайдбаре"}),t.jsx("p",{className:"text-[9px] sm:text-[10px] text-purple-300/60 mt-0.5 truncate",children:"Агент не будет виден в списке"})]})]}),t.jsx("button",{onClick:()=>ut(!He),className:`relative inline-flex h-5 w-9 sm:h-6 sm:w-11 items-center rounded-full transition-colors flex-shrink-0 ml-2 ${He?"bg-purple-500":"bg-white/10"}`,children:t.jsx("span",{className:`inline-block h-3.5 w-3.5 sm:h-4 sm:w-4 transform rounded-full bg-white transition-transform ${He?"translate-x-5 sm:translate-x-6":"translate-x-0.5 sm:translate-x-1"}`})})]}),t.jsxs("div",{className:"flex items-center justify-between p-2.5 sm:p-3 bg-gradient-to-br from-amber-900/20 to-orange-900/10 border border-amber-500/20 rounded-xl",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 min-w-0",children:[t.jsx("div",{className:"p-1 sm:p-1.5 bg-amber-500/20 rounded-lg flex-shrink-0",children:t.jsx(qt,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-amber-300"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("label",{className:"block text-xs sm:text-sm font-bold text-amber-300 truncate",children:"Без глобального промпта"}),t.jsx("p",{className:"text-[9px] sm:text-[10px] text-amber-300/60 mt-0.5 truncate",children:"Не использовать глобальную инструкцию"})]})]}),t.jsx("button",{onClick:()=>Dt(!Xe),className:`relative inline-flex h-5 w-9 sm:h-6 sm:w-11 items-center rounded-full transition-colors flex-shrink-0 ml-2 ${Xe?"bg-amber-500":"bg-white/10"}`,children:t.jsx("span",{className:`inline-block h-3.5 w-3.5 sm:h-4 sm:w-4 transform rounded-full bg-white transition-transform ${Xe?"translate-x-5 sm:translate-x-6":"translate-x-0.5 sm:translate-x-1"}`})})]})]})]})]})}),t.jsx(rr,{isOpen:ve.isOpen,onClose:()=>oe(d=>({...d,isOpen:!1})),onConfirm:ve.onConfirm,title:ve.title,message:ve.message,variant:ve.variant}),t.jsx(ir,{isOpen:he.isOpen,onClose:()=>re(d=>({...d,isOpen:!1})),title:he.title,message:he.message,variant:he.variant,duration:he.duration??0})]})};export{zo as AdminPage};
