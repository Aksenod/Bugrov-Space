import{r as o,j as e}from"./markdown-vendor-CiFSpwUK.js";import{g as Y,C as X,i as S}from"./index-BU160igU.js";import"./react-vendor-OvXVS5lI.js";import"./syntax-highlighter-Q85ecyyO.js";const L=({prototypeHash:i,versionNumber:c,onClose:C})=>{const[n,w]=o.useState(null),[P,d]=o.useState(!0),[u,f]=o.useState(null),[W,y]=o.useState(null),[j,m]=o.useState(!1),v=o.useRef(null),p=o.useRef(null),N=o.useRef(null);return o.useEffect(()=>{(async()=>{try{d(!0);const s=await S.getPublicPrototype(i,c);w(s.prototype.html),y(s.prototype.username),f(null)}catch(s){console.error("Failed to load prototype:",s),f(s?.message||"Не удалось загрузить прототип")}finally{d(!1)}})()},[i,c]),o.useEffect(()=>{if(!n)return;const l=p.current;if(!l)return;const s=t=>{console.log("[PublicPrototypePage] Wheel event:",{deltaY:t.deltaY,clientX:t.clientX,clientY:t.clientY});const r=l.getBoundingClientRect(),x=t.clientX>=r.left&&t.clientX<=r.right&&t.clientY>=r.top&&t.clientY<=r.bottom;if(console.log("[PublicPrototypePage] Is over iframe:",x,{rect:{left:r.left,right:r.right,top:r.top,bottom:r.bottom},mouse:{x:t.clientX,y:t.clientY}}),!x)return;const h=t.deltaY>0,g=t.deltaY<0;if(console.log("[PublicPrototypePage] Scrolling:",{scrollingDown:h,scrollingUp:g}),h?(console.log("[PublicPrototypePage] Hiding header"),m(!0)):g&&(console.log("[PublicPrototypePage] Showing header"),m(!1)),l.contentWindow)try{const a=l.contentWindow.scrollY||l.contentWindow.pageYOffset||0,b=l.contentWindow.scrollX||l.contentWindow.pageXOffset||0;console.log("[PublicPrototypePage] Scrolling iframe:",{currentScrollY:a,currentScrollX:b,deltaY:t.deltaY,deltaX:t.deltaX}),l.contentWindow.scrollTo({left:b+t.deltaX,top:a+t.deltaY,behavior:"auto"})}catch(a){console.error("[PublicPrototypePage] Error scrolling iframe:",a)}else console.log("[PublicPrototypePage] No contentWindow available")};return window.addEventListener("wheel",s,{passive:!1,capture:!0}),()=>{window.removeEventListener("wheel",s,{capture:!0})}},[n]),e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col","data-prototype-container":!0,children:[e.jsxs("div",{ref:N,className:"flex items-center justify-between p-4 bg-black/80 backdrop-blur-md border-b border-white/10 transition-transform duration-300 ease-in-out relative z-10",style:{transform:j?"translateY(-100%)":"translateY(0)"},children:[e.jsx("h1",{className:"text-white font-medium",children:"Просмотр прототипа"}),e.jsx("button",{onClick:()=>window.open("https://bugrov.space","_blank"),className:"px-3 py-1.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-indigo-600 text-white text-xs font-medium rounded-full shadow-lg hover:shadow-indigo-500/50 transition-all duration-300 hover:scale-105 active:scale-95 backdrop-blur-sm border border-white/20","aria-label":"Перейти на Bugrov.space",children:e.jsxs("span",{className:"flex flex-col md:flex-row items-center",children:[e.jsx("span",{children:"Сделано на"}),e.jsx("span",{className:"font-bold",children:"Bugrov.space"})]})})]}),e.jsx("div",{ref:v,className:"flex-1 overflow-auto",children:P?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Y,{size:48,className:"mx-auto animate-spin text-indigo-400"}),e.jsx("p",{className:"text-white/60",children:"Загрузка прототипа..."})]})}):u?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md p-6",children:[e.jsx(X,{size:48,className:"mx-auto text-red-400"}),e.jsx("p",{className:"text-white/80 font-medium",children:"Ошибка загрузки"}),e.jsx("p",{className:"text-white/50 text-sm",children:u})]})}):n?e.jsx("iframe",{ref:p,srcDoc:n,className:"w-full h-full border-0",title:"Prototype Preview",sandbox:"allow-same-origin allow-scripts"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-white/50",children:"Прототип не найден"})})})]})};export{L as PublicPrototypePage};
