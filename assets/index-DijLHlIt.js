const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/syntax-highlighter-Q85ecyyO.js","assets/markdown-vendor-CiFSpwUK.js","assets/react-vendor-OvXVS5lI.js","assets/index-CXH5y3TO.js"])))=>i.map(i=>d[i]);
import{j as e,r as m}from"./markdown-vendor-CiFSpwUK.js";import{c as H,F as P,X as z,w as ye,h as S,x as je,y as Ne,f as ee,z as ke,T as te,i as Ce,D as Se}from"./index-C_nb8_l2.js";import{U as ne}from"./upload-CBdIQvh2.js";import{_ as se}from"./syntax-highlighter-Q85ecyyO.js";import{A as $e,E as Pe}from"./eye-DgwA3vBE.js";import{C as ze}from"./calendar-COL9U2Xp.js";import"./react-vendor-OvXVS5lI.js";const Ee=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],De=H("download",Ee);const Te=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],B=H("external-link",Te);const Le=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Ve=H("maximize-2",Le);const He=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Ie=H("square-pen",He),ie=(t,s)=>{if(t.agentId){const d=s.find(l=>l.id===t.agentId);if(d)return d.name}const n=t.name.match(/^Summary\s*[-–—]\s*(.+?)\s*[-–—]\s*\d/);if(n&&n[1]){const d=n[1].trim(),l=s.find(i=>i.name===d);return l?l.name:d}const a=t.name.match(/^Документ\s*[-–—]\s*(.+?)\s*[-–—]\s*\d/);return a&&a[1]?a[1].trim():"Документ"},re=t=>{const s=t.name.split(" - ");return s.length>1?s[s.length-1].trim():t.name},Me=t=>{const s=re(t);try{const n=new Date(s);if(isNaN(n.getTime()))return s;const a=n.getDate().toString().padStart(2,"0"),d=(n.getMonth()+1).toString().padStart(2,"0"),l=n.getFullYear(),i=n.getHours().toString().padStart(2,"0"),c=n.getMinutes().toString().padStart(2,"0");return`${a}.${d}.${l} ${i}:${c}`}catch{return s}},X=(t,s)=>t?t.split(",").map(a=>a.trim().toLowerCase()).includes(s.toLowerCase()):!1,oe=(t,s=[])=>t.name.match(/^(Summary|Документ)\s*[-–—]/)?`${ie(t,s)} - ${re(t)}`:t.name,_e=t=>Me(t),Re=({documents:t,selectedFileId:s,onSelectFile:n,project:a,onClose:d,onFileUpload:l,isSidebarCollapsed:i,onToggleSidebar:c})=>e.jsxs("div",{className:`border-r border-white/10 flex flex-col bg-black/40 backdrop-blur-xl transition-all duration-300 ease-in-out relative overflow-hidden ${i?"w-[60px] md:!w-[60px]":"w-full md:!w-[280px] md:min-w-[280px]"} ${s?"hidden md:flex":"flex"}`,title:i?`${t.length} ${t.length===1?"документ":t.length<5?"документа":"документов"}`:void 0,style:{transitionProperty:"width",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out",willChange:"width"},children:[e.jsxs("div",{className:`transition-all duration-300 ease-in-out border-b border-white/10 flex flex-col ${i?"p-0 items-center gap-0":"p-4 sm:p-6 gap-2"}`,children:[e.jsxs("div",{className:`transition-opacity duration-300 ease-in-out flex items-center gap-2 ${i?"opacity-0 pointer-events-none max-h-0 overflow-hidden":"opacity-100 pointer-events-auto"}`,style:{maxHeight:i?"0px":"none",transitionProperty:i?"opacity, max-height":"opacity",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out"},children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-amber-500/20 rounded-xl text-amber-400 flex-shrink-0",children:e.jsx(P,{size:18,className:"sm:w-5 sm:h-5"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white truncate",children:a?.name||"Документы"})]}),a?.projectType&&e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-1 ml-11 sm:ml-12 truncate",children:a.projectType.name})]}),e.jsx("button",{onClick:d,className:"md:hidden p-2 text-white/60 hover:text-white hover:bg-white/10 rounded-lg transition-colors flex-shrink-0","aria-label":"Закрыть",children:e.jsx(z,{size:20})}),e.jsx("button",{onClick:c,className:"hidden md:flex p-1.5 text-white/50 hover:text-white hover:bg-white/10 rounded-lg transition-all duration-200 flex-shrink-0","aria-label":"Свернуть панель документов",title:"Свернуть панель",children:e.jsx(ye,{size:16})})]}),e.jsxs("div",{className:`flex flex-col items-center ${i?"opacity-100 pointer-events-auto overflow-visible pt-[30px]":"opacity-0 pointer-events-none max-h-0 overflow-hidden"}`,style:{maxWidth:i?"60px":"0px",maxHeight:i?"none":"0px",transitionProperty:i?"opacity, max-width":"opacity, max-width, max-height",transitionDuration:i?"300ms":"0ms",transitionTimingFunction:"ease-in-out"},children:[e.jsxs("button",{onClick:c,className:"relative p-2.5 bg-amber-500/20 hover:bg-amber-500/30 rounded-xl text-amber-400 transition-colors duration-200 group w-full flex items-center justify-center flex-shrink-0 mt-0","aria-label":"Развернуть панель документов",title:`${t.length} ${t.length===1?"документ":t.length<5?"документа":"документов"}`,children:[e.jsx(P,{size:22,className:"group-hover:scale-110 transition-transform duration-200"}),t.length>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 bg-indigo-500 text-white text-[11px] font-bold rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg ring-2 ring-black/60",children:t.length>9?"9+":t.length})]}),l&&e.jsx("button",{onClick:l,className:"w-full p-2.5 text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded-lg transition-colors duration-200 flex items-center justify-center border border-indigo-500/20 hover:border-indigo-500/40 flex-shrink-0 mt-3","aria-label":"Загрузить документ",title:"Загрузить документ",children:e.jsx(ne,{size:18})})]}),l&&e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${i?"opacity-0 max-h-0 mt-0 pointer-events-none":"opacity-100 max-h-20 -mt-1 pointer-events-auto"}`,style:{transitionProperty:"opacity, max-height, margin-top",willChange:i?"opacity, max-height":void 0},children:e.jsxs("button",{onClick:l,className:"w-full px-4 py-2.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium shadow-lg shadow-indigo-500/20 hover:shadow-indigo-500/30",children:[e.jsx(ne,{size:16}),"Загрузить"]})})]}),e.jsx("div",{className:`flex-1 overflow-hidden transition-opacity duration-300 ease-in-out ${i?"opacity-0 pointer-events-none":"opacity-100 pointer-events-auto"}`,children:e.jsx("div",{className:"h-full overflow-y-auto p-4 space-y-2 md:no-scrollbar",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/40 text-center p-6 border-2 border-dashed border-white/10 rounded-3xl m-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-amber-500/20 blur-xl rounded-full animate-pulse"}),e.jsx(P,{size:40,className:"relative opacity-60"})]}),e.jsx("p",{className:"text-base font-semibold text-white/70 mb-2",children:"Нет документов"}),e.jsx("p",{className:"text-xs text-white/50 max-w-[200px]",children:'Используйте кнопку "Сохранить" в чате для создания отчетов.'})]}):t.map(o=>e.jsxs("button",{onClick:()=>n(o.id),className:`w-full text-left p-4 rounded-2xl transition-all duration-200 flex items-center gap-4 group relative overflow-hidden cursor-pointer ${s===o.id?"bg-white/15 shadow-lg border border-white/20":"hover:bg-white/10 hover:border-white/20 hover:shadow-md hover:scale-[1.02] border border-transparent"}`,children:[s===o.id&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-amber-400"}),e.jsx(P,{size:18,className:`flex-shrink-0 transition-colors duration-200 ${s===o.id?"text-white/90":"text-white/60 group-hover:text-white/80"}`}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("h4",{className:`text-sm font-semibold line-clamp-2 transition-colors duration-200 ${s===o.id?"text-white":"text-white/70 group-hover:text-white/90"}`,children:oe(o)})})]},o.id))})})]});let W=null,O=null;const Fe=async()=>(W||(W=(await se(()=>import("./syntax-highlighter-Q85ecyyO.js").then(s=>s.cb),__vite__mapDeps([0,1,2]))).Prism),O||(O=(await se(()=>import("./index-CXH5y3TO.js"),__vite__mapDeps([3,0,1,2]))).vscDarkPlus),{SyntaxHighlighter:W,vscDarkPlus:O}),Ge=({language:t,children:s,isFullscreenView:n})=>{const[a,d]=m.useState(!1),[l,i]=m.useState(null);if(m.useEffect(()=>{let p=!0;return Fe().then(({SyntaxHighlighter:w,vscDarkPlus:f})=>{p&&(i({Component:w,style:f}),d(!0))}),()=>{p=!1}},[]),!a||!l)return e.jsx("div",{className:"bg-black/50 p-4 rounded-xl border border-white/10 font-mono text-sm text-white/70",children:s});const{Component:c,style:o}=l;return e.jsx(c,{style:o,language:t,PreTag:"div",customStyle:{margin:0,borderRadius:n?"1.5rem":"1rem",padding:"1.5rem",minHeight:0,maxHeight:"100%"},children:s})},qe=({documents:t,isOpen:s})=>{const[n,a]=m.useState(null),[d,l]=m.useState(null),i=m.useMemo(()=>d||t.find(c=>c.id===n)||null,[d,t,n]);return m.useEffect(()=>{if(n){const c=t.find(o=>o.id===n);c?l(o=>{if(o&&o.id===n){const p=o.dslContent&&o.dslContent.length>0||o.verstkaContent&&o.verstkaContent.length>0,w=c.dslContent&&c.dslContent.length>0||c.verstkaContent&&c.verstkaContent.length>0;if(p&&!w)return o}return c}):(a(null),l(null))}else l(null)},[t,n]),m.useEffect(()=>{s||(a(null),l(null))},[s]),{selectedFileId:n,setSelectedFileId:a,localSelectedFile:d,setLocalSelectedFile:l,selectedFile:i}},Ae=({selectedFile:t,agents:s,isOpen:n})=>{const[a,d]=m.useState("text"),[l,i]=m.useState("preview"),c=o=>{d(o),i("preview")};return m.useEffect(()=>{if(n&&t){const o=s,p=t.agentId?o.find(f=>f.id===t.agentId):null;p&&X(p?.role,"verstka")?(c("prototype"),i("preview")):(c("text"),i("preview"))}else n||(c("text"),i("preview"))},[t?.id,n,s]),{activeTab:a,setActiveTab:c,prototypeSubTab:l,setPrototypeSubTab:i}},Be=({selectedFile:t,onDocumentUpdate:s,onShowAlert:n})=>{const[a,d]=m.useState(!1),[l,i]=m.useState(""),[c,o]=m.useState(!1);m.useEffect(()=>{t||(d(!1),i(""))},[t?.id]);const p=x=>{try{return decodeURIComponent(escape(window.atob(x)))}catch{return"Не удалось прочитать файл или это бинарный файл."}};return{isEditing:a,editedContent:l,setEditedContent:i,isSaving:c,handleEdit:()=>{if(!t)return;const x=p(t.data);i(x),d(!0)},handleCancelEdit:()=>{d(!1),i("")},handleSaveEdit:async()=>{if(t){o(!0);try{const x=window.btoa(unescape(encodeURIComponent(l))),{file:h}=await S.updateFileContent(t.id,x),N={id:h.id,name:h.name,type:h.mimeType,data:h.content,agentId:h.agentId,dslContent:h.dslContent,verstkaContent:h.verstkaContent};s&&s(N),d(!1),i(""),n&&n("Документ успешно обновлен","Успех","success")}catch(x){console.error("Failed to update file:",x),n&&n(`Не удалось обновить документ: ${x?.message||"Неизвестная ошибка"}`,"Ошибка","error")}finally{o(!1)}}},decodeContent:p}},We=({selectedFile:t,documentCreatorAgent:s,selectedFileId:n,onDocumentUpdate:a,onShowAlert:d,setActiveTab:l,setPrototypeVersions:i,setSelectedVersionNumber:c})=>{const[o,p]=m.useState(!1),[w,f]=m.useState(null);return m.useEffect(()=>{let x;if(o&&t&&t.data)try{const N=(v=>{try{return decodeURIComponent(escape(window.atob(v)))}catch{return""}})(t.data).length,E=Math.min(180,Math.max(30,30+Math.floor(N/100)));f(E),x=setInterval(()=>{f(v=>v!==null&&v>0?v-1:0)},1e3)}catch(h){console.error("Error calculating timer:",h),f(null)}else f(null);return()=>{x&&clearInterval(x)}},[o,t]),{isGeneratingPrototype:o,timeLeft:w,handleGenerateResult:async()=>{if(!(!t||!s)){p(!0);try{const{file:x}=await S.generatePrototype(s.id,t.id),h={id:x.id,name:x.name,type:x.mimeType,data:x.content,agentId:x.agentId,dslContent:x.dslContent,verstkaContent:x.verstkaContent};a&&a(h),setTimeout(()=>{l("prototype"),n&&S.getPrototypeVersions(n).then(({versions:N})=>{i(N),N.length>0&&c(N[0].versionNumber)}).catch(console.error)},100)}catch(x){console.error("Failed to generate result:",x),d?d(`Не удалось сгенерировать прототип: ${x?.message||"Неизвестная ошибка"}`,"Ошибка","error"):console.error(`Не удалось сгенерировать прототип: ${x?.message||"Неизвестная ошибка"}`)}finally{p(!1)}}}}},Oe=({selectedFileId:t,activeTab:s,documents:n,isOpen:a})=>{const[d,l]=m.useState([]),[i,c]=m.useState(null),[o,p]=m.useState(!1),[w,f]=m.useState(!1);return m.useEffect(()=>{if(!a){l([]),c(null),f(!1);return}(async()=>{if(!t||s!=="prototype"){l([]),c(null);return}const x=n.find(h=>h.id===t);if(!x||!x.verstkaContent&&!x.dslContent){l([]),c(null);return}p(!0);try{const{versions:h}=await S.getPrototypeVersions(t);l(h),h.length>0?c(h[0].versionNumber):c(null)}catch(h){console.error("Failed to load prototype versions:",h),l([]),c(null)}finally{p(!1)}})()},[t,s,n,a]),m.useEffect(()=>{if(!a){f(!1);return}const k=x=>{w&&(x.target.closest(".version-dropdown-container")||f(!1))};return document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[w,a]),{prototypeVersions:d,setPrototypeVersions:l,selectedVersionNumber:i,setSelectedVersionNumber:c,isLoadingVersions:o,isVersionDropdownOpen:w,setIsVersionDropdownOpen:f}},Xe=(t,s,n,a)=>{if(!t)return null;if(n!==null){const d=s.find(l=>l.versionNumber===n);if(d)return a==="dsl"?d.dslContent||null:d.verstkaContent||null}return a==="dsl"?t.dslContent||null:t.verstkaContent||null},nt=({isOpen:t,onClose:s,documents:n,onRemoveFile:a,agents:d=[],project:l,onFileUpload:i,onDocumentUpdate:c,onShowAlert:o,currentUser:p})=>{const{shouldShowStep:w,completeStep:f}=je(),[k,x]=m.useState(!1),[h,N]=m.useState(!1),E=p?.role==="admin",{selectedFileId:v,setSelectedFileId:D,localSelectedFile:Y,setLocalSelectedFile:ae,selectedFile:u}=qe({documents:n,isOpen:t}),{activeTab:j,setActiveTab:I,prototypeSubTab:y,setPrototypeSubTab:M}=Ae({selectedFile:u,agents:d,isOpen:t}),{isEditing:_,editedContent:le,setEditedContent:de,isSaving:R,handleEdit:ce,handleCancelEdit:xe,handleSaveEdit:me,decodeContent:he}=Be({selectedFile:u,onDocumentUpdate:c,onShowAlert:o}),{prototypeVersions:T,setPrototypeVersions:J,selectedVersionNumber:C,setSelectedVersionNumber:L,isVersionDropdownOpen:F,setIsVersionDropdownOpen:G}=Oe({selectedFileId:v,activeTab:j,documents:n,isOpen:t}),$=u?.agentId?d.find(r=>r.id===u.agentId):null,V=$&&X($.role,"copywriter"),q=$&&X($.role,"verstka"),{isGeneratingPrototype:K,timeLeft:ue,handleGenerateResult:pe}=We({selectedFile:u,documentCreatorAgent:$,selectedFileId:v,onDocumentUpdate:c,onShowAlert:o,setActiveTab:I,setPrototypeVersions:J,setSelectedVersionNumber:L});m.useEffect(()=>{const r=localStorage.getItem("documents-sidebar-collapsed");r!==null&&x(r==="true")},[]);const fe=()=>{const r=!k;x(r),localStorage.setItem("documents-sidebar-collapsed",String(r))},be=(r,b)=>{b.stopPropagation();const g=document.createElement("a");g.href=`data:${r.type};base64,${r.data}`,g.download=r.name,document.body.appendChild(g),g.click(),document.body.removeChild(g)},ge=async(r,b)=>{b.stopPropagation(),a&&(v===r&&(D(null),ae(null)),a(r))},A=()=>{const r=Y||u;if(!r)return;const b=C!==null?`?v=${C}`:"",g=`${window.location.origin}/#/prototype/${r.id}${b}`;window.open(g,"_blank")},Q=()=>{const r=Y||u;return r?j==="text"?r.data:j==="prototype"?Xe(r,T,C,y):null:null},Z=(r=!1)=>{const b=Q();return y==="dsl"||y==="html"?b?e.jsx("div",{className:"overflow-auto w-full flex-1 flex flex-col",style:{minHeight:0,maxHeight:"100%"},children:e.jsx(Ge,{language:y==="dsl"?"markdown":"html",isFullscreenView:r,children:b})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:[e.jsx("p",{className:"text-base font-medium mb-2",children:y==="dsl"?"DSL код еще не сгенерирован":"HTML код еще не сгенерирован"}),e.jsx("p",{className:"text-sm text-white/20",children:y==="dsl"?"Контент появится после генерации DSL агентом":"Контент появится после генерации Верстальщиком"})]}):b?e.jsx("div",{className:"w-full flex-1 relative",style:{minHeight:0,maxHeight:"100%"},children:e.jsx("iframe",{srcDoc:b,className:"absolute inset-0 w-full h-full border-0 rounded-xl",title:"HTML Preview",sandbox:"allow-same-origin allow-scripts"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:[e.jsx("p",{className:"text-base font-medium mb-2",children:"Прототип еще не сгенерирован"}),e.jsx("p",{className:"text-sm text-white/20",children:'Используйте кнопку "Сгенерировать прототип" для создания HTML-макета'})]})};if(!t)return null;const we=w({id:"documents-modal-hint",component:"inline",content:{title:"Документы проекта",description:'Здесь отображаются все документы вашего проекта. Документы доступны всем агентам проекта и используются ими для контекста при ответах. Вы можете сохранять диалоги с агентами через кнопку "Save" в чате.',examples:["Документы доступны всем агентам проекта",'Используйте кнопку "Save" в чате для сохранения диалогов',"Агенты используют документы для контекста при ответах"]},showOnce:!0});return e.jsxs("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-black via-black to-indigo-950/20 flex flex-col overflow-hidden",style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[we&&e.jsx("div",{className:"p-4 md:p-6 border-b border-white/10 bg-black/30 backdrop-blur-xl",children:e.jsx("div",{className:"max-w-4xl mx-auto w-full",children:e.jsx(Ne,{title:"Документы проекта",description:"Здесь отображаются все документы вашего проекта. Документы доступны всем агентам проекта и используются ими для контекста при ответах. Вы можете сохранять диалоги с агентами через кнопку 'Save' в чате.",examples:["Документы доступны всем агентам проекта",'Используйте кнопку "Save" в чате для сохранения диалогов',"Агенты используют документы для контекста при ответах"],variant:"info",collapsible:!0,defaultExpanded:!0,dismissible:!0,onDismiss:()=>f("documents-modal-hint")})})}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsx(Re,{documents:n,selectedFileId:v,onSelectFile:D,project:l,onClose:s,onFileUpload:i,isSidebarCollapsed:k,onToggleSidebar:fe}),e.jsxs("div",{className:`flex-1 md:flex flex-col bg-black/30 relative min-h-0 transition-all duration-300 ease-in-out ${u?"flex":"hidden md:flex"}`,style:{width:k?"calc(100% - 60px)":void 0,transitionProperty:"width",willChange:"width"},children:[e.jsxs("div",{className:"md:hidden sticky top-0 z-20 p-4 border-b border-white/10 flex items-center gap-3 bg-black/60 backdrop-blur-md flex-shrink-0",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 1rem)"},children:[e.jsx("button",{onClick:()=>D(null),className:"p-2.5 text-white hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors","aria-label":"К списку документов",children:e.jsx($e,{size:20,className:"font-bold"})}),e.jsx("span",{className:"font-medium truncate text-white",children:u?oe(u,d):""}),e.jsx("button",{onClick:s,className:"ml-auto p-2.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Закрыть",children:e.jsx(z,{size:20})})]}),e.jsx("div",{className:"absolute top-6 right-6 z-10 hidden md:block",children:e.jsx("button",{onClick:s,className:"p-2.5 bg-black/60 backdrop-blur-md hover:bg-white/10 rounded-full text-white/70 hover:text-white transition-colors border border-white/10 shadow-lg",children:e.jsx(z,{size:20})})}),u?e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto scrollbar-thin p-4 md:p-8 lg:p-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto w-full h-full flex flex-col",children:[!(j==="prototype"&&y==="preview")&&!(j==="prototype"&&q&&y!=="preview"&&h)&&e.jsxs("div",{className:"mb-8 pb-6 border-b border-white/10",children:[e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-400 text-xs font-bold tracking-wider uppercase",children:u?ie(u,d):"Документ"})}),e.jsxs("div",{className:"flex items-center justify-between gap-6 text-sm text-white/40",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ze,{size:14})," ",u?_e(u):new Date().toLocaleString()]}),q&&y==="preview"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>N(!0),className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5",children:[e.jsx(Ve,{size:16}),"Развернуть"]}),e.jsxs("button",{onClick:A,className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5",children:[e.jsx(B,{size:16}),"Открыть в новой вкладке"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j==="text"&&!u.type.includes("image")&&(_?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:xe,disabled:R,className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2 disabled:opacity-50",title:"Отменить","aria-label":"Отменить редактирование",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Отменить"}),e.jsx(z,{size:16})]}),e.jsxs("button",{onClick:me,disabled:R,className:"px-3 py-2 text-green-400 hover:text-green-300 hover:bg-green-500/10 rounded-xl transition-all flex items-center gap-2 disabled:opacity-50",title:"Сохранить","aria-label":"Сохранить изменения",children:[R&&e.jsx(ee,{size:14,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Сохранить"}),e.jsx(ke,{size:16})]})]}):e.jsxs("button",{onClick:ce,className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2",title:"Редактировать","aria-label":"Редактировать документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Редактировать"}),e.jsx(Ie,{size:16})]})),e.jsxs("button",{onClick:r=>be(u,r),className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2",title:"Скачать","aria-label":"Скачать документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Скачать"}),e.jsx(De,{size:16})]}),a&&e.jsxs("button",{onClick:r=>ge(u.id,r),className:"px-3 py-2 text-white/80 hover:text-red-400 hover:bg-red-500/10 rounded-xl transition-all flex items-center gap-2",title:"Удалить","aria-label":"Удалить документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Удалить"}),e.jsx(te,{size:16})]})]})]})]}),(V||E)&&e.jsxs("div",{className:"mb-6 flex items-center gap-4 border-b border-white/10 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I("text"),className:`px-4 py-2 text-sm font-medium transition-colors border-b-2 ${j==="text"?"text-white border-white/40":"text-white/50 border-transparent hover:text-white/70"}`,children:"Текст"}),e.jsx("button",{onClick:()=>I("prototype"),className:`px-4 py-2 text-sm font-medium transition-colors border-b-2 ${j==="prototype"?"text-cyan-400 border-cyan-400/40":"text-white/50 border-transparent hover:text-white/70"}`,children:"Прототип"})]}),V&&!_&&e.jsx("button",{onClick:r=>{r.preventDefault(),pe()},disabled:K,className:"text-cyan-400 hover:text-cyan-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5 text-sm font-medium",children:K?e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:14,className:"animate-spin"}),"Генерация... (",ue,"s)"]}):"Сгенерировать прототип"}),j==="prototype"&&e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[V&&E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M("preview"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${y==="preview"?"bg-white/10 text-white":"text-white/30 hover:text-white/60 hover:bg-white/5"}`,children:"Preview"}),e.jsx("button",{onClick:()=>M("dsl"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${y==="dsl"?"bg-white/10 text-white":"text-white/30 hover:text-white/60 hover:bg-white/5"}`,children:"DSL"}),e.jsx("button",{onClick:()=>M("html"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${y==="html"?"bg-white/10 text-white":"text-white/30 hover:text-white/60 hover:bg-white/5"}`,children:"HTML"})]}),T.length>0&&e.jsxs("div",{className:"relative version-dropdown-container",children:[e.jsxs("button",{onClick:()=>G(!F),className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 flex items-center gap-1.5",title:"Выбрать версию",children:[e.jsxs("span",{children:["Версия ",C||"?"]}),e.jsx(Ce,{size:14,className:F?"rotate-180":""})]}),F&&e.jsx("div",{className:"absolute right-0 top-full mt-1 bg-black/95 backdrop-blur-md border border-white/10 rounded-lg shadow-xl z-50 min-w-[200px] max-h-[200px] overflow-y-auto version-dropdown-container",children:T.map(r=>e.jsxs("div",{className:`flex items-center justify-between group ${C===r.versionNumber?"bg-cyan-500/20":""}`,children:[e.jsxs("button",{onClick:()=>{L(r.versionNumber),G(!1)},className:`flex-1 text-left px-3 py-2 text-xs transition-colors ${C===r.versionNumber?"text-cyan-400":"text-white/70 hover:text-white hover:bg-white/5"}`,children:["Версия ",r.versionNumber]}),T.length>1&&onShowConfirm&&e.jsx("button",{onClick:b=>{b.stopPropagation(),G(!1),onShowConfirm&&onShowConfirm("Удалить версию",`Вы уверены, что хотите удалить версию ${r.versionNumber}? Это действие нельзя отменить.`,async()=>{try{await S.deletePrototypeVersion(v,r.versionNumber);const{versions:g}=await S.getPrototypeVersions(v);if(J(g),C===r.versionNumber&&(g.length>0?L(g[0].versionNumber):L(null)),c&&u){const U=n.find(ve=>ve.id===v);U&&c(U)}o&&o("Версия успешно удалена","Успех","success")}catch(g){console.error("Failed to delete version:",g),o&&o(`Не удалось удалить версию: ${g?.message||"Неизвестная ошибка"}`,"Ошибка","error")}},"danger")},className:"px-2 py-2 text-xs text-red-400 hover:text-red-300 hover:bg-red-500/10 opacity-0 group-hover:opacity-100 transition-opacity",title:"Удалить версию",children:e.jsx(te,{size:12})})]},r.id))})]}),e.jsxs("button",{onClick:A,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-400 hover:text-cyan-300 border border-cyan-500/30 flex items-center gap-1.5",title:"Открыть в новом окне",children:[e.jsx(B,{size:14}),e.jsx("span",{children:"Открыть"})]})]})]}),e.jsx("div",{className:"bg-black/50 backdrop-blur-sm border-[5px] border-white/10 shadow-inner rounded-[2rem] overflow-hidden flex-1 p-4 sm:p-6 md:p-8",style:{margin:0,display:"flex",flexDirection:"column",maxHeight:"100%"},children:u&&u.type.includes("image")&&j==="text"?e.jsx("img",{src:`data:${u.type};base64,${u.data}`,alt:"Preview",className:"max-w-full h-auto rounded-2xl shadow-2xl"}):(()=>{if(!u)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/40 text-center px-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-xl rounded-full animate-pulse"}),e.jsx(P,{size:40,className:"relative opacity-50"})]}),e.jsx("p",{className:"text-base font-semibold text-white/60",children:"Выберите документ для просмотра"})]});const r=Q();return j==="prototype"&&V||q?Z():r===null?e.jsx("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:e.jsx("p",{className:"text-base font-medium mb-2",children:"Нет контента"})}):_?e.jsx("textarea",{value:le,onChange:b=>de(b.target.value),className:"w-full h-full min-h-[500px] bg-black/30 text-white p-4 rounded-xl border border-white/10 focus:border-white/30 focus:outline-none resize-none font-mono text-sm",placeholder:"Введите текст документа..."}):e.jsx("div",{className:"prose prose-invert prose-lg max-w-none overflow-x-auto break-words [&>*]:!my-0 [&>*:first-child]:!mt-0 [&>*:last-child]:!mb-0",children:e.jsx(Se,{content:he(r)})})})()})]})}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-white/30 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-2xl rounded-full animate-pulse"}),e.jsx("div",{className:"relative w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx(Pe,{size:48,className:"opacity-50"})})]}),e.jsx("p",{className:"text-lg font-semibold text-white/60 mb-2",children:"Выберите документ"}),e.jsx("p",{className:"text-sm text-white/40 text-center max-w-sm",children:"Выберите документ из списка слева для просмотра"})]})]})]}),h&&j==="prototype"&&y==="preview"&&e.jsxs("div",{className:"fixed inset-0 z-[60] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/80 backdrop-blur-md border-b border-white/10",children:[e.jsx("h3",{className:"text-white font-medium",children:"Просмотр верстки"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:A,className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5 transition-colors",children:[e.jsx(B,{size:16}),"Открыть в новой вкладке"]}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 text-white/70 hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(z,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-8",children:e.jsx("div",{className:"w-full h-full bg-black/40 border border-white/10 rounded-2xl p-4",children:Z(!0)})})]})]})};export{Re as DocumentsSidebar,nt as ProjectDocumentsModal,Ge as SyntaxHighlighterWrapper};
