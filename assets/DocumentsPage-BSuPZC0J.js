const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/syntax-highlighter-Q85ecyyO.js","assets/markdown-vendor-CiFSpwUK.js","assets/react-vendor-OvXVS5lI.js","assets/index-CXH5y3TO.js"])))=>i.map(i=>d[i]);
import{j as e,r as x}from"./markdown-vendor-CiFSpwUK.js";import{c as M,F as D,X as T,w as je,x as Ne,h as $,y as ke,f as ne,z as Ce,T as re,i as Se,D as Ee}from"./index-DQfcWnkr.js";import{U as se}from"./upload-B3T8zkJ8.js";import{_ as ie}from"./syntax-highlighter-Q85ecyyO.js";import{A as $e}from"./arrow-left-DRNozmPn.js";import{C as Pe}from"./calendar-DZJsn5Kq.js";import{E as Ve}from"./eye-BTaTyvmJ.js";import"./react-vendor-OvXVS5lI.js";const ze=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],De=M("download",ze);const Te=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],W=M("external-link",Te);const Re=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Le=M("maximize-2",Re);const _e=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],He=M("square-pen",_e),le=(t,r)=>{if(t.agentId){const u=r.find(a=>a.id===t.agentId);if(u)return u.name}const n=t.name.match(/^Summary\s*[-–—]\s*(.+?)\s*[-–—]\s*\d/);if(n&&n[1]){const u=n[1].trim(),a=r.find(s=>s.name===u);return a?a.name:u}const l=t.name.match(/^Документ\s*[-–—]\s*(.+?)\s*[-–—]\s*\d/);return l&&l[1]?l[1].trim():"Документ"},ce=t=>{const r=t.name.split(" - ");return r.length>1?r[r.length-1].trim():t.name},Me=t=>{const r=ce(t);try{const n=new Date(r);if(isNaN(n.getTime()))return r;const l=n.getDate().toString().padStart(2,"0"),u=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getFullYear(),s=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0");return`${l}.${u}.${a} ${s}:${i}`}catch{return r}},Q=(t,r)=>t?t.split(",").map(l=>l.trim().toLowerCase()).includes(r.toLowerCase()):!1,de=(t,r=[])=>t.name.match(/^(Summary|Документ)\s*[-–—]/)?`${le(t,r)} - ${ce(t)}`:t.name,Ie=t=>Me(t),Oe=({documents:t,selectedFileId:r,onSelectFile:n,project:l,onClose:u,onFileUpload:a,isSidebarCollapsed:s,onToggleSidebar:i})=>e.jsxs("div",{className:`border-r border-white/10 flex flex-col bg-black/40 backdrop-blur-xl transition-all duration-300 ease-in-out relative overflow-hidden ${s?"w-[60px] md:!w-[60px]":"w-full md:!w-[280px] md:min-w-[280px]"} ${r?"hidden md:flex":"flex"}`,title:s?`${t.length} ${t.length===1?"документ":t.length<5?"документа":"документов"}`:void 0,style:{transitionProperty:"width",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out",willChange:"width"},children:[e.jsxs("div",{className:`transition-all duration-300 ease-in-out border-b border-white/10 flex flex-col ${s?"p-0 items-center gap-0":"p-4 sm:p-6 gap-2"}`,children:[e.jsxs("div",{className:`transition-opacity duration-300 ease-in-out flex items-center gap-2 ${s?"opacity-0 pointer-events-none max-h-0 overflow-hidden":"opacity-100 pointer-events-auto"}`,style:{maxHeight:s?"0px":"none",transitionProperty:s?"opacity, max-height":"opacity",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out"},children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-amber-500/20 rounded-xl text-amber-400 flex-shrink-0",children:e.jsx(D,{size:18,className:"sm:w-5 sm:h-5"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white truncate",children:l?.name||"Документы"})]}),l?.projectType&&e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-1 ml-11 sm:ml-12 truncate",children:l.projectType.name})]}),e.jsx("button",{onClick:u,className:"md:hidden p-2 text-white/60 hover:text-white hover:bg-white/10 rounded-lg transition-colors flex-shrink-0","aria-label":"Закрыть",children:e.jsx(T,{size:20})}),e.jsx("button",{onClick:i,className:"hidden md:flex p-1.5 text-white/50 hover:text-white hover:bg-white/10 rounded-lg transition-all duration-200 flex-shrink-0","aria-label":"Свернуть панель документов",title:"Свернуть панель",children:e.jsx(je,{size:16})})]}),e.jsxs("div",{className:`flex flex-col items-center ${s?"opacity-100 pointer-events-auto overflow-visible pt-[30px]":"opacity-0 pointer-events-none max-h-0 overflow-hidden"}`,style:{maxWidth:s?"60px":"0px",maxHeight:s?"none":"0px",transitionProperty:s?"opacity, max-width":"opacity, max-width, max-height",transitionDuration:s?"300ms":"0ms",transitionTimingFunction:"ease-in-out"},children:[e.jsxs("button",{onClick:i,className:"relative p-2.5 bg-amber-500/20 hover:bg-amber-500/30 rounded-xl text-amber-400 transition-colors duration-200 group w-full flex items-center justify-center flex-shrink-0 mt-0","aria-label":"Развернуть панель документов",title:`${t.length} ${t.length===1?"документ":t.length<5?"документа":"документов"}`,children:[e.jsx(D,{size:22,className:"group-hover:scale-110 transition-transform duration-200"}),t.length>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 bg-indigo-500 text-white text-[11px] font-bold rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg ring-2 ring-black/60",children:t.length>9?"9+":t.length})]}),a&&e.jsx("button",{onClick:a,className:"w-full p-2.5 text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded-lg transition-colors duration-200 flex items-center justify-center border border-indigo-500/20 hover:border-indigo-500/40 flex-shrink-0 mt-3","aria-label":"Загрузить документ",title:"Загрузить документ",children:e.jsx(se,{size:18})})]}),a&&e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${s?"opacity-0 max-h-0 mt-0 pointer-events-none":"opacity-100 max-h-20 -mt-1 pointer-events-auto"}`,style:{transitionProperty:"opacity, max-height, margin-top",willChange:s?"opacity, max-height":void 0},children:e.jsxs("button",{onClick:a,className:"w-full px-4 py-2.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium shadow-lg shadow-indigo-500/20 hover:shadow-indigo-500/30",children:[e.jsx(se,{size:16}),"Загрузить"]})})]}),e.jsx("div",{className:`flex-1 overflow-hidden transition-opacity duration-300 ease-in-out ${s?"opacity-0 pointer-events-none":"opacity-100 pointer-events-auto"}`,children:e.jsx("div",{className:"h-full overflow-y-auto md:no-scrollbar",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/40 text-center p-6 border-2 border-dashed border-white/10 rounded-3xl m-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-amber-500/20 blur-xl rounded-full animate-pulse"}),e.jsx(D,{size:40,className:"relative opacity-60"})]}),e.jsx("p",{className:"text-base font-semibold text-white/70 mb-2",children:"Нет документов"}),e.jsx("p",{className:"text-xs text-white/50 max-w-[200px]",children:'Используйте кнопку "Сохранить" в чате для создания отчетов.'})]}):e.jsx("div",{className:"divide-y divide-white/10",children:t.map((d,f)=>e.jsxs("button",{onClick:()=>n(d.id),className:`w-full text-left px-4 py-3 transition-all duration-200 flex items-center gap-3 group relative cursor-pointer ${r===d.id?"bg-white/15":"bg-transparent hover:bg-white/10"}`,children:[r===d.id&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-amber-400"}),e.jsx(D,{size:18,className:`flex-shrink-0 transition-colors duration-200 ${r===d.id?"text-white/90":"text-white/60 group-hover:text-white/80"}`}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("h4",{className:`text-sm font-semibold line-clamp-2 transition-colors duration-200 ${r===d.id?"text-white":"text-white/70 group-hover:text-white/90"}`,children:de(d)})}),e.jsx(Ne,{size:16,className:`flex-shrink-0 transition-colors duration-200 ${r===d.id?"text-white/70":"text-white/40 group-hover:text-white/70"}`})]},d.id))})})})]});let X=null,Y=null;const Ge=async()=>(X||(X=(await ie(()=>import("./syntax-highlighter-Q85ecyyO.js").then(r=>r.cb),__vite__mapDeps([0,1,2]))).Prism),Y||(Y=(await ie(()=>import("./index-CXH5y3TO.js"),__vite__mapDeps([3,0,1,2]))).vscDarkPlus),{SyntaxHighlighter:X,vscDarkPlus:Y}),Ae=({language:t,children:r,isFullscreenView:n})=>{const[l,u]=x.useState(!1),[a,s]=x.useState(null);if(x.useEffect(()=>{let f=!0;return Ge().then(({SyntaxHighlighter:m,vscDarkPlus:y})=>{f&&(s({Component:m,style:y}),u(!0))}),()=>{f=!1}},[]),!l||!a)return e.jsx("div",{className:"bg-black/50 p-4 rounded-xl border border-white/10 font-mono text-sm text-white/70",children:r});const{Component:i,style:d}=a;return e.jsx(i,{style:d,language:t,PreTag:"div",customStyle:{margin:0,borderRadius:n?"1.5rem":"1rem",padding:"1.5rem",minHeight:0,maxHeight:"100%"},children:r})},qe=({documents:t,isOpen:r})=>{const[n,l]=x.useState(null),[u,a]=x.useState(null),s=x.useMemo(()=>u||t.find(i=>i.id===n)||null,[u,t,n]);return x.useEffect(()=>{if(n){const i=t.find(d=>d.id===n);i?a(d=>{if(d&&d.id===n){const f=d.dslContent&&d.dslContent.length>0||d.verstkaContent&&d.verstkaContent.length>0,m=i.dslContent&&i.dslContent.length>0||i.verstkaContent&&i.verstkaContent.length>0;if(f&&!m)return d}return i}):(l(null),a(null))}else a(null)},[t,n]),x.useEffect(()=>{},[r]),{selectedFileId:n,setSelectedFileId:l,localSelectedFile:u,setLocalSelectedFile:a,selectedFile:s}},Be=({selectedFile:t,agents:r,isOpen:n})=>{const[l,u]=x.useState("text"),[a,s]=x.useState("preview"),i=d=>{u(d),s("preview")};return x.useEffect(()=>{if(t){const d=r,f=t.agentId?d.find(y=>y.id===t.agentId):null;f&&Q(f?.role,"verstka")?(i("prototype"),s("preview")):(i("text"),s("preview"))}},[t?.id,n,r]),{activeTab:l,setActiveTab:i,prototypeSubTab:a,setPrototypeSubTab:s}},Je=({selectedFile:t,onDocumentUpdate:r,onShowAlert:n})=>{const[l,u]=x.useState(!1),[a,s]=x.useState(""),[i,d]=x.useState(!1);x.useEffect(()=>{t||(u(!1),s(""))},[t?.id]);const f=c=>{try{return decodeURIComponent(escape(window.atob(c)))}catch{return"Не удалось прочитать файл или это бинарный файл."}};return{isEditing:l,editedContent:a,setEditedContent:s,isSaving:i,handleEdit:()=>{if(!t)return;const c=f(t.data);s(c),u(!0)},handleCancelEdit:()=>{u(!1),s("")},handleSaveEdit:async()=>{if(t){d(!0);try{const c=window.btoa(unescape(encodeURIComponent(a))),{file:b}=await $.updateFileContent(t.id,c),E={id:b.id,name:b.name,type:b.mimeType,data:b.content,agentId:b.agentId,dslContent:b.dslContent,verstkaContent:b.verstkaContent};r&&r(E),u(!1),s(""),n&&n("Документ успешно обновлен","Успех","success")}catch(c){console.error("Failed to update file:",c),n&&n(`Не удалось обновить документ: ${c?.message||"Неизвестная ошибка"}`,"Ошибка","error")}finally{d(!1)}}},decodeContent:f}},Ke=5e3,We=300*1e3,H=t=>`prototype-generation-${t}`,Xe=(t,r)=>{try{localStorage.setItem(H(t),JSON.stringify({fileId:t,timestamp:r}))}catch(n){console.error("Failed to save generation state:",n)}},oe=t=>{try{const r=localStorage.getItem(H(t));if(!r)return null;const n=JSON.parse(r);return Date.now()-n.timestamp>We?(localStorage.removeItem(H(t)),null):n}catch(r){return console.error("Failed to get generation state:",r),null}},ae=t=>{try{localStorage.removeItem(H(t))}catch(r){console.error("Failed to clear generation state:",r)}},Ye=({selectedFile:t,documentCreatorAgent:r,selectedFileId:n,onDocumentUpdate:l,onShowAlert:u,setActiveTab:a,setPrototypeVersions:s,setSelectedVersionNumber:i})=>{const[d,f]=x.useState(!1),m=x.useRef(null),y=x.useRef(0),w=x.useRef(!1),c=x.useRef({onDocumentUpdate:l,onShowAlert:u,setActiveTab:a,setPrototypeVersions:s,setSelectedVersionNumber:i,selectedFile:t});x.useEffect(()=>{c.current={onDocumentUpdate:l,onShowAlert:u,setActiveTab:a,setPrototypeVersions:s,setSelectedVersionNumber:i,selectedFile:t}},[l,u,a,s,i,t]),x.useEffect(()=>(n&&oe(n)&&(f(!0),w.current=!0,$.getPrototypeVersions(n).then(({versions:g})=>{y.current=g.length,c.current.setPrototypeVersions(g),g.length>0&&c.current.setSelectedVersionNumber(g[0].versionNumber),b()}).catch(g=>{console.error("Failed to initialize versions count:",g),y.current=0,b()})),()=>{m.current&&(clearInterval(m.current),m.current=null)}),[n]);const b=()=>{m.current&&clearInterval(m.current),m.current=setInterval(async()=>{if(!n||!w.current){m.current&&(clearInterval(m.current),m.current=null);return}try{const{versions:p}=await $.getPrototypeVersions(n),g=p.length;if(g>y.current){f(!1),w.current=!1,ae(n),m.current&&(clearInterval(m.current),m.current=null),c.current.setPrototypeVersions(p),p.length>0&&c.current.setSelectedVersionNumber(p[0].versionNumber);const C=c.current.selectedFile;if(C&&c.current.onDocumentUpdate)try{const{versions:v}=await $.getPrototypeVersions(n);if(v.length>0){const P=v[0],h={...C,dslContent:P.dslContent||void 0,verstkaContent:P.verstkaContent||void 0};c.current.onDocumentUpdate(h)}}catch(v){console.error("Failed to update file after generation:",v)}c.current.onShowAlert&&c.current.onShowAlert("Прототип успешно сгенерирован","Успех","success",4e3),setTimeout(()=>{c.current.setActiveTab("prototype")},100)}else y.current=g,c.current.setPrototypeVersions(p)}catch(p){console.error("Failed to check prototype versions:",p),oe(n)||(f(!1),w.current=!1,m.current&&(clearInterval(m.current),m.current=null),c.current.onShowAlert&&c.current.onShowAlert("Генерация прототипа прервана или завершилась с ошибкой","Предупреждение","warning"))}},Ke)};return{isGeneratingPrototype:d,handleGenerateResult:async()=>{if(!(!t||!r)){if(f(!0),w.current=!0,n){try{const{versions:p}=await $.getPrototypeVersions(n);y.current=p.length}catch(p){console.error("Failed to get initial versions count:",p),y.current=0}Xe(n,Date.now())}b(),$.generatePrototype(r.id,t.id).then(({file:p})=>{console.log("Prototype generation completed")}).catch(p=>{console.error("Failed to generate result:",p),f(!1),w.current=!1,n&&ae(n),m.current&&(clearInterval(m.current),m.current=null),c.current.onShowAlert&&c.current.onShowAlert(`Не удалось сгенерировать прототип: ${p?.message||"Неизвестная ошибка"}`,"Ошибка","error")})}}}},Qe=({selectedFileId:t,activeTab:r,documents:n,isOpen:l})=>{const[u,a]=x.useState([]),[s,i]=x.useState(null),[d,f]=x.useState(!1),[m,y]=x.useState(!1),w=x.useRef(null),c=x.useRef(null),b=x.useRef(n);return x.useEffect(()=>{c.current=s},[s]),x.useEffect(()=>{b.current=n},[n]),x.useEffect(()=>{(async()=>{if(!t||r!=="prototype"){a([]),i(null),w.current=t;return}const p=b.current.find(v=>v.id===t);if(!p||!p.verstkaContent&&!p.dslContent){a([]),i(null),w.current=t;return}const g=w.current!==t,C=g?null:c.current;f(!0);try{const{versions:v}=await $.getPrototypeVersions(t);if(a(v),g||C===null)if(v.length>0){const P=v[0].versionNumber;i(P),c.current=P}else i(null),c.current=null;else if(v.some(h=>h.versionNumber===C))i(h=>h===C?h:C),c.current=C;else if(v.length>0){const h=v[0].versionNumber;i(h),c.current=h}else i(null),c.current=null;w.current=t}catch(v){console.error("Failed to load prototype versions:",v),a([]),i(null),c.current=null,w.current=t}finally{f(!1)}})()},[t,r,l]),x.useEffect(()=>{const E=p=>{m&&(p.target.closest(".version-dropdown-container")||y(!1))};return document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},[m,l]),{prototypeVersions:u,setPrototypeVersions:a,selectedVersionNumber:s,setSelectedVersionNumber:i,isLoadingVersions:d,isVersionDropdownOpen:m,setIsVersionDropdownOpen:y}},Ue=(t,r,n,l)=>{if(!t)return null;if(n!==null){const u=r.find(a=>a.versionNumber===n);if(u)return l==="dsl"?u.dslContent||null:u.verstkaContent||null}return l==="dsl"?t.dslContent||null:t.verstkaContent||null},ot=({onClose:t,documents:r,onRemoveFile:n,agents:l=[],project:u,onFileUpload:a,onDocumentUpdate:s,onShowAlert:i,onShowConfirm:d,currentUser:f})=>{const{shouldShowStep:m,completeStep:y}=ke(),[w,c]=x.useState(!1),[b,E]=x.useState(!1),p=f?.role==="admin",{selectedFileId:g,setSelectedFileId:C,localSelectedFile:v,setLocalSelectedFile:P,selectedFile:h}=qe({documents:r,isOpen:!0}),{activeTab:S,setActiveTab:I,prototypeSubTab:k,setPrototypeSubTab:O}=Be({selectedFile:h,agents:l,isOpen:!0}),{isEditing:G,editedContent:xe,setEditedContent:ue,isSaving:A,handleEdit:he,handleCancelEdit:me,handleSaveEdit:pe,decodeContent:fe}=Je({selectedFile:h,onDocumentUpdate:s,onShowAlert:i}),{prototypeVersions:R,setPrototypeVersions:U,selectedVersionNumber:V,setSelectedVersionNumber:L,isVersionDropdownOpen:q,setIsVersionDropdownOpen:B}=Qe({selectedFileId:g,activeTab:S,documents:r,isOpen:!0}),z=h?.agentId?l.find(o=>o.id===h.agentId):null,_=z&&Q(z.role,"copywriter"),J=z&&Q(z.role,"verstka"),{isGeneratingPrototype:Z,handleGenerateResult:ge}=Ye({selectedFile:h,documentCreatorAgent:z,selectedFileId:g,onDocumentUpdate:s,onShowAlert:i,setActiveTab:I,setPrototypeVersions:U,setSelectedVersionNumber:L});x.useEffect(()=>{const o=localStorage.getItem("documents-sidebar-collapsed");o!==null&&c(o==="true")},[]);const be=()=>{const o=!w;c(o),localStorage.setItem("documents-sidebar-collapsed",String(o))},ve=(o,j)=>{j.stopPropagation();const N=document.createElement("a");N.href=`data:${o.type};base64,${o.data}`,N.download=o.name,document.body.appendChild(N),N.click(),document.body.removeChild(N)},we=async(o,j)=>{j.stopPropagation(),n&&(g===o&&(C(null),P(null)),n(o))},K=()=>{const o=v||h;if(!o)return;const j=V!==null?`?v=${V}`:"",N=`${window.location.origin}/#/prototype/${o.id}${j}`;window.open(N,"_blank")},F=()=>{const o=v||h;return o?S==="text"?o.data:S==="prototype"?Ue(o,R,V,k):null:null},ee=(o=!1)=>{const j=F();return k==="dsl"||k==="html"?j?e.jsx("div",{className:"overflow-auto w-full flex-1 flex flex-col",style:{minHeight:0,maxHeight:"100%"},children:e.jsx(Ae,{language:k==="dsl"?"markdown":"html",isFullscreenView:o,children:j})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:[e.jsx("p",{className:"text-base font-medium mb-2",children:k==="dsl"?"DSL код еще не сгенерирован":"HTML код еще не сгенерирован"}),e.jsx("p",{className:"text-sm text-white/20",children:k==="dsl"?"Контент появится после генерации DSL агентом":"Контент появится после генерации Верстальщиком"})]}):j?e.jsx("div",{className:"w-full flex-1 relative",style:{minHeight:0,maxHeight:"100%"},children:e.jsx("iframe",{srcDoc:j,className:"absolute inset-0 w-full h-full border-0 rounded-xl",title:"HTML Preview",sandbox:"allow-same-origin allow-scripts"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:[e.jsx("p",{className:"text-base font-medium mb-2",children:"Прототип еще не сгенерирован"}),e.jsx("p",{className:"text-sm text-white/20",children:'Используйте кнопку "Сгенерировать прототип" для создания HTML-макета'})]})};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-black via-black to-indigo-950/20 flex flex-col overflow-hidden",style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsx(Oe,{documents:r,selectedFileId:g,onSelectFile:C,project:u,onClose:t,onFileUpload:a,isSidebarCollapsed:w,onToggleSidebar:be}),e.jsxs("div",{className:`flex-1 md:flex flex-col bg-black relative min-h-0 transition-all duration-300 ease-in-out ${h?"flex":"hidden md:flex"}`,style:{width:w?"calc(100% - 60px)":void 0,transitionProperty:"width",willChange:"width"},children:[e.jsxs("div",{className:"md:hidden sticky top-0 z-20 p-4 border-b border-white/10 flex items-center gap-3 bg-black/60 backdrop-blur-md flex-shrink-0",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 1rem)"},children:[e.jsx("button",{onClick:()=>C(null),className:"p-2.5 text-white hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors","aria-label":"К списку документов",children:e.jsx($e,{size:20,className:"font-bold"})}),e.jsx("span",{className:"font-medium truncate text-white",children:h?de(h,l):""}),e.jsx("button",{onClick:t,className:"ml-auto p-2.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Закрыть",children:e.jsx(T,{size:20})})]}),e.jsx("div",{className:"absolute top-6 right-6 z-10 hidden md:block",children:e.jsx("button",{onClick:t,className:"p-2.5 bg-black/60 backdrop-blur-md hover:bg-white/10 rounded-full text-white/70 hover:text-white transition-colors border border-white/10 shadow-lg",children:e.jsx(T,{size:20})})}),h?e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto scrollbar-thin p-4 md:p-8 lg:p-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto w-full h-full flex flex-col",children:[!(S==="prototype"&&k==="preview")&&!(S==="prototype"&&J&&k!=="preview"&&b)&&e.jsxs("div",{className:"mb-8 pb-6 border-b border-white/10",children:[e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-400 text-xs font-bold tracking-wider uppercase",children:h?le(h,l):"Документ"})}),e.jsxs("div",{className:"flex items-center justify-between gap-6 text-sm text-white/40",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{size:14})," ",h?Ie(h):new Date().toLocaleString()]}),J&&k==="preview"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>E(!0),className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5",children:[e.jsx(Le,{size:16}),"Развернуть"]}),e.jsxs("button",{onClick:K,className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5",children:[e.jsx(W,{size:16}),"Открыть в новой вкладке"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S==="text"&&!h.type.includes("image")&&(G?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:me,disabled:A,className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2 disabled:opacity-50",title:"Отменить","aria-label":"Отменить редактирование",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Отменить"}),e.jsx(T,{size:16})]}),e.jsxs("button",{onClick:pe,disabled:A,className:"px-3 py-2 text-green-400 hover:text-green-300 hover:bg-green-500/10 rounded-xl transition-all flex items-center gap-2 disabled:opacity-50",title:"Сохранить","aria-label":"Сохранить изменения",children:[A&&e.jsx(ne,{size:14,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Сохранить"}),e.jsx(Ce,{size:16})]})]}):e.jsxs("button",{onClick:he,className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2",title:"Редактировать","aria-label":"Редактировать документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Редактировать"}),e.jsx(He,{size:16})]})),e.jsxs("button",{onClick:o=>ve(h,o),className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2",title:"Скачать","aria-label":"Скачать документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Скачать"}),e.jsx(De,{size:16})]}),n&&e.jsxs("button",{onClick:o=>we(h.id,o),className:"px-3 py-2 text-white/80 hover:text-red-400 hover:bg-red-500/10 rounded-xl transition-all flex items-center gap-2",title:"Удалить","aria-label":"Удалить документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Удалить"}),e.jsx(re,{size:16})]})]})]})]}),(_||p)&&e.jsxs("div",{className:"mb-6 flex items-center gap-4 border-b border-white/10 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I("text"),className:`px-4 py-2 text-sm font-medium transition-colors border-b-2 ${S==="text"?"text-white border-white/40":"text-white/50 border-transparent hover:text-white/70"}`,children:"Текст"}),e.jsx("button",{onClick:()=>I("prototype"),className:`px-4 py-2 text-sm font-medium transition-colors border-b-2 ${S==="prototype"?"text-cyan-400 border-cyan-400/40":"text-white/50 border-transparent hover:text-white/70"}`,children:"Прототип"})]}),_&&!G&&e.jsx("button",{onClick:o=>{o.preventDefault(),ge()},disabled:Z,className:"text-cyan-400 hover:text-cyan-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-sm font-medium",children:Z?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"relative flex items-center justify-center",children:[e.jsx("span",{className:"absolute inset-0 bg-cyan-500/20 blur-md rounded-full animate-pulse"}),e.jsx(ne,{size:14,className:"relative animate-spin text-cyan-400"})]}),e.jsxs("span",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"leading-tight",children:"Генерация прототипа..."}),e.jsx("span",{className:"text-xs text-cyan-400/70 leading-tight",children:"В среднем до 3 минут"})]})]}):"Сгенерировать прототип"}),S==="prototype"&&e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[_&&p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>O("preview"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${k==="preview"?"bg-white/10 text-white":"text-white/30 hover:text-white/60 hover:bg-white/5"}`,children:"Preview"}),e.jsx("button",{onClick:()=>O("dsl"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${k==="dsl"?"bg-white/10 text-white":"text-white/30 hover:text-white/60 hover:bg-white/5"}`,children:"DSL"}),e.jsx("button",{onClick:()=>O("html"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${k==="html"?"bg-white/10 text-white":"text-white/30 hover:text-white/60 hover:bg-white/5"}`,children:"HTML"})]}),R.length>0&&e.jsxs("div",{className:"relative version-dropdown-container",children:[e.jsxs("button",{onClick:()=>B(!q),className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 flex items-center gap-1.5",title:"Выбрать версию",children:[e.jsxs("span",{children:["Версия ",V||"?"]}),e.jsx(Se,{size:14,className:q?"rotate-180":""})]}),q&&e.jsx("div",{className:"absolute right-0 top-full mt-1 bg-black/95 backdrop-blur-md border border-white/10 rounded-lg shadow-xl z-50 min-w-[200px] max-h-[200px] overflow-y-auto version-dropdown-container",children:R.map(o=>e.jsxs("div",{className:`flex items-center justify-between group ${V===o.versionNumber?"bg-cyan-500/20":""}`,children:[e.jsxs("button",{onClick:()=>{L(o.versionNumber),B(!1)},className:`flex-1 text-left px-3 py-2 text-xs transition-colors ${V===o.versionNumber?"text-cyan-400":"text-white/70 hover:text-white hover:bg-white/5"}`,children:["Версия ",o.versionNumber]}),R.length>1&&d&&e.jsx("button",{onClick:j=>{j.stopPropagation(),B(!1),d&&d("Удалить версию",`Вы уверены, что хотите удалить версию ${o.versionNumber}? Это действие нельзя отменить.`,async()=>{try{await $.deletePrototypeVersion(g,o.versionNumber);const{versions:N}=await $.getPrototypeVersions(g);if(U(N),V===o.versionNumber&&(N.length>0?L(N[0].versionNumber):L(null)),s&&h){const te=r.find(ye=>ye.id===g);te&&s(te)}i&&i("Версия успешно удалена","Успех","success")}catch(N){console.error("Failed to delete version:",N),i&&i(`Не удалось удалить версию: ${N?.message||"Неизвестная ошибка"}`,"Ошибка","error")}},"danger")},className:"px-2 py-2 text-xs text-red-400 hover:text-red-300 hover:bg-red-500/10 opacity-0 group-hover:opacity-100 transition-opacity",title:"Удалить версию",children:e.jsx(re,{size:12})})]},o.id))})]}),e.jsxs("button",{onClick:K,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-400 hover:text-cyan-300 border border-cyan-500/30 flex items-center gap-1.5",title:"Открыть в новом окне",children:[e.jsx(W,{size:14}),e.jsx("span",{children:"Открыть"})]})]})]}),e.jsx("div",{className:"bg-black/50 backdrop-blur-sm border-[5px] border-white/10 shadow-inner rounded-[2rem] overflow-y-auto overflow-x-hidden flex-1 p-4 sm:p-6 md:p-8 min-w-0",style:{margin:0,display:"flex",flexDirection:"column",maxHeight:"100%"},children:h&&h.type.includes("image")&&S==="text"?e.jsx("img",{src:`data:${h.type};base64,${h.data}`,alt:"Preview",className:"max-w-full h-auto rounded-2xl shadow-2xl"}):(()=>{if(!h)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/40 text-center px-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-xl rounded-full animate-pulse"}),e.jsx(D,{size:40,className:"relative opacity-50"})]}),e.jsx("p",{className:"text-base font-semibold text-white/60",children:"Выберите документ для просмотра"})]});const o=F();return S==="prototype"&&_||J?ee():o===null?e.jsx("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:e.jsx("p",{className:"text-base font-medium mb-2",children:"Нет контента"})}):G?e.jsx("textarea",{value:xe,onChange:j=>ue(j.target.value),className:"w-full h-full min-h-[500px] bg-black/30 text-white p-4 rounded-xl border border-white/10 focus:border-white/30 focus:outline-none resize-none font-mono text-sm",placeholder:"Введите текст документа..."}):e.jsx("div",{className:"prose prose-invert prose-lg max-w-none break-words [&>*]:!my-0 [&>*:first-child]:!mt-0 [&>*:last-child]:!mb-0 min-w-0",children:e.jsx(Ee,{content:fe(o)})})})()})]})}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-white/30 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-2xl rounded-full animate-pulse"}),e.jsx("div",{className:"relative w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx(Ve,{size:48,className:"opacity-50"})})]}),e.jsx("p",{className:"text-lg font-semibold text-white/60 mb-2",children:"Выберите документ"}),e.jsx("p",{className:"text-sm text-white/40 text-center max-w-sm",children:"Выберите документ из списка слева для просмотра"})]})]})]}),b&&S==="prototype"&&k==="preview"&&e.jsxs("div",{className:"fixed inset-0 z-[60] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/80 backdrop-blur-md border-b border-white/10",children:[e.jsx("h3",{className:"text-white font-medium",children:"Просмотр верстки"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:K,className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5 transition-colors",children:[e.jsx(W,{size:16}),"Открыть в новой вкладке"]}),e.jsx("button",{onClick:()=>E(!1),className:"p-2 text-white/70 hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(T,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-8",children:e.jsx("div",{className:"w-full h-full bg-black/40 border border-white/10 rounded-2xl p-4",children:ee(!0)})})]})]})};export{ot as DocumentsPage};
