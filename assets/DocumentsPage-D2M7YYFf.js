const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/syntax-highlighter-Q85ecyyO.js","assets/markdown-vendor-CiFSpwUK.js","assets/react-vendor-OvXVS5lI.js","assets/index-CXH5y3TO.js"])))=>i.map(i=>d[i]);
import{j as e,r as u}from"./markdown-vendor-CiFSpwUK.js";import{c as M,F as D,X as T,y as je,z as Ne,i as $,D as ke,g as ne,G as Ce,T as se,j as Se,H as Ee}from"./index-2x3Q1f9q.js";import{U as re}from"./upload-BbX4HHnX.js";import{_ as ie}from"./syntax-highlighter-Q85ecyyO.js";import{A as $e}from"./arrow-left-BvytUJoD.js";import{C as Pe}from"./calendar-BwpTzGgY.js";import{E as Ve}from"./eye-0Fiy76nf.js";import"./react-vendor-OvXVS5lI.js";const ze=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],De=M("download",ze);const Te=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],W=M("external-link",Te);const Re=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Le=M("maximize-2",Re);const He=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],_e=M("square-pen",He),le=(t,s)=>{if(t.agentId){const x=s.find(a=>a.id===t.agentId);if(x)return x.name}const n=t.name.match(/^Summary\s*[-–—]\s*(.+?)\s*[-–—]\s*\d/);if(n&&n[1]){const x=n[1].trim(),a=s.find(r=>r.name===x);return a?a.name:x}const l=t.name.match(/^Документ\s*[-–—]\s*(.+?)\s*[-–—]\s*\d/);return l&&l[1]?l[1].trim():"Документ"},ce=t=>{const s=t.name.split(" - ");return s.length>1?s[s.length-1].trim():t.name},Me=t=>{const s=ce(t);try{const n=new Date(s);if(isNaN(n.getTime()))return s;const l=n.getDate().toString().padStart(2,"0"),x=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getFullYear(),r=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0");return`${l}.${x}.${a} ${r}:${i}`}catch{return s}},F=(t,s)=>t?t.split(",").map(l=>l.trim().toLowerCase()).includes(s.toLowerCase()):!1,de=(t,s=[])=>t.name.match(/^(Summary|Документ)\s*[-–—]/)?`${le(t,s)} - ${ce(t)}`:t.name,Ie=t=>Me(t),Oe=({documents:t,selectedFileId:s,onSelectFile:n,project:l,onClose:x,onFileUpload:a,isSidebarCollapsed:r,onToggleSidebar:i})=>e.jsxs("div",{className:`border-r border-white/10 flex flex-col bg-black/40 backdrop-blur-xl transition-all duration-300 ease-in-out relative overflow-hidden ${r?"w-[60px] md:!w-[60px]":"w-full md:!w-[280px] md:min-w-[280px]"} ${s?"hidden md:flex":"flex"}`,title:r?`${t.length} ${t.length===1?"документ":t.length<5?"документа":"документов"}`:void 0,style:{transitionProperty:"width",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out",willChange:"width"},children:[e.jsxs("div",{className:`transition-all duration-300 ease-in-out border-b border-white/10 flex flex-col ${r?"p-0 items-center gap-0":"p-4 sm:p-6 gap-2"}`,children:[e.jsxs("div",{className:`transition-opacity duration-300 ease-in-out flex items-center gap-2 ${r?"opacity-0 pointer-events-none max-h-0 overflow-hidden":"opacity-100 pointer-events-auto"}`,style:{maxHeight:r?"0px":"none",transitionProperty:r?"opacity, max-height":"opacity",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out"},children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-amber-500/20 rounded-xl text-amber-400 flex-shrink-0",children:e.jsx(D,{size:18,className:"sm:w-5 sm:h-5"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white truncate",children:l?.name||"Документы"})]}),l?.projectType&&e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-1 ml-11 sm:ml-12 truncate",children:l.projectType.name})]}),e.jsx("button",{onClick:x,className:"md:hidden p-2 text-white/60 hover:text-white hover:bg-white/10 rounded-lg transition-colors flex-shrink-0","aria-label":"Закрыть",children:e.jsx(T,{size:20})}),e.jsx("button",{onClick:i,className:"hidden md:flex p-1.5 text-white/50 hover:text-white hover:bg-white/10 rounded-lg transition-all duration-200 flex-shrink-0","aria-label":"Свернуть панель документов",title:"Свернуть панель",children:e.jsx(je,{size:16})})]}),e.jsxs("div",{className:`flex flex-col items-center ${r?"opacity-100 pointer-events-auto overflow-visible pt-[30px]":"opacity-0 pointer-events-none max-h-0 overflow-hidden"}`,style:{maxWidth:r?"60px":"0px",maxHeight:r?"none":"0px",transitionProperty:r?"opacity, max-width":"opacity, max-width, max-height",transitionDuration:r?"300ms":"0ms",transitionTimingFunction:"ease-in-out"},children:[e.jsxs("button",{onClick:i,className:"relative p-2.5 bg-amber-500/20 hover:bg-amber-500/30 rounded-xl text-amber-400 transition-colors duration-200 group w-full flex items-center justify-center flex-shrink-0 mt-0","aria-label":"Развернуть панель документов",title:`${t.length} ${t.length===1?"документ":t.length<5?"документа":"документов"}`,children:[e.jsx(D,{size:22,className:"group-hover:scale-110 transition-transform duration-200"}),t.length>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 bg-indigo-500 text-white text-[11px] font-bold rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg ring-2 ring-black/60",children:t.length>9?"9+":t.length})]}),a&&e.jsx("button",{onClick:a,className:"w-full p-2.5 text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded-lg transition-colors duration-200 flex items-center justify-center border border-indigo-500/20 hover:border-indigo-500/40 flex-shrink-0 mt-3","aria-label":"Загрузить документ",title:"Загрузить документ",children:e.jsx(re,{size:18})})]}),a&&e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${r?"opacity-0 max-h-0 mt-0 pointer-events-none":"opacity-100 max-h-20 -mt-1 pointer-events-auto"}`,style:{transitionProperty:"opacity, max-height, margin-top",willChange:r?"opacity, max-height":void 0},children:e.jsxs("button",{onClick:a,className:"w-full px-4 py-2.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium shadow-lg shadow-indigo-500/20 hover:shadow-indigo-500/30",children:[e.jsx(re,{size:16}),"Загрузить"]})})]}),e.jsx("div",{className:`flex-1 overflow-hidden transition-opacity duration-300 ease-in-out ${r?"opacity-0 pointer-events-none":"opacity-100 pointer-events-auto"}`,children:e.jsx("div",{className:"h-full overflow-y-auto md:no-scrollbar",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/40 text-center p-6 border-2 border-dashed border-white/10 rounded-3xl m-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-amber-500/20 blur-xl rounded-full animate-pulse"}),e.jsx(D,{size:40,className:"relative opacity-60"})]}),e.jsx("p",{className:"text-base font-semibold text-white/70 mb-2",children:"Нет документов"}),e.jsx("p",{className:"text-xs text-white/50 max-w-[200px]",children:'Используйте кнопку "Сохранить" в чате для создания отчетов.'})]}):e.jsx("div",{className:"divide-y divide-white/10",children:t.map((d,p)=>e.jsxs("button",{onClick:()=>n(d.id),className:`w-full text-left px-4 py-3 transition-all duration-200 flex items-center gap-3 group relative cursor-pointer ${s===d.id?"bg-white/15":"bg-transparent hover:bg-white/10"}`,children:[s===d.id&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-amber-400"}),e.jsx(D,{size:18,className:`flex-shrink-0 transition-colors duration-200 ${s===d.id?"text-white/90":"text-white/60 group-hover:text-white/80"}`}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("h4",{className:`text-sm font-semibold line-clamp-2 transition-colors duration-200 ${s===d.id?"text-white":"text-white/70 group-hover:text-white/90"}`,children:de(d)})}),e.jsx(Ne,{size:16,className:`flex-shrink-0 transition-colors duration-200 ${s===d.id?"text-white/70":"text-white/40 group-hover:text-white/70"}`})]},d.id))})})})]});let X=null,Y=null;const Ge=async()=>(X||(X=(await ie(()=>import("./syntax-highlighter-Q85ecyyO.js").then(s=>s.cb),__vite__mapDeps([0,1,2]))).Prism),Y||(Y=(await ie(()=>import("./index-CXH5y3TO.js"),__vite__mapDeps([3,0,1,2]))).vscDarkPlus),{SyntaxHighlighter:X,vscDarkPlus:Y}),Ae=({language:t,children:s,isFullscreenView:n})=>{const[l,x]=u.useState(!1),[a,r]=u.useState(null);if(u.useEffect(()=>{let p=!0;return Ge().then(({SyntaxHighlighter:h,vscDarkPlus:y})=>{p&&(r({Component:h,style:y}),x(!0))}),()=>{p=!1}},[]),!l||!a)return e.jsx("div",{className:"bg-black/50 p-4 rounded-xl border border-white/10 font-mono text-sm text-white/70",children:s});const{Component:i,style:d}=a;return e.jsx(i,{style:d,language:t,PreTag:"div",customStyle:{margin:0,borderRadius:n?"1.5rem":"1rem",padding:"1.5rem",minHeight:0,maxHeight:"100%"},children:s})},qe=({documents:t,isOpen:s})=>{const[n,l]=u.useState(null),[x,a]=u.useState(null),r=u.useMemo(()=>x||t.find(i=>i.id===n)||null,[x,t,n]);return u.useEffect(()=>{if(n){const i=t.find(d=>d.id===n);i?a(d=>{if(d&&d.id===n){const p=d.dslContent&&d.dslContent.length>0||d.verstkaContent&&d.verstkaContent.length>0,h=i.dslContent&&i.dslContent.length>0||i.verstkaContent&&i.verstkaContent.length>0;if(p&&!h)return d}return i}):(l(null),a(null))}else a(null)},[t,n]),u.useEffect(()=>{},[s]),{selectedFileId:n,setSelectedFileId:l,localSelectedFile:x,setLocalSelectedFile:a,selectedFile:r}},Be=({selectedFile:t,agents:s,isOpen:n})=>{const[l,x]=u.useState("text"),[a,r]=u.useState("preview"),i=d=>{x(d),r("preview")};return u.useEffect(()=>{if(t){const d=s,p=t.agentId?d.find(y=>y.id===t.agentId):null;p&&F(p?.role,"verstka")?(i("prototype"),r("preview")):(i("text"),r("preview"))}},[t?.id,n,s]),{activeTab:l,setActiveTab:i,prototypeSubTab:a,setPrototypeSubTab:r}},Je=({selectedFile:t,onDocumentUpdate:s,onShowAlert:n})=>{const[l,x]=u.useState(!1),[a,r]=u.useState(""),[i,d]=u.useState(!1);u.useEffect(()=>{t||(x(!1),r(""))},[t?.id]);const p=c=>{try{return decodeURIComponent(escape(window.atob(c)))}catch{return"Не удалось прочитать файл или это бинарный файл."}};return{isEditing:l,editedContent:a,setEditedContent:r,isSaving:i,handleEdit:()=>{if(!t)return;const c=p(t.data);r(c),x(!0)},handleCancelEdit:()=>{x(!1),r("")},handleSaveEdit:async()=>{if(t){d(!0);try{const c=window.btoa(unescape(encodeURIComponent(a))),{file:g}=await $.updateFileContent(t.id,c),E={id:g.id,name:g.name,type:g.mimeType,data:g.content,agentId:g.agentId,dslContent:g.dslContent,verstkaContent:g.verstkaContent};s&&s(E),x(!1),r(""),n&&n("Документ успешно обновлен","Успех","success")}catch(c){console.error("Failed to update file:",c),n&&n(`Не удалось обновить документ: ${c?.message||"Неизвестная ошибка"}`,"Ошибка","error")}finally{d(!1)}}},decodeContent:p}},Ke=5e3,We=300*1e3,_=t=>`prototype-generation-${t}`,Xe=(t,s)=>{try{localStorage.setItem(_(t),JSON.stringify({fileId:t,timestamp:s}))}catch(n){console.error("Failed to save generation state:",n)}},oe=t=>{try{const s=localStorage.getItem(_(t));if(!s)return null;const n=JSON.parse(s);return Date.now()-n.timestamp>We?(localStorage.removeItem(_(t)),null):n}catch(s){return console.error("Failed to get generation state:",s),null}},ae=t=>{try{localStorage.removeItem(_(t))}catch(s){console.error("Failed to clear generation state:",s)}},Ye=({selectedFile:t,documentCreatorAgent:s,selectedFileId:n,onDocumentUpdate:l,onShowAlert:x,setActiveTab:a,setPrototypeVersions:r,setSelectedVersionNumber:i})=>{const[d,p]=u.useState(!1),h=u.useRef(null),y=u.useRef(0),w=u.useRef(!1),c=u.useRef({onDocumentUpdate:l,onShowAlert:x,setActiveTab:a,setPrototypeVersions:r,setSelectedVersionNumber:i,selectedFile:t});u.useEffect(()=>{c.current={onDocumentUpdate:l,onShowAlert:x,setActiveTab:a,setPrototypeVersions:r,setSelectedVersionNumber:i,selectedFile:t}},[l,x,a,r,i,t]),u.useEffect(()=>(n&&oe(n)&&(p(!0),w.current=!0,$.getPrototypeVersions(n).then(({versions:b})=>{y.current=b.length,c.current.setPrototypeVersions(b),b.length>0&&c.current.setSelectedVersionNumber(b[0].versionNumber),g()}).catch(b=>{console.error("Failed to initialize versions count:",b),y.current=0,g()})),()=>{h.current&&(clearInterval(h.current),h.current=null)}),[n]);const g=()=>{h.current&&clearInterval(h.current),h.current=setInterval(async()=>{if(!n||!w.current){h.current&&(clearInterval(h.current),h.current=null);return}try{const{versions:f}=await $.getPrototypeVersions(n),b=f.length;if(b>y.current){p(!1),w.current=!1,ae(n),h.current&&(clearInterval(h.current),h.current=null),c.current.setPrototypeVersions(f),f.length>0&&c.current.setSelectedVersionNumber(f[0].versionNumber);const S=c.current.selectedFile;if(S&&c.current.onDocumentUpdate)try{const{versions:v}=await $.getPrototypeVersions(n);if(v.length>0){const P=v[0],m={...S,dslContent:P.dslContent||void 0,verstkaContent:P.verstkaContent||void 0};c.current.onDocumentUpdate(m)}}catch(v){console.error("Failed to update file after generation:",v)}c.current.onShowAlert&&c.current.onShowAlert("Прототип успешно сгенерирован","Успех","success",4e3),setTimeout(()=>{c.current.setActiveTab("prototype")},100)}else y.current=b,c.current.setPrototypeVersions(f)}catch(f){console.error("Failed to check prototype versions:",f),oe(n)||(p(!1),w.current=!1,h.current&&(clearInterval(h.current),h.current=null),c.current.onShowAlert&&c.current.onShowAlert("Генерация прототипа прервана или завершилась с ошибкой","Предупреждение","warning"))}},Ke)};return{isGeneratingPrototype:d,handleGenerateResult:async()=>{if(!(!t||!s)){if(p(!0),w.current=!0,n){try{const{versions:f}=await $.getPrototypeVersions(n);y.current=f.length}catch(f){console.error("Failed to get initial versions count:",f),y.current=0}Xe(n,Date.now())}g(),$.generatePrototype(s.id,t.id).then(({file:f})=>{console.log("Prototype generation completed")}).catch(f=>{console.error("Failed to generate result:",f),p(!1),w.current=!1,n&&ae(n),h.current&&(clearInterval(h.current),h.current=null),c.current.onShowAlert&&c.current.onShowAlert(`Не удалось сгенерировать прототип: ${f?.message||"Неизвестная ошибка"}`,"Ошибка","error")})}}}},Fe=({selectedFileId:t,activeTab:s,documents:n,isOpen:l})=>{const[x,a]=u.useState([]),[r,i]=u.useState(null),[d,p]=u.useState(!1),[h,y]=u.useState(!1),w=u.useRef(null),c=u.useRef(null),g=u.useRef(n);return u.useEffect(()=>{c.current=r},[r]),u.useEffect(()=>{g.current=n},[n]),u.useEffect(()=>{(async()=>{if(!t||s!=="prototype"){a([]),i(null),w.current=t;return}const f=g.current.find(v=>v.id===t);if(!f||!f.verstkaContent&&!f.dslContent){a([]),i(null),w.current=t;return}const b=w.current!==t,S=b?null:c.current;p(!0);try{const{versions:v}=await $.getPrototypeVersions(t);if(a(v),b||S===null)if(v.length>0){const P=v[0].versionNumber;i(P),c.current=P}else i(null),c.current=null;else if(v.some(m=>m.versionNumber===S))i(m=>m===S?m:S),c.current=S;else if(v.length>0){const m=v[0].versionNumber;i(m),c.current=m}else i(null),c.current=null;w.current=t}catch(v){console.error("Failed to load prototype versions:",v),a([]),i(null),c.current=null,w.current=t}finally{p(!1)}})()},[t,s,l]),u.useEffect(()=>{const E=f=>{h&&(f.target.closest(".version-dropdown-container")||y(!1))};return document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},[h,l]),{prototypeVersions:x,setPrototypeVersions:a,selectedVersionNumber:r,setSelectedVersionNumber:i,isLoadingVersions:d,isVersionDropdownOpen:h,setIsVersionDropdownOpen:y}},Qe=(t,s,n,l)=>{if(!t)return null;if(n!==null){const x=s.find(a=>a.versionNumber===n);if(x)return l==="dsl"?x.dslContent||null:x.verstkaContent||null}return l==="dsl"?t.dslContent||null:t.verstkaContent||null},ot=({onClose:t,documents:s,onRemoveFile:n,agents:l=[],project:x,onFileUpload:a,onDocumentUpdate:r,onShowAlert:i,onShowConfirm:d,currentUser:p})=>{const{shouldShowStep:h,completeStep:y}=ke(),[w,c]=u.useState(!1),[g,E]=u.useState(!1),f=p?.role==="admin",{selectedFileId:b,setSelectedFileId:S,localSelectedFile:v,setLocalSelectedFile:P,selectedFile:m}=qe({documents:s,isOpen:!0}),{activeTab:j,setActiveTab:I,prototypeSubTab:C,setPrototypeSubTab:O}=Be({selectedFile:m,agents:l,isOpen:!0}),{isEditing:G,editedContent:ue,setEditedContent:xe,isSaving:A,handleEdit:me,handleCancelEdit:he,handleSaveEdit:fe,decodeContent:pe}=Je({selectedFile:m,onDocumentUpdate:r,onShowAlert:i}),{prototypeVersions:R,setPrototypeVersions:Q,selectedVersionNumber:V,setSelectedVersionNumber:L,isVersionDropdownOpen:q,setIsVersionDropdownOpen:B}=Fe({selectedFileId:b,activeTab:j,documents:s,isOpen:!0}),z=m?.agentId?l.find(o=>o.id===m.agentId):null,H=z&&F(z.role,"copywriter"),J=z&&F(z.role,"verstka"),{isGeneratingPrototype:U,handleGenerateResult:be}=Ye({selectedFile:m,documentCreatorAgent:z,selectedFileId:b,onDocumentUpdate:r,onShowAlert:i,setActiveTab:I,setPrototypeVersions:Q,setSelectedVersionNumber:L});u.useEffect(()=>{const o=localStorage.getItem("documents-sidebar-collapsed");o!==null&&c(o==="true")},[]);const ge=()=>{const o=!w;c(o),localStorage.setItem("documents-sidebar-collapsed",String(o))},ve=(o,N)=>{N.stopPropagation();const k=document.createElement("a");k.href=`data:${o.type};base64,${o.data}`,k.download=o.name,document.body.appendChild(k),k.click(),document.body.removeChild(k)},we=async(o,N)=>{N.stopPropagation(),n&&(b===o&&(S(null),P(null)),n(o))},K=()=>{const o=v||m;if(!o)return;const N=V!==null?`?v=${V}`:"",k=`${window.location.origin}/#/prototype/${o.id}${N}`;window.open(k,"_blank")},Z=()=>{const o=v||m;return o?j==="text"?o.data:j==="prototype"?Qe(o,R,V,C):null:null},ee=(o=!1)=>{const N=Z();return C==="dsl"||C==="html"?N?e.jsx("div",{className:"overflow-auto w-full flex-1 flex flex-col",style:{minHeight:0,maxHeight:"100%"},children:e.jsx(Ae,{language:C==="dsl"?"markdown":"html",isFullscreenView:o,children:N})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:[e.jsx("p",{className:"text-base font-medium mb-2",children:C==="dsl"?"DSL код еще не сгенерирован":"HTML код еще не сгенерирован"}),e.jsx("p",{className:"text-sm text-white/20",children:C==="dsl"?"Контент появится после генерации DSL агентом":"Контент появится после генерации Верстальщиком"})]}):N?e.jsx("div",{className:"w-full flex-1 relative",style:{minHeight:0,maxHeight:"100%"},children:e.jsx("iframe",{srcDoc:N,className:"absolute inset-0 w-full h-full border-0 rounded-xl",title:"HTML Preview",sandbox:"allow-same-origin allow-scripts"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:[e.jsx("p",{className:"text-base font-medium mb-2",children:"Прототип еще не сгенерирован"}),e.jsx("p",{className:"text-sm text-white/20",children:'Используйте кнопку "Сгенерировать прототип" для создания HTML-макета'})]})};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-black via-black to-indigo-950/20 flex flex-col overflow-hidden",style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsx(Oe,{documents:s,selectedFileId:b,onSelectFile:S,project:x,onClose:t,onFileUpload:a,isSidebarCollapsed:w,onToggleSidebar:ge}),e.jsxs("div",{className:`flex-1 md:flex flex-col bg-black relative min-h-0 transition-all duration-300 ease-in-out ${m?"flex":"hidden md:flex"}`,style:{width:w?"calc(100% - 60px)":void 0,transitionProperty:"width",willChange:"width"},children:[e.jsxs("div",{className:"md:hidden sticky top-0 z-20 p-4 border-b border-white/10 flex items-center gap-3 bg-black/60 backdrop-blur-md flex-shrink-0",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 1rem)"},children:[e.jsx("button",{onClick:()=>S(null),className:"p-2.5 text-white hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors","aria-label":"К списку документов",children:e.jsx($e,{size:20,className:"font-bold"})}),e.jsx("span",{className:"font-medium truncate text-white",children:m?de(m,l):""}),e.jsx("button",{onClick:t,className:"ml-auto p-2.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Закрыть",children:e.jsx(T,{size:20})})]}),e.jsx("div",{className:"absolute top-6 right-6 z-10 hidden md:block",children:e.jsx("button",{onClick:t,className:"p-2.5 bg-black/60 backdrop-blur-md hover:bg-white/10 rounded-full text-white/70 hover:text-white transition-colors border border-white/10 shadow-lg",children:e.jsx(T,{size:20})})}),m?e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto scrollbar-thin p-4 md:p-8 lg:p-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto w-full h-full flex flex-col",children:[!(j==="prototype"&&C==="preview")&&!(j==="prototype"&&J&&C!=="preview"&&g)&&e.jsxs("div",{className:"mb-8 pb-6 border-b border-white/10",children:[e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-400 text-xs font-bold tracking-wider uppercase",children:m?le(m,l):"Документ"})}),e.jsxs("div",{className:"flex items-center justify-between gap-6 text-sm text-white/40",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{size:14})," ",m?Ie(m):new Date().toLocaleString()]}),J&&C==="preview"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>E(!0),className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5",children:[e.jsx(Le,{size:16}),"Развернуть"]}),e.jsxs("button",{onClick:K,className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5",children:[e.jsx(W,{size:16}),"Открыть в новой вкладке"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j==="text"&&!m.type.includes("image")&&(G?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:he,disabled:A,className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2 disabled:opacity-50",title:"Отменить","aria-label":"Отменить редактирование",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Отменить"}),e.jsx(T,{size:16})]}),e.jsxs("button",{onClick:fe,disabled:A,className:"px-3 py-2 text-green-400 hover:text-green-300 hover:bg-green-500/10 rounded-xl transition-all flex items-center gap-2 disabled:opacity-50",title:"Сохранить","aria-label":"Сохранить изменения",children:[A&&e.jsx(ne,{size:14,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Сохранить"}),e.jsx(Ce,{size:16})]})]}):e.jsxs("button",{onClick:me,className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2",title:"Редактировать","aria-label":"Редактировать документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Редактировать"}),e.jsx(_e,{size:16})]})),e.jsxs("button",{onClick:o=>ve(m,o),className:"px-3 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all flex items-center gap-2",title:"Скачать","aria-label":"Скачать документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Скачать"}),e.jsx(De,{size:16})]}),n&&e.jsxs("button",{onClick:o=>we(m.id,o),className:"px-3 py-2 text-white/80 hover:text-red-400 hover:bg-red-500/10 rounded-xl transition-all flex items-center gap-2",title:"Удалить","aria-label":"Удалить документ",children:[e.jsx("span",{className:"text-xs font-semibold hidden sm:inline",children:"Удалить"}),e.jsx(se,{size:16})]})]})]})]}),(H||f)&&e.jsx("div",{className:"mb-6 w-full",children:e.jsxs("div",{className:"w-full rounded-xl border border-white/10 bg-white/5 p-3 space-y-2 md:p-4 md:space-y-3",children:[e.jsx("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:gap-3 md:space-y-0",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto snap-x md:flex-1",role:"tablist",children:[e.jsx("button",{role:"tab","aria-selected":j==="text","aria-controls":"documents-tab-text",onClick:()=>I("text"),className:`flex-1 min-w-[108px] snap-start h-9 px-2 text-xs font-semibold rounded-lg border md:min-w-[128px] md:h-11 md:px-3 md:text-sm ${j==="text"?"bg-white/10 text-white border-white/10":"text-white/70 border-transparent hover:text-white"} focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/60`,children:"Текст"}),e.jsx("button",{role:"tab","aria-selected":j==="prototype","aria-controls":"documents-tab-prototype",onClick:()=>I("prototype"),className:`flex-1 min-w-[108px] snap-start h-9 px-2 text-xs font-semibold rounded-lg border md:min-w-[128px] md:h-11 md:px-3 md:text-sm ${j==="prototype"?"bg-white/10 text-white border-white/10":"text-white/70 border-transparent hover:text-white"} focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/60`,children:"Прототип"})]})}),j==="prototype"&&e.jsxs("div",{className:"flex flex-col gap-2 md:gap-3",children:[H&&f&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O("preview"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${C==="preview"?"bg-white/10 text-white":"text-white/40 hover:text-white/80 hover:bg-white/5"}`,children:"Preview"}),e.jsx("button",{onClick:()=>O("dsl"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${C==="dsl"?"bg-white/10 text-white":"text-white/40 hover:text-white/80 hover:bg-white/5"}`,children:"DSL"}),e.jsx("button",{onClick:()=>O("html"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${C==="html"?"bg-white/10 text-white":"text-white/40 hover:text-white/80 hover:bg-white/5"}`,children:"HTML"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full flex-wrap",children:[R.length>0?e.jsxs("div",{className:"relative version-dropdown-container",children:[e.jsxs("button",{onClick:()=>B(!q),className:"inline-flex items-center gap-1.5 rounded-md border border-white/12 bg-white/5 h-9 px-3 text-xs font-semibold text-white/80 hover:bg-white/10 hover:text-white active:bg-white/15 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/60 md:h-10 md:text-sm",title:"Выбрать версию",children:[e.jsxs("span",{children:["Ver ",V||"?"]}),e.jsx(Se,{size:14,className:q?"rotate-180":""})]}),q&&e.jsx("div",{className:"absolute left-0 top-full mt-1 bg-black/95 backdrop-blur-md border border-white/10 rounded-lg shadow-xl z-50 min-w-[200px] max-h-[200px] overflow-y-auto version-dropdown-container",children:R.map(o=>e.jsxs("div",{className:`flex items-center justify-between group ${V===o.versionNumber?"bg-cyan-500/20":""}`,children:[e.jsxs("button",{onClick:()=>{L(o.versionNumber),B(!1)},className:`flex-1 text-left px-3 py-2 text-xs transition-colors ${V===o.versionNumber?"text-cyan-400":"text-white/70 hover:text-white hover:bg-white/5"}`,children:["Ver ",o.versionNumber]}),R.length>1&&d&&e.jsx("button",{onClick:N=>{N.stopPropagation(),B(!1),d&&d("Удалить версию",`Вы уверены, что хотите удалить версию ${o.versionNumber}? Это действие нельзя отменить.`,async()=>{try{await $.deletePrototypeVersion(b,o.versionNumber);const{versions:k}=await $.getPrototypeVersions(b);if(Q(k),V===o.versionNumber&&(k.length>0?L(k[0].versionNumber):L(null)),r&&m){const te=s.find(ye=>ye.id===b);te&&r(te)}i&&i("Версия успешно удалена","Успех","success")}catch(k){console.error("Failed to delete version:",k),i&&i(`Не удалось удалить версию: ${k?.message||"Неизвестная ошибка"}`,"Ошибка","error")}},"danger")},className:"px-2 py-2 text-xs text-red-400 hover:text-red-300 hover:bg-red-500/10 opacity-0 group-hover:opacity-100 transition-opacity",title:"Удалить версию",children:e.jsx(se,{size:12})})]},o.id))})]}):e.jsx("span",{className:"inline-flex items-center gap-1 rounded-md bg-white/5 border border-white/10 px-2.5 py-1 text-xs text-white/70",children:"Ver нет"}),H&&!G&&e.jsx("button",{onClick:o=>{o.preventDefault(),be()},disabled:U,className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 rounded-md h-10 px-3 text-xs font-semibold text-white bg-cyan-500 hover:bg-cyan-400 active:bg-cyan-500/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-300 disabled:opacity-60 disabled:cursor-not-allowed md:h-11 md:px-4 md:text-sm",children:U?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:16,className:"animate-spin"}),"Генерация..."]}):e.jsx(e.Fragment,{children:"⚡ Сгенерировать"})}),e.jsxs("button",{onClick:K,className:"inline-flex items-center gap-1.5 rounded-md border border-cyan-500/30 bg-cyan-500/10 h-10 px-3 text-xs font-semibold text-cyan-400 hover:bg-cyan-500/20 hover:text-cyan-300 active:bg-cyan-500/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-300 transition-colors md:h-11 md:px-4 md:text-sm",title:"Открыть в новом окне",children:[e.jsx(W,{size:14}),e.jsx("span",{className:"sr-only md:inline",children:"Открыть"})]})]})]})]})}),e.jsx("div",{className:"bg-black/50 backdrop-blur-sm border-[5px] border-white/10 shadow-inner rounded-[2rem] overflow-y-auto overflow-x-auto md:overflow-x-visible flex-1 p-4 sm:p-6 md:p-8 min-w-0 max-w-full",style:{margin:0,display:"flex",flexDirection:"column",maxHeight:"100%"},children:m&&m.type.includes("image")&&j==="text"?e.jsx("img",{src:`data:${m.type};base64,${m.data}`,alt:"Preview",className:"max-w-full h-auto rounded-2xl shadow-2xl"}):(()=>{if(!m)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 text-white/40 text-center px-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-xl rounded-full animate-pulse"}),e.jsx(D,{size:40,className:"relative opacity-50"})]}),e.jsx("p",{className:"text-base font-semibold text-white/60",children:"Выберите документ для просмотра"})]});const o=Z();return j==="prototype"&&H||J?ee():o===null?e.jsx("div",{className:"flex flex-col items-center justify-center h-60 text-white/30 text-center",children:e.jsx("p",{className:"text-base font-medium mb-2",children:"Нет контента"})}):G?e.jsx("textarea",{value:ue,onChange:N=>xe(N.target.value),className:"w-full h-full min-h-[500px] bg-black/30 text-white p-4 rounded-xl border border-white/10 focus:border-white/30 focus:outline-none resize-none font-mono text-sm",placeholder:"Введите текст документа..."}):e.jsx("div",{className:"prose prose-invert prose-lg max-w-none break-words [&>*]:!my-0 [&>*:first-child]:!mt-0 [&>*:last-child]:!mb-0 min-w-0",children:e.jsx(Ee,{content:pe(o)})})})()})]})}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-white/30 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-2xl rounded-full animate-pulse"}),e.jsx("div",{className:"relative w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx(Ve,{size:48,className:"opacity-50"})})]}),e.jsx("p",{className:"text-lg font-semibold text-white/60 mb-2",children:"Выберите документ"}),e.jsx("p",{className:"text-sm text-white/40 text-center max-w-sm",children:"Выберите документ из списка слева для просмотра"})]})]})]}),g&&j==="prototype"&&C==="preview"&&e.jsxs("div",{className:"fixed inset-0 z-[60] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/80 backdrop-blur-md border-b border-white/10",children:[e.jsx("h3",{className:"text-white font-medium",children:"Просмотр верстки"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:K,className:"px-4 py-2 text-sm font-medium flex items-center gap-2 text-white/70 hover:text-white border border-white/10 rounded-lg hover:bg-white/5 transition-colors",children:[e.jsx(W,{size:16}),"Открыть в новой вкладке"]}),e.jsx("button",{onClick:()=>E(!1),className:"p-2 text-white/70 hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(T,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-8",children:e.jsx("div",{className:"w-full h-full bg-black/40 border border-white/10 rounded-2xl p-4",children:ee(!0)})})]})]})};export{ot as DocumentsPage};
